<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Loading Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Modal System Test</h1>

        <!-- Test Status -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Load Status</h2>
            <div id="status" class="space-y-2">
                <p>✅ Page loaded</p>
                <p id="alpine-status">⏳ Waiting for Alpine.js...</p>
                <p id="ntee-status">⏳ Checking NTEE codes...</p>
                <p id="criteria-status">⏳ Checking Government criteria...</p>
                <p id="modal-component-status">⏳ Checking modal component...</p>
                <p id="modal-templates-status">⏳ Checking modal templates...</p>
            </div>
        </div>

        <!-- Test Buttons -->
        <div class="bg-white rounded-lg shadow p-6 mb-6" x-data="{
            testModal() {
                window.dispatchEvent(new CustomEvent('open-create-profile-modal'));
            }
        }">
            <h2 class="text-xl font-semibold mb-4">Test Buttons</h2>
            <div class="space-x-4">
                <button @click="testModal()"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Open Create Profile Modal
                </button>
                <button @click="window.dispatchEvent(new CustomEvent('open-edit-profile-modal', { detail: { profile: { id: 'test', name: 'Test Org' } } }))"
                        class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                    Open Edit Profile Modal
                </button>
            </div>
        </div>

        <!-- Console Output -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Console Output</h2>
            <div id="console-output" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-64 overflow-y-auto">
                <p>Waiting for console messages...</p>
            </div>
        </div>
    </div>

    <!-- Load Modal System -->
    <script src="http://localhost:8000/static/data/ntee-codes.js"></script>
    <script src="http://localhost:8000/static/data/government-criteria.js"></script>
    <script src="http://localhost:8000/static/modules/modal-component.js"></script>
    <script src="http://localhost:8000/static/modules/modal-loader.js"></script>

    <!-- Status Check Script -->
    <script>
        // Override console.log to display in page
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const p = document.createElement('p');
            p.textContent = args.join(' ');
            consoleOutput.appendChild(p);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // Check statuses after page load
        setTimeout(() => {
            // Check Alpine.js
            if (typeof Alpine !== 'undefined') {
                document.getElementById('alpine-status').textContent = '✅ Alpine.js loaded';
            } else {
                document.getElementById('alpine-status').textContent = '❌ Alpine.js NOT loaded';
            }

            // Check NTEE codes
            if (typeof NTEE_CODES !== 'undefined') {
                document.getElementById('ntee-status').textContent = `✅ NTEE codes loaded (${Object.keys(NTEE_CODES).length} categories)`;
            } else {
                document.getElementById('ntee-status').textContent = '❌ NTEE codes NOT loaded';
            }

            // Check Government criteria
            if (typeof GOVERNMENT_CRITERIA !== 'undefined') {
                document.getElementById('criteria-status').textContent = `✅ Government criteria loaded (${GOVERNMENT_CRITERIA.length} categories)`;
            } else {
                document.getElementById('criteria-status').textContent = '❌ Government criteria NOT loaded';
            }

            // Check modal component
            if (typeof modalComponent !== 'undefined') {
                document.getElementById('modal-component-status').textContent = '✅ Modal component loaded';
            } else {
                document.getElementById('modal-component-status').textContent = '❌ Modal component NOT loaded';
            }

            // Check modal templates (look for modal containers in DOM)
            const editModal = document.getElementById('edit-profile-modal-container');
            const createModal = document.getElementById('create-profile-modal-container');
            if (editModal && createModal) {
                document.getElementById('modal-templates-status').textContent = '✅ Modal templates loaded';
            } else {
                document.getElementById('modal-templates-status').textContent = `❌ Modal templates NOT loaded (edit: ${!!editModal}, create: ${!!createModal})`;
            }

            console.log('=== Load Status Check Complete ===');
            console.log('Alpine.js:', typeof Alpine !== 'undefined');
            console.log('NTEE_CODES:', typeof NTEE_CODES !== 'undefined');
            console.log('GOVERNMENT_CRITERIA:', typeof GOVERNMENT_CRITERIA !== 'undefined');
            console.log('modalComponent:', typeof modalComponent !== 'undefined');
        }, 2000);
    </script>
</body>
</html>
