[tool]
name = "ProPublica API Enrichment Tool"
version = "1.0.0"
description = "ProPublica API-only enrichment for organization profiles - 12-Factor Agents implementation"
intent = "api_enrichment"
framework = "12-factor-agents"
integration_type = "catalynx_tool"

[tool.capabilities]
primary = "api_enrichment"
secondary = ["organization_profiles", "filing_summaries", "mission_data", "similar_orgs"]
data_sources = ["propublica_api"]

[tool.input]
type = "ProPublicaAPIEnrichmentCriteria"
schema = "baml_src/propublica_api_enrichment.baml"
validation = "strict"
natural_language = false

[tool.output]
type = "ProPublicaAPIResult"
schema = "baml_src/propublica_api_enrichment.baml"
format = "structured"
metadata_included = true

[tool.dependencies]
database = "none"
cache = "optional"
llm = "none"
external_apis = ["propublica_nonprofit_explorer"]

[tool.integration]
catalynx_database = "data/nonprofit_intelligence.db"
existing_processors = ["propublica_fetch"]
comparison_benchmarks = true
migration_pathway = "gradual_replacement"

[tool.performance]
max_concurrent = 1
timeout_seconds = 30
cache_ttl = 86400
max_results = 50
target_response_time_ms = 500
memory_limit_mb = 256

[tool.12factors]
# Human Layer 12-Factor Agents Framework Implementation
# https://github.com/humanlayer/12-factor-agents

natural_language_to_tools = false      # Factor 1: Takes structured EINs from previous tools
own_prompts = true                     # Factor 2: Full control over API data processing
own_context_window = true              # Factor 3: Minimal context - API handles data retrieval
tools_as_structured_outputs = true     # Factor 4: Forces structured ProPublicaAPIResult output
unify_execution_business_state = true  # Factor 5: API enrichment unified with grant research workflows
launch_pause_resume_apis = true        # Factor 6: Simple async execute() method with rate limiting
contact_humans_tool_calls = true       # Factor 7: Provides human-readable organization profiles
control_flow_management = true         # Factor 8: Explicit control over API calls and data enrichment
compact_error_handling = true          # Factor 9: API errors integrated into result structure
small_focused_agents = true            # Factor 10: Single responsibility - ProPublica API only
trigger_from_anywhere = true           # Factor 11: Can be triggered from workflows or standalone
stateless_reducer_model = true         # Factor 12: Pure function - EINs → enriched profiles

[tool.factor_implementations]
# Detailed implementation of key 12-factor agents principles

factor_1_implementation = "Takes structured EIN list from Form 990 analysis tool, not natural language"
factor_2_implementation = "Complete control over ProPublica API integration and response processing"
factor_3_implementation = "Minimal context - ProPublica API provides data, not LLM context"
factor_4_implementation = "Tool forces structured ProPublicaAPIResult with guaranteed JSON format"
factor_5_implementation = "API enrichment state integrated with nonprofit grant research workflows"
factor_6_implementation = "Single async execute() method with intelligent rate limiting"
factor_7_implementation = "Results include human-readable organization profiles and descriptions"
factor_8_implementation = "Explicit flow: EINs → API calls → structured enrichment"
factor_9_implementation = "API errors and rate limits integrated into ProPublicaAPIResult"
factor_10_implementation = "Single responsibility: ProPublica API enrichment only - NO XML, NO analysis"
factor_11_implementation = "Triggered from Form 990 results, web UI, API, or workflow orchestrator"
factor_12_implementation = "Pure function: ProPublicaAPIEnrichmentCriteria → ProPublicaAPIResult"

[tool.factor_4_details]
# Factor 4: Tools as Structured Outputs - API Enrichment Implementation
structured_output_enforcement = "Guarantees ProPublicaAPIResult with organization profiles, filing summaries"
output_schema = "ProPublicaOrganizationProfile[] with mission, activities, financial summaries"
reliability_improvement = "Eliminates ProPublica API response parsing errors in production environments"
deterministic_outputs = "Consistent organization profile and filing summary structure"
tool_as_formatter = "Tool serves as API data formatter with guaranteed enrichment structure"
production_readiness = "Reliable API enrichment for production grant research workflows"

[tool.environment]
# Environment variable configuration
required_vars = []  # ProPublica API is public, no API key required
optional_vars = [
    "PROPUBLICA_CACHE_ENABLED",
    "PROPUBLICA_RATE_LIMIT_DELAY",
    "PROPUBLICA_MAX_ORGANIZATIONS",
    "PROPUBLICA_TIMEOUT_SECONDS",
    "PROPUBLICA_LOG_PERFORMANCE"
]
config_file = ".env.tool"

[tool.deployment]
# Deployment and scaling configuration
container_ready = true
health_check_endpoint = "/health"
metrics_endpoint = "/metrics"
graceful_shutdown_timeout = 10
min_instances = 1
max_instances = 2
auto_scaling = true

[tool.testing]
# Testing strategy and requirements
unit_tests = "tests/test_api_enrichment_tool.py"
integration_tests = "tests/test_propublica_integration.py"
performance_tests = "tests/test_api_performance.py"
coverage_target = 85
benchmark_existing = true

[tool.documentation]
# Documentation and examples
readme = "README.md"
api_spec = "auto_generated"
examples = "app/propublica_api_enricher.py"
architecture_comparison = true
migration_guide = true