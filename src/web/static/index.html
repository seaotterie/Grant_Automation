<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Catalynx - Grant Research Automation</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js for reactivity -->
    <script defer src="/static/alpine.min.js"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="/static/chart.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/style.css">
    
    <!-- Configure Tailwind -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Alpine.js cloaking and performance optimizations -->
    <style>
        [x-cloak] { display: none !important; }
        
        /* Prevent layout shift during loading */
        .sidebar-placeholder { min-height: 100vh; width: 320px; }
        .content-placeholder { min-height: 50vh; }
        
        /* Optimize animations for performance */
        * { 
            will-change: auto; 
        }
        .fade-in, .slide-up, .card-hover { 
            contain: layout style; 
        }
        
        /* Reduce repaints during scrolling */
        .custom-scrollbar { 
            contain: layout;
            transform: translateZ(0);
        }
        
        /* Common component patterns - reduces CSS redundancy */
        .card-base {
            @apply bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700;
        }
        
        .card-content {
            @apply card-base p-4;
        }
        
        .card-elevated {
            @apply card-base shadow-lg;
        }
        
        .status-badge {
            @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium;
        }
        
        .status-success {
            @apply status-badge bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100;
        }
        
        .status-warning {
            @apply status-badge bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100;
        }
        
        .status-error {
            @apply status-badge bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100;
        }
        
        .status-info {
            @apply status-badge bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100;
        }
        
        .btn-base {
            @apply inline-flex items-center px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed;
        }
        
        .btn-primary {
            @apply btn-base bg-indigo-600 hover:bg-indigo-700 text-white focus:ring-indigo-500;
        }
        
        .btn-secondary {
            @apply btn-base bg-gray-600 hover:bg-gray-700 text-white focus:ring-gray-500;
        }
        
        .modal-tab {
            @apply flex items-center space-x-2 px-4 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap relative;
        }
        
        .gradient-card {
            @apply rounded-lg border p-4;
        }
        
        .gradient-discover {
            @apply gradient-card bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-200 dark:border-green-800;
        }
        
        .gradient-plan {
            @apply gradient-card bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border-yellow-200 dark:border-yellow-800;
        }
        
        .gradient-analyze {
            @apply gradient-card bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 border-purple-200 dark:border-purple-800;
        }
        
        .gradient-examine {
            @apply gradient-card bg-gradient-to-r from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 border-red-200 dark:border-red-800;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-sans antialiased transition-colors duration-300 flex flex-col min-h-screen" x-data="catalynxApp()" x-cloak>
    
    <!-- Enhanced Notification System -->
    <div class="fixed top-4 right-4 z-50 space-y-2" x-show="notifications.length > 0">
        <template x-for="notification in notifications" :key="notification.id">
            <div x-show="notification.visible" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-x-full"
                 x-transition:enter-end="opacity-100 transform translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-x-0"
                 x-transition:leave-end="opacity-0 transform translate-x-full"
                 class="bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 max-w-sm"
                 :class="{
                     'border-l-4 border-l-green-500': notification.type === 'success',
                     'border-l-4 border-l-red-500': notification.type === 'error', 
                     'border-l-4 border-l-yellow-500': notification.type === 'warning',
                     'border-l-4 border-l-blue-500': notification.type === 'info'
                 }">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center">
                            <span x-show="notification.type === 'success'" class="text-green-500 mr-2">‚úì</span>
                            <span x-show="notification.type === 'error'" class="text-red-500 mr-2">‚úó</span>
                            <span x-show="notification.type === 'warning'" class="text-yellow-500 mr-2">‚ö†</span>
                            <span x-show="notification.type === 'info'" class="text-blue-500 mr-2">‚Ñπ</span>
                            <h4 class="font-medium text-gray-900 dark:text-white" x-text="notification.title"></h4>
                        </div>
                        <p class="mt-1 text-sm text-gray-600 dark:text-gray-300" x-text="notification.message"></p>
                    </div>
                    <button @click="dismissNotification(notification.id)" 
                            class="ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </template>
    </div>
    
    <!-- SECTION 1: Header -->
    <header class="flex-shrink-0">
        <!-- Mobile Header (kept for compatibility) -->
        <div class="lg:hidden bg-gray-900 dark:bg-gray-800 text-white px-4 py-3 flex items-center justify-between">
            <button @click="mobileMenuOpen = !mobileMenuOpen" class="text-gray-300 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            <h1 class="text-lg font-semibold">Catalynx</h1>
            <button @click="darkMode = !darkMode" class="text-gray-300 hover:text-white">
                <svg x-show="!darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
                <svg x-show="darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- SECTION 2: Main Content Area (2-Column Layout) -->
    <div class="flex-1 flex">
        
        <!-- Mobile Menu Overlay -->
        <div x-show="mobileMenuOpen" x-transition class="fixed inset-0 z-50 lg:hidden">
            <div class="fixed inset-0 bg-black bg-opacity-50" @click="mobileMenuOpen = false"></div>
            <div class="fixed left-0 top-0 h-full w-80 bg-gray-900 dark:bg-gray-800 shadow-xl overflow-y-auto">
                <div class="p-4">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-white">Menu</h2>
                        <button @click="mobileMenuOpen = false" class="text-gray-300 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <!-- Mobile navigation content will mirror desktop sidebar -->
                </div>
            </div>
        </div>
        
        <!-- Desktop Sidebar Navigation -->
        <aside class="hidden lg:block bg-gray-900 dark:bg-gray-800 text-white w-80 flex-shrink-0 transition-colors duration-300">
            <!-- Logo Header -->
            <div class="p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-xl font-bold flex items-center justify-center">
                            <img src="/static/CatalynxLogo.png" alt="Catalynx" class="h-10 mr-3">
                            <span class="font-bold text-xl">CATALYNX</span>
                        </h1>
                    </div>
                    
                    <!-- Dark Mode Toggle -->
                    <button @click="toggleDarkMode()" 
                            class="p-2 rounded-lg hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors"
                            :title="darkMode ? 'Switch to light mode' : 'Switch to dark mode'">
                        <span x-show="!darkMode" class="text-lg">üåô</span>
                        <span x-show="darkMode" class="text-lg">‚òÄÔ∏è</span>
                    </button>
                </div>
            </div>
            
            <!-- Workflow-Based Navigation -->
            <nav class="mt-6">

                <!-- Stage 0: WELCOME (Getting Started) -->
                <div class="px-2 mb-4 relative">
                    <a href="#" @click.prevent="switchStage('welcome')"
                       :class="{'bg-indigo-600 text-white shadow-lg': activeStage === 'welcome', 'text-gray-300 hover:bg-gray-700 hover:text-white border-indigo-500/30': activeStage !== 'welcome'}"
                       class="block px-6 py-8 text-2xl font-bold rounded-lg transition-all border">
                        WELCOME
                    </a>
                </div>

                <!-- Stage 1: PROFILER (Central Hub) -->
                <div class="px-2 mb-4 relative">
                    <a href="#" @click.prevent="switchStage('profiler')"
                       :class="{'bg-purple-600 text-white shadow-lg': activeStage === 'profiler', 'text-gray-300 hover:bg-gray-700 hover:text-white border-purple-500/30': activeStage !== 'profiler'}"
                       class="block px-6 py-8 text-2xl font-bold rounded-lg transition-all border">
                        PROFILER
                    </a>
                </div>

                <!-- Stage 2: DISCOVER (PROSPECTS) -->
                <div class="px-2 mb-4 relative">
                    <a href="#" @click.prevent="switchStage('discover')"
                       :class="{'bg-teal-600 text-white shadow-lg': activeStage === 'discover', 'text-gray-300 hover:bg-gray-700 hover:text-white border-teal-500/30': activeStage !== 'discover'}"
                       class="block px-6 py-8 text-2xl font-bold rounded-lg transition-all border">
                        DISCOVER
                    </a>
                </div>

                <!-- Stage 3: PLAN (QUALIFIED PROSPECTS) -->
                <div class="px-2 mb-4 relative">
                    <a href="#" @click.prevent="switchStage('plan')"
                       :class="{'bg-yellow-600 text-white shadow-lg': activeStage === 'plan', 'text-gray-300 hover:bg-gray-700 hover:text-white border-yellow-500/30': activeStage !== 'plan'}"
                       class="block px-6 py-8 text-2xl font-bold rounded-lg transition-all border">
                        PLAN
                    </a>
                </div>

                <!-- Stage 4: ANALYZE (CANDIDATES) -->
                <div class="px-2 mb-4 relative">
                    <a href="#" @click.prevent="switchStage('analyze')"
                       :class="{'bg-orange-600 text-white shadow-lg': activeStage === 'analyze', 'text-gray-300 hover:bg-gray-700 hover:text-white border-orange-500/30': activeStage !== 'analyze'}"
                       class="block px-6 py-8 text-2xl font-bold rounded-lg transition-all border">
                        ANALYZE
                    </a>
                </div>

                <!-- Stage 5: EXAMINE (TARGETS) -->
                <div class="px-2 mb-4 relative">
                    <a href="#" @click.prevent="switchStage('examine')"
                       :class="{'bg-blue-600 text-white shadow-lg': activeStage === 'examine', 'text-gray-300 hover:bg-gray-700 hover:text-white border-blue-500/30': activeStage !== 'examine'}"
                       class="block px-6 py-8 text-2xl font-bold rounded-lg transition-all border">
                        EXAMINE
                    </a>
                </div>

                <!-- Stage 6: APPROACH (OPPORTUNITIES) -->
                <div class="px-2 mb-4 relative">
                    <a href="#" @click.prevent="switchStage('approach')"
                       :class="{'bg-green-600 text-white shadow-lg': activeStage === 'approach', 'text-gray-300 hover:bg-gray-700 hover:text-white border-green-500/30': activeStage !== 'approach'}"
                       class="block px-6 py-8 text-2xl font-bold rounded-lg transition-all border">
                        APPROACH
                    </a>
                </div>

                <!-- Stage 7: SETTINGS (System Configuration) -->
                <div class="px-2 mb-4 relative">
                    <a href="#" @click.prevent="switchStage('settings')"
                       :class="{'bg-gray-600 text-white shadow-lg': activeStage === 'settings', 'text-gray-300 hover:bg-gray-700 hover:text-white border-gray-500/30': activeStage !== 'settings'}"
                       class="block px-6 py-8 text-2xl font-bold rounded-lg transition-all border">
                        SETTINGS
                    </a>
                </div>
                
                
                <!-- Simple Footer -->
                <div class="mt-auto px-2 py-4 border-t border-gray-700">
                    <div class="text-center">
                        <div class="text-xs text-gray-400 font-medium">Catalynx</div>
                        <div class="text-xs text-gray-500 mt-1">Opportunity Intelligence Platform</div>
                    </div>
                </div>
            </nav>
        </aside>
        
        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col overflow-auto">
            
            <!-- Top Bar with Enhanced Navigation -->
            <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 lg:px-6 py-3 lg:py-4 transition-colors duration-300">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        
                        <!-- Stage Title and Description -->
                        <div>
                            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white flex items-center">
                                <span x-text="getPageTitle()"></span>
                                <span x-show="getWorkflowCompletionPercentage() > 0" 
                                      class="ml-3 text-sm bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full"
                                      x-text="getWorkflowCompletionPercentage() + '% Complete'"></span>
                            </h2>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mt-1" x-text="getPageDescription()"></p>
                        </div>
                    </div>
                    
                    <!-- Global Search Bar -->
                    <div class="flex-1 max-w-lg mx-8">
                        <div class="relative">
                            <input type="text" 
                                   x-model="globalSearchQuery"
                                   @keyup.enter="performGlobalSearch()"
                                   placeholder="Search profiles, organizations, workflows..."
                                   class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 pl-10 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <button @click="openAdvancedFilters()" 
                                    class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Enhanced System Status Indicators -->
                    <div class="flex items-center space-x-6">
                        <!-- Overall System Health -->
                        <div class="flex items-center">
                            <div :class="systemStatus === 'healthy' ? 'bg-green-400 animate-pulse' : systemStatus === 'warning' ? 'bg-yellow-400 animate-pulse' : 'bg-red-400 animate-pulse'" 
                                 class="w-3 h-3 rounded-full mr-2"></div>
                            <div class="text-sm">
                                <div class="text-gray-900 dark:text-white font-medium" x-text="getSystemStatusText()"></div>
                                <div class="text-gray-500 dark:text-gray-400 text-xs" x-text="systemInfo.uptime || 'Unknown uptime'"></div>
                            </div>
                        </div>
                        
                        <!-- API Status -->
                        <div class="flex items-center">
                            <div :class="apiStatus === 'healthy' ? 'bg-green-400' : apiStatus === 'slow' ? 'bg-yellow-400' : 'bg-red-400'" 
                                 class="w-2 h-2 rounded-full mr-2"></div>
                            <div class="text-sm">
                                <div class="text-gray-600 dark:text-gray-300">API</div>
                                <div class="text-gray-500 dark:text-gray-400 text-xs" x-text="getApiStatusText()"></div>
                            </div>
                        </div>
                        
                        <!-- Processing Queue -->
                        <div class="flex items-center" x-show="activeWorkflows > 0">
                            <div class="w-2 h-2 bg-blue-400 rounded-full mr-2 animate-pulse"></div>
                            <div class="text-sm">
                                <div class="text-gray-600 dark:text-gray-300">Processing</div>
                                <div class="text-gray-500 dark:text-gray-400 text-xs" x-text="`${activeWorkflows} active`"></div>
                            </div>
                        </div>
                        
                        <!-- Notifications -->
                        <div class="relative">
                            <button @click="collaborationModalOpen = true" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 relative">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5V7H9v10z"></path>
                                </svg>
                                <span x-show="getUnreadNotifications().length > 0" 
                                      class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center"
                                      x-text="getUnreadNotifications().length"></span>
                            </button>
                        </div>

                        <!-- Live Clock -->
                        <div class="text-sm text-gray-500 dark:text-gray-400 border-l border-gray-300 dark:border-gray-600 pl-4">
                            <div x-text="currentTime"></div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Stage Content Container -->
            <div class="flex-1 p-4 lg:p-6 bg-gray-50 dark:bg-gray-900 transition-colors duration-300 overflow-auto relative">
                
                <!-- STAGE 0: WELCOME (Getting Started) -->
                <div x-show="activeStage === 'welcome'" class="space-y-6">
                    <!-- Welcome Header -->
                    <div class="bg-gray-100 dark:bg-gray-900 p-6">
                        <div class="text-center">
                            <!-- Massive Catalynx Logo -->
                            <div class="w-96 h-96 mx-auto mb-8 mt-6 flex items-center justify-center">
                                <img src="/static/CatalynxLogo.png" 
                                     alt="Catalynx Logo" 
                                     class="w-96 h-96 object-contain"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <!-- Fallback if logo not found -->
                                <div class="w-96 h-96 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center text-white hidden text-[12rem]">
                                    C
                                </div>
                            </div>
                            
                            <h1 class="text-5xl font-bold text-white mb-4">Welcome to Catalynx</h1>
                            <p class="text-xl text-white/90 mb-12">Comprehensive Opportunity Intelligence & Network Analysis</p>
                            
                            <!-- Simple Getting Started Actions -->
                            <div class="space-y-6">
                                <button @click="switchStage('profiler')" 
                                        class="btn-brand-primary w-96 px-8 py-4 rounded-lg transition-colors font-medium text-xl hover:opacity-90">
                                    Get Started
                                </button>
                                <div class="text-center">
                                    <button @click="showQuickTutorial()" 
                                            class="text-white/90 hover:text-white text-lg underline">
                                        Quick Tutorial
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <!-- STAGE 1: PROFILER (Profile Management) -->
                <div x-show="activeStage === 'profiler'" class="space-y-6">
                    <!-- Profiler Header -->
                    <div class="bg-gradient-to-r from-purple-600 to-teal-600 rounded-lg p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-2xl font-bold">Organization Profiles <span class="text-lg font-normal">- Create and manage organization profiles for opportunity discovery</span></h3>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Button Bar -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                        <div class="flex flex-wrap items-center gap-4">
                            <!-- Create Profile Button -->
                            <button @click="showProfileModal = true; isEditingProfile = false; resetProfileForm()"
                                    class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors font-medium flex items-center gap-2">
                                <span class="text-lg">+</span>
                                Create Profile
                            </button>
                            
                            
                            <!-- Search Input -->
                            <div class="flex-grow max-w-md">
                                <input type="text" 
                                       x-model="profileSearchTerm"
                                       @input="filterProfiles()"
                                       placeholder="Search profiles by name, EIN, or focus areas..."
                                       class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                            </div>
                            
                            <!-- Profile Count -->
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                <span x-text="(filteredProfiles || []).length"></span> profiles
                            </div>
                        </div>
                    </div>
                    
                    <!-- Profile Table -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                        <!-- Table Header with Action Buttons -->
                        <div class="px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600 flex items-center justify-between">
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Organization Profiles</h4>
                            
                            <!-- Action Buttons -->
                            <div x-show="filteredProfiles.length > 0" class="flex space-x-3">
                                <button @click="selectedProfile && editProfile(selectedProfile)" 
                                        :disabled="!selectedProfile"
                                        :class="!selectedProfile ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                        class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center text-sm bg-blue-600 hover:bg-blue-700 text-white shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                    </svg>
                                    Edit
                                </button>
                                <button @click="selectedProfile && deleteProfile(selectedProfile?.profile_id)" 
                                        :disabled="!selectedProfile"
                                        :class="!selectedProfile ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                        class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center text-sm bg-red-600 hover:bg-red-700 text-white shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                    </svg>
                                    Delete
                                </button>
                                <button @click="selectedProfile && selectProfileForDiscovery(selectedProfile)" 
                                        :disabled="!selectedProfile"
                                        :class="!selectedProfile ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                        class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center text-sm bg-green-600 hover:bg-green-700 text-white shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                    </svg>
                                    Discover
                                </button>
                            </div>
                        </div>
                        
                        <!-- Table Content -->
                        <div class="overflow-x-auto">
                            <div class="max-h-[600px] overflow-y-auto">
                                <!-- Loading State -->
                                <div x-show="profilesLoading" class="p-8 text-center text-gray-500 dark:text-gray-400">
                                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-4"></div>
                                    Loading profiles...
                                </div>
                                
                                <!-- Empty State -->
                                <div x-show="!profilesLoading && filteredProfiles.length === 0" 
                                     class="p-8 text-center text-gray-500 dark:text-gray-400">
                                    <div class="text-4xl mb-4">üìã</div>
                                    <p class="text-lg font-medium mb-2">No profiles found</p>
                                    <p class="text-sm mb-4">Create your first organization profile to get started</p>
                                    <button @click="showProfileModal = true; isEditingProfile = false; resetProfileForm()"
                                            class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                                        Create Profile
                                    </button>
                                </div>
                                
                                <!-- Profiles Table with Discovery Column -->
                                <table x-show="!profilesLoading && filteredProfiles.length > 0" class="w-full">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Organization Name</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">EIN</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Type</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Opportunities</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Last Discovery</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="profile in (filteredProfiles || [])" :key="`main-profile-${profile.profile_id}`">
                                            <tr class="cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border-l-4"
                                                :class="selectedProfile?.profile_id === profile.profile_id ? 'profile-row-selected' : 'profile-row-selectable border-l-transparent'"
                                                x-init="$nextTick(() => { if ($data.addProfileContextMenu && typeof $data.addProfileContextMenu === 'function') $data.addProfileContextMenu($el, profile); })"
                                                @click="selectedProfile = profile">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="profile.name"></div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="profile.ein || 'No EIN'"></div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                          :class="getOrganizationTypeColor(profile.organization_type)"
                                                          x-text="profile.organization_type"></span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                                    <span x-text="profile.opportunities_count || 0"></span> leads
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                          :class="profile.status === 'active' ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 'bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200'"
                                                          x-text="profile.status || 'draft'"></span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="text-sm text-gray-900 dark:text-white"
                                                          x-text="profile.last_discovery_date ? new Date(profile.last_discovery_date).toLocaleDateString() : 'Not run'"></span>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                                
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 2: DISCOVER (Multi-Track Discovery) -->
                <div x-show="activeStage === 'discover'" class="space-y-6">
                    <!-- Prospects Discovery Header -->
                    <div class="bg-gradient-to-r from-teal-600 to-yellow-500 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Prospects Discovery <span class="text-lg font-normal">- Initial broad discovery and filtering across all funding sources</span></h3>
                    </div>

                    <!-- Profile Intelligence Center -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        
                        <!-- Profile Intelligence Center Header -->
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-xl font-semibold text-gray-900 dark:text-white">Profile Intelligence Center</h4>
                            <div x-show="selectedDiscoveryProfile" class="text-sm text-gray-600 dark:text-gray-400">
                                Selected: <span x-text="selectedDiscoveryProfile?.name" class="font-medium text-gray-900 dark:text-white"></span>
                            </div>
                        </div>

                        <!-- Current Profile Information -->
                        <div x-show="selectedDiscoveryProfile" class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-l-4 border-primary-500">
                            <div class="flex items-center justify-between mb-3">
                                <h5 class="font-semibold text-gray-900 dark:text-white">Current Profile</h5>
                                <div class="flex space-x-2">
                                    <button @click="selectedDiscoveryProfile = null" class="px-2 py-1 text-xs bg-gray-500 hover:bg-gray-600 text-white rounded">
                                        Close Profile
                                    </button>
                                    <button @click="switchStage('profiler')" class="px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded">
                                        Select Profile
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-4 gap-3">
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Organization</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedDiscoveryProfile?.name">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">EIN</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedDiscoveryProfile?.ein || 'Not Available'">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Discovery Status</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedDiscoveryProfile?.last_discovery_date ? formatDate(selectedDiscoveryProfile.last_discovery_date) : 'Not Run'">Not Run</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Current Opportunities</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedDiscoveryProfile?.opportunities_count || 0">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- No Profile Selected State -->
                        <div x-show="!selectedDiscoveryProfile" class="mb-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h5 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">No Profile Selected</h5>
                                    <p class="text-xs text-yellow-700 dark:text-yellow-300 mt-1">Select an organization profile from the Profiler tab to start discovery.</p>
                                    <button @click="switchStage('profiler')" class="mt-2 text-xs bg-yellow-100 dark:bg-yellow-800 hover:bg-yellow-200 dark:hover:bg-yellow-700 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded">
                                        Go to Profiler
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Discovery Tracks -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-blue-900 dark:text-blue-100">Nonprofits</h5>
                                    <button @click="runDiscoveryTrack('nonprofit')" 
                                            :disabled="isTrackRunning('nonprofit')"
                                            :class="getTrackButtonClass('nonprofit')"
                                            x-text="getTrackButtonText('nonprofit')">
                                    </button>
                                </div>
                                <p class="text-sm text-blue-700 dark:text-blue-300">NTEE + BMF + 990 data</p>
                                <!-- Enhanced Progress Indicator -->
                                <div x-show="isTrackRunning('nonprofit')" class="mt-2 text-xs text-blue-600 dark:text-blue-400">
                                    <div class="flex items-center space-x-2">
                                        <div class="animate-spin h-3 w-3 border border-blue-600 border-t-transparent rounded-full"></div>
                                        <span x-text="enhancedDiscoveryProgress.nonprofit.message"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-green-900 dark:text-green-100">Federal Grants</h5>
                                    <button @click="runDiscoveryTrack('federal')" 
                                            :disabled="isTrackRunning('federal')"
                                            :class="getTrackButtonClass('federal')"
                                            x-text="getTrackButtonText('federal')">
                                    </button>
                                </div>
                                <p class="text-sm text-green-700 dark:text-green-300">Grants.gov opportunities</p>
                                <!-- Enhanced Progress Indicator -->
                                <div x-show="isTrackRunning('federal')" class="mt-2 text-xs text-green-600 dark:text-green-400">
                                    <div class="flex items-center space-x-2">
                                        <div class="animate-spin h-3 w-3 border border-green-600 border-t-transparent rounded-full"></div>
                                        <span x-text="enhancedDiscoveryProgress.federal.message"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-purple-900 dark:text-purple-100">State Agencies</h5>
                                    <button @click="runDiscoveryTrack('state')" 
                                            :disabled="isTrackRunning('state')"
                                            :class="getTrackButtonClass('state')"
                                            x-text="getTrackButtonText('state')">
                                    </button>
                                </div>
                                <p class="text-sm text-purple-700 dark:text-purple-300">Virginia state grants</p>
                                <!-- Enhanced Progress Indicator -->
                                <div x-show="isTrackRunning('state')" class="mt-2 text-xs text-purple-600 dark:text-purple-400">
                                    <div class="flex items-center space-x-2">
                                        <div class="animate-spin h-3 w-3 border border-purple-600 border-t-transparent rounded-full"></div>
                                        <span x-text="enhancedDiscoveryProgress.state.message"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-orange-900 dark:text-orange-100">Commercial</h5>
                                    <button @click="runDiscoveryTrack('commercial')" 
                                            :disabled="isTrackRunning('commercial')"
                                            :class="getTrackButtonClass('commercial')"
                                            x-text="getTrackButtonText('commercial')">
                                    </button>
                                </div>
                                <p class="text-sm text-orange-700 dark:text-orange-300">Corporate foundations</p>
                                <!-- Enhanced Progress Indicator -->
                                <div x-show="isTrackRunning('commercial')" class="mt-2 text-xs text-orange-600 dark:text-orange-400">
                                    <div class="flex items-center space-x-2">
                                        <div class="animate-spin h-3 w-3 border border-orange-600 border-t-transparent rounded-full"></div>
                                        <span x-text="enhancedDiscoveryProgress.commercial.message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Main Action Buttons -->
                        <div class="flex justify-center gap-3">
                            <button @click="runEnhancedAllTracks()" 
                                    :disabled="unifiedDiscoveryInProgress"
                                    class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-md text-sm font-medium transition-colors"
                                    :class="unifiedDiscoveryInProgress ? 'opacity-50 cursor-not-allowed' : ''">
                                <span x-show="!unifiedDiscoveryInProgress">Run All Tracks</span>
                                <span x-show="unifiedDiscoveryInProgress">Running...</span>
                            </button>
                            <button @click="viewDiscoveryResults()" 
                                    :disabled="discoveryStats.totalResults === 0"
                                    class="bg-green-100 dark:bg-green-700 hover:bg-green-200 dark:hover:bg-green-600 text-green-700 dark:text-green-300 px-4 py-2 rounded-md text-sm transition-colors"
                                    :class="discoveryStats.totalResults === 0 ? 'opacity-50 cursor-not-allowed' : ''">
                                View Recent Results
                            </button>
                            <button @click="openDiscoveryConfiguration()" 
                                    class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm transition-colors">
                                Configure Settings
                            </button>
                        </div>
                    </div>
                    
                    
                    <!-- Prospects Results Table -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg" x-show="true">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Discovery Results</h4>
                                <div class="flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400">
                                    <span x-text="`${discoverData?.length || 0} opportunities found`">0 opportunities found</span>
                                    <!-- Score Distribution Summary -->
                                    <template x-if="discoverData && discoverData.length > 0">
                                        <div class="flex items-center space-x-3">
                                            <span class="inline-flex items-center">
                                                <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                                                <span x-text="`${discoverData.filter(p => getOpportunityScore(p) >= 0.75).length} Auto-Promote`"></span>
                                            </span>
                                            <span class="inline-flex items-center">
                                                <div class="w-2 h-2 bg-yellow-500 rounded-full mr-1"></div>
                                                <span x-text="`${discoverData.filter(p => getOpportunityScore(p) >= 0.60 && getOpportunityScore(p) < 0.75).length} Review`"></span>
                                            </span>
                                            <span class="inline-flex items-center">
                                                <div class="w-2 h-2 bg-orange-500 rounded-full mr-1"></div>
                                                <span x-text="`${discoverData.filter(p => getOpportunityScore(p) >= 0.45 && getOpportunityScore(p) < 0.60).length} Needs Work`"></span>
                                            </span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 flex-wrap">
                                <!-- Score Sort -->
                                <select class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" x-model="scoreSortOrder" @change="sortOpportunitiesByScore()">
                                    <option value="">Default Order</option>
                                    <option value="score_desc">üî• Highest Score First</option>
                                    <option value="score_asc">üìä Lowest Score First</option>
                                    <option value="promotion_ready">‚¨ÜÔ∏è Promotion Ready</option>
                                </select>

                                <!-- Stage Filter - Dynamic based on current tab -->
                                <div class="flex items-center space-x-2">
                                    <select class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                           x-model="discoveryStageFilter"
                                           @change="updateDiscoverData()">
                                        <option value="">All Stages</option>
                                        <option value="prospects">#1 Prospects</option>
                                        <option value="qualified">#2 Qualified</option>
                                        <option value="candidates">#3 Candidates</option>
                                        <option value="targets">#4 Targets</option>
                                        <option value="opportunities">#5 Opportunities</option>
                                    </select>
                                    <!-- Filter Status Badge -->
                                    <span x-show="discoveryStageFilter" 
                                          x-text="'Filtered: ' + (discoveryStageFilter ? discoverData.length : 0) + ' records'"
                                          class="bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200 px-2 py-1 rounded-full text-xs font-medium">
                                    </span>
                                </div>
                                
                                <!-- Foundation Type Filter -->
                                <select class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" x-model="foundationTypeFilter">
                                    <option value="">Show all</option>
                                    <option value="private_non_operating">Private Foundations (990-PF)</option>
                                    <option value="private_operating">Private Operating Foundations</option>
                                    <option value="public_charity">Public Charities (990)</option>
                                    <option value="supporting_organization">Supporting Organizations</option>
                                    <option value="donor_advised_fund">Donor Advised Funds</option>
                                </select>
                                
                                <!-- Foundation Application Filter -->
                                <select class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" x-model="applicationStatusFilter">
                                    <option value="">Show all</option>
                                    <option value="accepts_applications">‚úÖ Accepts Applications</option>
                                    <option value="invitation_only">üì® Invitation Only</option>
                                    <option value="no_applications">‚ùå No Applications</option>
                                    <option value="unknown">‚ùì Unknown Status</option>
                                </select>
                                <!-- Refresh Button -->
                                <button @click="refreshDiscoveryResults()" class="bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-1 rounded-md text-sm">
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto max-h-96 overflow-y-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700"
                                            @click="sortTable('organization_name')">
                                            <div class="flex items-center justify-between">
                                                <span>Organization Name</span>
                                                <span class="ml-1 text-gray-400" x-show="sortColumn === 'organization_name'" x-text="sortDirection === 'asc' ? '‚Üë' : '‚Üì'"></span>
                                            </div>
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Stage</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            <div class="flex items-center space-x-1">
                                                <span>Score</span>
                                                <button @click="toggleScoreSort()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">App Status</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">990 Grantee</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Source</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Funding</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Error Boundary: Show message if discoverData fails -->
                                    <template x-if="!discoverData || discoverData.length === 0">
                                        <tr>
                                            <td colspan="7" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                                                <div class="flex flex-col items-center space-y-2">
                                                    <div x-show="discoverData === undefined">
                                                        <span class="text-red-600 dark:text-red-400">‚ö†Ô∏è Error loading opportunities data</span>
                                                        <button @click="location.reload()" class="ml-2 text-blue-600 hover:text-blue-800 underline">Retry</button>
                                                    </div>
                                                    <div x-show="discoverData && discoverData.length === 0">
                                                        <span>No opportunities found for this profile</span>
                                                        <div class="text-sm mt-1">Run discovery to find new opportunities</div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                    
                                    <!-- Enhanced table with virtual scrolling and pagination -->
                                    <template x-for="(prospect, index) in (typeof getPaginatedData === 'function' ? getPaginatedData(discoverData) : discoverData || [])" :key="`prospect_row_${index}`">
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700" x-show="prospect">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center space-x-2">
                                                <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="prospect?.organization_name || '[Organization Name Missing]'"></div>
                                                <!-- 990-PF Foundation Indicator -->
                                                <span x-show="prospect?.form_type === '990-PF' || prospect?.foundation_code === '03'" 
                                                      class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 dark:from-purple-900/20 dark:to-pink-900/20 dark:text-purple-300 border border-purple-200 dark:border-purple-700"
                                                      title="Private Foundation (990-PF) - High Grant Research Value">
                                                    PF
                                                </span>
                                                <!-- Accepts Applications Indicator -->
                                                <span x-show="prospect?.accepts_unsolicited_applications" 
                                                      class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300 border border-green-200 dark:border-green-700"
                                                      title="Accepts Applications">
                                                    Apps
                                                </span>
                                            </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium rounded-full" 
                                                      :class="getStageColor(getActualStage(prospect))"
                                                      x-text="formatStageWithNumber(getActualStage(prospect))">
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium rounded-full" 
                                                      :class="getOrganizationTypeColor(prospect.organization_type || prospect.source_type || 'Nonprofit')"
                                                      x-text="prospect.organization_type || prospect.source_type || 'Nonprofit'"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex flex-col space-y-1">
                                                    <!-- Score Bar and Percentage -->
                                                    <div class="flex items-center">
                                                        <!-- Promotion Ready Indicator (Updated threshold to 75%) -->
                                                        <div x-show="getOpportunityScore(prospect) >= 0.75" class="mr-1" title="Auto-Promotion Ready (Score ‚â• 75%)">
                                                            <span class="inline-flex items-center">
                                                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                                            </span>
                                                        </div>
                                                        <!-- Recently Promoted Indicator -->
                                                        <div x-show="prospect?.match_factors?.auto_promoted" class="mr-1" title="Recently Auto-Promoted">
                                                            <span class="inline-flex items-center">
                                                                <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                                            </span>
                                                        </div>
                                                        <div x-show="getOpportunityScore(prospect) >= 0.60 && getOpportunityScore(prospect) < 0.75" class="mr-1" title="Review for Promotion (Score 60-74%)">
                                                            <span class="inline-flex items-center">
                                                                <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                                            </span>
                                                        </div>
                                                        
                                                        <!-- Score Progress Bar -->
                                                        <div class="progress-container w-16 mr-2" style="--progress-height: 0.5rem;">
                                                            <div class="progress-bar" 
                                                                 :class="getScoreColor(getOpportunityScore(prospect))"
                                                                 :style="`--progress-width: ${(getOpportunityScore(prospect) * 100)}%`"></div>
                                                        </div>
                                                        
                                                        <!-- Score Percentage -->
                                                        <span class="text-sm font-medium" 
                                                              :class="getScoreTextColor(getOpportunityScore(prospect))" 
                                                              x-text="(getOpportunityScore(prospect) * 100).toFixed(1) + '%'"></span>
                                                    </div>
                                                    
                                                    <!-- Enhanced Data Indicator Only -->
                                                    <div class="text-xs">
                                                        <span x-show="prospect?.enhanced_data_score" class="px-1 py-0.5 bg-blue-100 text-blue-800 rounded text-xs" title="Enhanced with 990 Data">
                                                            990+
                                                        </span>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-3 whitespace-nowrap text-center">
                                                <!-- Application Status Icons -->
                                                <span x-show="prospect?.application_status === 'open'" 
                                                      class="text-green-600 dark:text-green-400" 
                                                      title="Open for Applications">Open</span>
                                                <span x-show="prospect?.application_status === 'pending'" 
                                                      class="text-yellow-600 dark:text-yellow-400" 
                                                      title="Application Pending">Pending</span>
                                                <span x-show="prospect?.application_status === 'closed'" 
                                                      class="text-red-600 dark:text-red-400" 
                                                      title="Applications Closed">Closed</span>
                                                <span x-show="prospect?.application_status === 'deadline'" 
                                                      class="text-orange-600 dark:text-orange-400" 
                                                      title="Deadline Approaching">Deadline</span>
                                                <span x-show="!prospect?.application_status" 
                                                      class="text-gray-400 dark:text-gray-500" 
                                                      title="Status Unknown">Unknown</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div x-show="prospect?.is_schedule_i_grantee" class="flex items-center">
                                                    <span class="inline-flex items-center px-1.5 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 border border-yellow-200 rounded dark:bg-yellow-800 dark:text-yellow-200 dark:border-yellow-700">
                                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                                        </svg>
                                                        990 Grantee
                                                    </span>
                                                </div>
                                                <div x-show="!prospect?.is_schedule_i_grantee" class="text-xs text-gray-400">-</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="text-sm text-gray-900 dark:text-white" x-text="prospect?.discovery_source || prospect?.source_type || 'Unknown'"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="text-sm text-gray-900 dark:text-white" x-text="prospect?.funding_amount ? '$' + prospect.funding_amount.toLocaleString() : 'Unknown'"></span>
                                            </td>
                                            <td class="px-6 py-3 whitespace-nowrap text-sm font-medium space-x-2">
                                                <div class="flex items-center space-x-2">
                                                    <button @click="openOpportunityModal(prospect, 'discover')" 
                                                            class="px-3 py-1 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md transition-colors">View Details</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Enhanced Pagination Controls for DISCOVER -->
                        <div x-show="discoverData && discoverData.length > itemsPerPage" class="flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                            <div class="flex items-center text-sm text-gray-700 dark:text-gray-300">
                                <span>Showing </span>
                                <span class="font-medium" x-text="((currentPage - 1) * itemsPerPage) + 1"></span>
                                <span> to </span>
                                <span class="font-medium" x-text="Math.min(currentPage * itemsPerPage, discoverData.length)"></span>
                                <span> of </span>
                                <span class="font-medium" x-text="discoverData.length"></span>
                                <span> results</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button @click="prevPage()" :disabled="currentPage === 1" 
                                        class="px-3 py-1 text-sm font-medium text-gray-500 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                    Previous
                                </button>
                                <template x-for="page in Array.from({length: typeof getTotalPages === 'function' ? getTotalPages(discoverData) : 1}, (_, i) => i + 1)" :key="page">
                                    <button @click="goToPage(page)" 
                                            :class="currentPage === page ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'"
                                            class="px-3 py-1 text-sm font-medium border border-gray-300 rounded-md transition-colors">
                                        <span x-text="page"></span>
                                    </button>
                                </template>
                                <button @click="nextPage(discoverData)" :disabled="currentPage === (typeof getTotalPages === 'function' ? getTotalPages(discoverData) : 1)" 
                                        class="px-3 py-1 text-sm font-medium text-gray-500 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                    Next
                                </button>
                            </div>
                        </div>
                        
                        <!-- Empty State -->
                        <div x-show="!planData || planData.length === 0" class="text-center py-12">
                            <div class="text-gray-400 dark:text-gray-600">
                                <svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No prospects found</h3>
                                <p class="text-gray-500 dark:text-gray-400">Start discovery to find potential funding opportunities</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 3: PLAN (QUALIFIED PROSPECTS) -->
                <div x-show="activeStage === 'plan'" class="space-y-6">
                    <!-- Strategic Planning Header -->
                    <div class="bg-gradient-to-r from-yellow-600 to-orange-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Strategic Planning <span class="text-lg font-normal">- AI-powered analysis and strategic insights for optimal decision-making</span></h3>
                    </div>

                    <!-- Profile Intelligence Center -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        
                        <!-- Profile Intelligence Center Header -->
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-xl font-semibold text-gray-900 dark:text-white">Profile Intelligence Center</h4>
                            <div x-show="selectedPlanProfile" class="text-sm text-gray-600 dark:text-gray-400">
                                Selected: <span x-text="selectedPlanProfile?.name" class="font-medium text-gray-900 dark:text-white"></span>
                            </div>
                        </div>

                        <!-- Current Profile Information -->
                        <div x-show="selectedPlanProfile" class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-l-4 border-orange-500">
                            <div class="mb-3">
                                <h5 class="font-semibold text-gray-900 dark:text-white">Current Profile</h5>
                            </div>
                            <div class="grid grid-cols-4 gap-3">
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Organization</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedPlanProfile?.name">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">EIN</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedPlanProfile?.ein || 'Not Available'">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Analysis Status</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedPlanProfile?.last_analysis_date ? formatDate(selectedPlanProfile.last_analysis_date) : 'Not Run'">Not Run</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Qualified Opportunities</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedPlanProfile?.qualified_opportunities_count || 0">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- No Profile Selected State -->
                        <div x-show="!selectedPlanProfile" class="mb-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h5 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">No Profile Selected</h5>
                                    <p class="text-xs text-yellow-700 dark:text-yellow-300 mt-1">Select an organization profile and run DISCOVER first to find qualified prospects for strategic planning.</p>
                                    <button @click="switchStage('discover')" class="mt-2 text-xs bg-yellow-100 dark:bg-yellow-800 hover:bg-yellow-200 dark:hover:bg-yellow-700 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded">
                                        Go to Discovery
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Analysis Action Cards - Consolidated to 2 Sections -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-blue-900 dark:text-blue-100">990 & 990-PF Analysis</h5>
                                    <button @click="start990Analysis()" 
                                            :disabled="analysisProgress.xml_990_running" 
                                            class="px-6 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!analysisProgress.xml_990_running">Run</span>
                                        <span x-show="analysisProgress.xml_990_running">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-blue-700 dark:text-blue-300">Comprehensive document processing and financial analysis</p>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-green-900 dark:text-green-100">Comprehensive AI Research</h5>
                                    <button @click="startUnifiedAIResearch()" 
                                            :disabled="analysisProgress.unified_ai_running" 
                                            class="px-6 py-2 rounded-md text-sm font-medium transition-colors bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!analysisProgress.unified_ai_running">Run</span>
                                        <span x-show="analysisProgress.unified_ai_running">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-green-700 dark:text-green-300">Unified AI-powered strategic intelligence and analysis</p>
                            </div>
                        </div>

                    </div>
                    
                    <!-- 990 & 990-PF Comprehensive Analysis Results -->
                    <div x-show="has990Data() || hasFoundationData()" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                    <span class="text-2xl mr-3">üìä</span>
                                    990 & 990-PF Analysis Dashboard
                                </h4>
                                <div class="flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400">
                                    <span x-show="has990Data()" x-text="`${get990Count()} 990 Forms`">0 990 Forms</span>
                                    <span x-show="hasFoundationData()" x-text="`${getFoundationCount()} 990-PF Forms`">0 990-PF Forms</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <!-- Form Type Overview -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- Regular 990 Analysis -->
                                <div x-show="has990Data()" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                    <h5 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                        üìã Regular 990 Analysis
                                        <span class="ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300 rounded-full" x-text="get990Count()">0</span>
                                    </h5>
                                    <div class="space-y-4">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                                <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" x-text="getScheduleICount()">0</div>
                                                <div class="text-sm font-medium text-gray-900 dark:text-white">Schedule I Found</div>
                                                <div class="text-xs text-gray-600 dark:text-gray-400">Grant recipients identified</div>
                                            </div>
                                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                                <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="formatCurrency(getTotal990Revenue())">$0</div>
                                                <div class="text-sm font-medium text-gray-900 dark:text-white">Total Revenue</div>
                                                <div class="text-xs text-gray-600 dark:text-gray-400">Across all 990 orgs</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 990-PF Foundation Analysis -->
                                <div x-show="hasFoundationData()" class="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg p-6 border border-purple-200 dark:border-purple-700">
                                    <h5 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                        üèõÔ∏è Private Foundation (990-PF) Analysis
                                        <span class="ml-2 px-2 py-1 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300 rounded-full" x-text="getFoundationCount()">0</span>
                                    </h5>
                                    <div class="space-y-4">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-purple-100 dark:border-purple-800">
                                                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" x-text="getFoundationCount('03')">0</div>
                                                <div class="text-sm font-medium text-gray-900 dark:text-white">Code 03 Foundations</div>
                                                <div class="text-xs text-gray-600 dark:text-gray-400">Private non-operating</div>
                                            </div>
                                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-green-100 dark:border-green-800">
                                                <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="getAcceptsApplicationsCount()">0</div>
                                                <div class="text-sm font-medium text-gray-900 dark:text-white">Accept Applications</div>
                                                <div class="text-xs text-gray-600 dark:text-gray-400">Open for outreach</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Detailed Analysis Tabs -->
                            <div class="border-b border-gray-200 dark:border-gray-700">
                                <nav class="-mb-px flex space-x-8">
                                    <button @click="active990Tab = 'overview'" 
                                            :class="active990Tab === 'overview' ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                                            class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                        Overview
                                    </button>
                                    <button x-show="has990Data()" @click="active990Tab = 'schedule-i'" 
                                            :class="active990Tab === 'schedule-i' ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                                            class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                        Schedule I (Grant Recipients)
                                    </button>
                                    <button x-show="hasFoundationData()" @click="active990Tab = 'foundation-intel'" 
                                            :class="active990Tab === 'foundation-intel' ? 'border-purple-500 text-purple-600 dark:text-purple-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                                            class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                        Foundation Intelligence
                                    </button>
                                    <button x-show="hasFoundationData()" @click="active990Tab = 'application-strategy'" 
                                            :class="active990Tab === 'application-strategy' ? 'border-orange-500 text-orange-600 dark:text-orange-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                                            class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                        Application Strategy
                                    </button>
                                </nav>
                            </div>
                            
                            <!-- Tab Content -->
                            <div class="mt-6">
                                <!-- Overview Tab -->
                                <div x-show="active990Tab === 'overview'" class="space-y-6">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- Financial Summary -->
                                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                            <h6 class="font-semibold text-gray-900 dark:text-white mb-4">Financial Overview</h6>
                                            <div class="space-y-4">
                                                <template x-for="org in getFinancialSummary()" :key="org.id">
                                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border">
                                                        <div class="flex items-center justify-between mb-2">
                                                            <div class="font-medium text-gray-900 dark:text-white" x-text="org.name">Organization</div>
                                                            <span :class="org.form_type === '990-PF' ? 'bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300' : 'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300'"
                                                                  class="px-2 py-1 text-xs font-medium rounded-full" x-text="org.form_type">Form</span>
                                                        </div>
                                                        <div class="grid grid-cols-2 gap-4 text-sm">
                                                            <div>
                                                                <span class="text-gray-600 dark:text-gray-400">Revenue:</span>
                                                                <div class="font-semibold text-green-600 dark:text-green-400" x-text="formatCurrency(org.revenue)">$0</div>
                                                            </div>
                                                            <div>
                                                                <span class="text-gray-600 dark:text-gray-400">Assets:</span>
                                                                <div class="font-semibold text-blue-600 dark:text-blue-400" x-text="formatCurrency(org.assets)">$0</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                        
                                        <!-- Strategic Insights -->
                                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                            <h6 class="font-semibold text-gray-900 dark:text-white mb-4">Strategic Insights</h6>
                                            <div class="space-y-3">
                                                <div class="flex items-start space-x-3">
                                                    <div class="flex-shrink-0 w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                                                    <div class="text-sm text-gray-700 dark:text-gray-300">
                                                        <span class="font-medium" x-text="getAcceptsApplicationsCount()">0</span> foundations accept direct applications
                                                    </div>
                                                </div>
                                                <div class="flex items-start space-x-3">
                                                    <div class="flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                                    <div class="text-sm text-gray-700 dark:text-gray-300">
                                                        <span class="font-medium" x-text="getScheduleICount()">0</span> organizations have grant-making history
                                                    </div>
                                                </div>
                                                <div class="flex items-start space-x-3">
                                                    <div class="flex-shrink-0 w-2 h-2 bg-purple-500 rounded-full mt-2"></div>
                                                    <div class="text-sm text-gray-700 dark:text-gray-300">
                                                        Foundation Code 03 organizations are priority targets for grant research
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Schedule I Tab -->
                                <div x-show="active990Tab === 'schedule-i'" class="space-y-6">
                                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-700">
                                        <h6 class="font-semibold text-blue-900 dark:text-blue-300 mb-4">Schedule I Grant Recipients</h6>
                                        <div class="text-sm text-blue-800 dark:text-blue-200 mb-4">
                                            Organizations that received grants from nonprofits in your discovery results - potential peer funders or collaboration opportunities.
                                        </div>
                                        <template x-for="recipient in getScheduleIRecipients()" :key="recipient.id">
                                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border mb-4">
                                                <div class="flex items-center justify-between mb-2">
                                                    <div class="font-medium text-gray-900 dark:text-white" x-text="recipient.recipient_name">Recipient</div>
                                                    <div class="text-sm font-semibold text-green-600 dark:text-green-400" x-text="formatCurrency(recipient.grant_amount)">$0</div>
                                                </div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400" x-text="recipient.grant_purpose">Purpose</div>
                                                <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                                                    Granted by: <span x-text="recipient.grantor_name">Grantor</span> | Year: <span x-text="recipient.grant_year">Year</span>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- Foundation Intelligence Tab -->
                                <div x-show="active990Tab === 'foundation-intel'" class="space-y-6">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- Grant-Making Capacity -->
                                        <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-6 border border-purple-200 dark:border-purple-700">
                                            <h6 class="font-semibold text-purple-900 dark:text-purple-300 mb-4">Grant-Making Capacity (990-PF Part I)</h6>
                                            <template x-for="foundation in getFoundationFinancials()" :key="`foundation-financials-${foundation.id}`">
                                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border mb-4">
                                                    <div class="flex items-center justify-between mb-2">
                                                        <div class="font-medium text-gray-900 dark:text-white" x-text="foundation.name">Foundation</div>
                                                        <span x-show="foundation.foundation_code === '03'" 
                                                              class="px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300 rounded-full">
                                                            Code 03
                                                        </span>
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                                        <div>
                                                            <span class="text-gray-600 dark:text-gray-400">Investment Income:</span>
                                                            <div class="font-semibold text-green-600 dark:text-green-400" x-text="formatCurrency(foundation.investment_income)">$0</div>
                                                        </div>
                                                        <div>
                                                            <span class="text-gray-600 dark:text-gray-400">Grants Paid:</span>
                                                            <div class="font-semibold text-blue-600 dark:text-blue-400" x-text="formatCurrency(foundation.grants_paid)">$0</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                        
                                        <!-- Board & Decision Makers -->
                                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                            <h6 class="font-semibold text-gray-900 dark:text-white mb-4">Board & Decision Makers (990-PF Part VIII)</h6>
                                            <template x-for="member in getFoundationBoardMembers()" :key="member.id">
                                                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 border mb-3">
                                                    <div class="flex items-center justify-between">
                                                        <div>
                                                            <div class="font-medium text-gray-900 dark:text-white" x-text="member.name">Board Member</div>
                                                            <div class="text-sm text-gray-600 dark:text-gray-400" x-text="member.title">Title</div>
                                                        </div>
                                                        <div class="text-xs text-gray-500 dark:text-gray-500" x-text="member.foundation_name">Foundation</div>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Application Strategy Tab -->
                                <div x-show="active990Tab === 'application-strategy'" class="space-y-6">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <!-- Immediate Outreach -->
                                        <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-6 border border-green-200 dark:border-green-700">
                                            <h6 class="font-semibold text-green-900 dark:text-green-300 mb-4 flex items-center">
                                                ‚úÖ Ready for Outreach
                                                <span class="ml-2 px-2 py-1 text-xs bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 rounded-full" x-text="getAcceptsApplicationsCount()">0</span>
                                            </h6>
                                            <template x-for="foundation in getFoundationsAcceptingApplications()" :key="`foundation-accepting-${foundation.id}`">
                                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border mb-3">
                                                    <div class="font-medium text-gray-900 dark:text-white text-sm" x-text="foundation.name">Foundation</div>
                                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1" x-text="formatCurrency(foundation.grants_paid) + ' annual grants'">Grant amount</div>
                                                    <div class="text-xs text-green-700 dark:text-green-300 mt-2">‚úì Accepts unsolicited applications</div>
                                                </div>
                                            </template>
                                        </div>
                                        
                                        <!-- Network Development -->
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6 border border-yellow-200 dark:border-yellow-700">
                                            <h6 class="font-semibold text-yellow-900 dark:text-yellow-300 mb-4 flex items-center">
                                                üì® Network Required
                                                <span class="ml-2 px-2 py-1 text-xs bg-yellow-100 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200 rounded-full" x-text="getInvitationOnlyCount()">0</span>
                                            </h6>
                                            <template x-for="foundation in getInvitationOnlyFoundations()" :key="`foundation-invitation-${foundation.id}`">
                                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border mb-3">
                                                    <div class="font-medium text-gray-900 dark:text-white text-sm" x-text="foundation.name">Foundation</div>
                                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Requires board/staff connections</div>
                                                    <button @click="viewBoardConnections(foundation)" class="mt-2 text-xs bg-yellow-100 hover:bg-yellow-200 dark:bg-yellow-800 dark:hover:bg-yellow-700 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded">
                                                        View Network
                                                    </button>
                                                </div>
                                            </template>
                                        </div>
                                        
                                        <!-- Research Needed -->
                                        <div class="bg-gray-50 dark:bg-gray-600 rounded-lg p-6 border border-gray-200 dark:border-gray-600">
                                            <h6 class="font-semibold text-gray-900 dark:text-gray-300 mb-4 flex items-center">
                                                üîç Research Required
                                                <span class="ml-2 px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 rounded-full" x-text="getResearchNeededCount()">0</span>
                                            </h6>
                                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                                Foundations with unknown application processes - investigate Part XV for application acceptance policies.
                                            </div>
                                            <template x-for="foundation in getResearchNeededFoundations()" :key="`foundation-research-${foundation.id}`">
                                                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 border mb-2">
                                                    <div class="font-medium text-gray-900 dark:text-white text-sm" x-text="foundation.name">Foundation</div>
                                                    <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">Application process unknown</div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <!-- Strategic Action Plan -->
                                    <div class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-6 border border-orange-200 dark:border-orange-700">
                                        <h6 class="font-semibold text-orange-900 dark:text-orange-300 mb-4">Recommended Action Plan</h6>
                                        <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700 dark:text-gray-300">
                                            <li><strong>Priority 1:</strong> Submit applications to Foundation Code 03 organizations accepting applications</li>
                                            <li><strong>Priority 2:</strong> Develop board connection strategies for invitation-only foundations</li>
                                            <li><strong>Priority 3:</strong> Research Part XV application processes for unknown foundations</li>
                                            <li><strong>Priority 4:</strong> Analyze grant-making patterns from Part XV historical data</li>
                                            <li><strong>Priority 5:</strong> Create relationship maps using Part VIII board member data</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Strategic Planning Pipeline Table -->
                    <div class="w-full">
                        <div class="w-full">
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                                <!-- Table Header -->
                                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center justify-between">
                                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Strategic Planning Pipeline</h4>
                                        <div class="flex items-center space-x-3">
                                            <select x-model="planStageFilter" @change="updatePlanData()"
                                                    class="text-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                                <option value="">All Stages</option>
                                                <option value="qualified">#2 Qualified</option>
                                                <option value="candidates">#3 Candidates</option>
                                                <option value="targets">#4 Targets</option>
                                                <option value="opportunities">#5 Opportunities</option>
                                            </select>
                                            <input type="text" placeholder="Search prospects..." 
                                                   x-model="planSearchQuery" @input="updatePlanData()"
                                                   class="text-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700">
                                        </div>
                                    </div>
                                </div>

                                <!-- Prospects Table -->
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                                    Organization Name
                                                </th>
                                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                                    Stage
                                                </th>
                                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                                    Type
                                                </th>
                                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                                    990 Analysis
                                                </th>
                                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                                    Network Score
                                                </th>
                                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                                    Enhanced Score
                                                </th>
                                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                                    Combined
                                                </th>
                                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                                    Actions
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <template x-for="prospect in planData" :key="prospect.opportunity_id">
                                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer" 
                                                    x-init="addOpportunityContextMenu && addOpportunityContextMenu($el, prospect)"
                                                    :class="{'!bg-blue-100 dark:!bg-blue-900 border-l-4 border-blue-500': isSelected && isSelected(prospect.opportunity_id)}"
                                                    @click="toggleSelection && toggleSelection(prospect, $event)">
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="text-sm font-medium text-gray-900 dark:text-white" 
                                                             x-text="prospect.organization_name"></div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                              :class="getStageColor(getActualStage(prospect))"
                                                              x-text="formatStageWithNumber(getActualStage(prospect))"></span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                              :class="getOrganizationTypeColor(prospect.source_type || prospect.organization_type || 'Nonprofit')"
                                                              x-text="prospect.source_type || prospect.organization_type || 'Nonprofit'"></span>
                                                    </td>
                                                    <td class="px-3 py-4 whitespace-nowrap">
                                                        <div class="text-xs font-medium text-gray-900 dark:text-white" 
                                                             x-text="prospect.xml_990_processing ? 'Processing...' : ((prospect.xml_990_score * 100 || 0).toFixed(1) + '%')"></div>
                                                        <div class="w-12 bg-gray-200 dark:bg-gray-600 rounded-full h-1.5 mt-1">
                                                            <div :class="prospect.xml_990_processing ? 'bg-blue-400 animate-pulse' : 'bg-blue-500'" 
                                                                 class="h-1.5 rounded-full transition-all duration-300" 
                                                                 :style="`width: ${prospect.xml_990_processing ? '100' : ((prospect.xml_990_score || 0) * 100)}%`"></div>
                                                        </div>
                                                    </td>
                                                    <td class="px-3 py-4 whitespace-nowrap">
                                                        <div class="text-xs font-medium text-gray-900 dark:text-white" 
                                                             x-text="prospect.network_processing ? 'Processing...' : ((prospect.network_score * 100 || 0).toFixed(1) + '%')"></div>
                                                        <div class="w-12 bg-gray-200 dark:bg-gray-600 rounded-full h-1.5 mt-1">
                                                            <div :class="prospect.network_processing ? 'bg-purple-400 animate-pulse' : 'bg-purple-500'" 
                                                                 class="h-1.5 rounded-full transition-all duration-300" 
                                                                 :style="`width: ${prospect.network_processing ? '100' : ((prospect.network_score || 0) * 100)}%`"></div>
                                                        </div>
                                                    </td>
                                                    <td class="px-3 py-4 whitespace-nowrap">
                                                        <div class="text-xs font-medium text-gray-900 dark:text-white" 
                                                             x-text="prospect.enhanced_processing ? 'Processing...' : ((prospect.enhanced_score * 100 || 0).toFixed(1) + '%')"></div>
                                                        <div class="w-12 bg-gray-200 dark:bg-gray-600 rounded-full h-1.5 mt-1">
                                                            <div :class="prospect.enhanced_processing ? 'bg-green-400 animate-pulse' : 'bg-green-500'" 
                                                                 class="h-1.5 rounded-full transition-all duration-300" 
                                                                 :style="`width: ${prospect.enhanced_processing ? '100' : ((prospect.enhanced_score || 0) * 100)}%`"></div>
                                                        </div>
                                                    </td>
                                                    <td class="px-3 py-4 whitespace-nowrap">
                                                        <div class="text-sm font-bold text-gray-900 dark:text-white" 
                                                             x-text="(prospect.combined_score * 100 || 0).toFixed(1) + '%'"></div>
                                                        <div class="progress-container w-12 mt-1" style="--progress-height: 0.5rem;">
                                                            <div class="progress-bar" 
                                                                 :class="(prospect.combined_score || 0) >= 0.9 ? 'progress-success' : 
                                                                         (prospect.combined_score || 0) >= 0.75 ? 'progress-warning' : 
                                                                         (prospect.combined_score || 0) >= 0.5 ? 'progress-warning' : 'progress-danger'"
                                                                 :style="`--progress-width: ${(prospect.combined_score || 0) * 100}%`"></div>
                                                        </div>
                                                    </td>
                                                    <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">
                                                        <div class="flex items-center space-x-2">
                                                            <button @click="openOpportunityModal(prospect, 'discover')" 
                                                                    class="px-3 py-1 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md transition-colors">View Details</button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                            
                                            <!-- Empty State -->
                                            <tr x-show="planData.length === 0">
                                                <td colspan="8" class="px-6 py-12 text-center">
                                                    <div class="text-gray-400 dark:text-gray-600">
                                                        <svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                                                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                        </svg>
                                                        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No opportunities for strategic planning</h3>
                                                        <p class="text-gray-500 dark:text-gray-400">Run discovery to find qualified prospects or adjust stage filter to see more opportunities</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Prospect Details Modal -->
                    <div x-show="showProspectModal" x-cloak
                                
                                <!-- Analysis Status -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600 dark:text-gray-400">Analysis Status</span>
                                        <span :class="analysisStatus.xml_990 === 'complete' ? 'text-green-600' : 'text-yellow-600'"
                                              x-text="analysisStatus.xml_990"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 mt-2">
                                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                             :style="`width: ${analysisProgress.xml_990}%`"></div>
                                    </div>
                                </div>

                                <!-- Financial Metrics -->
                                <div class="space-y-3" x-show="analysisResults.financial_metrics">
                                    <div class="text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Revenue Trend</span>
                                            <span class="font-medium" 
                                                  :class="analysisResults.financial_metrics?.revenue_trend > 0 ? 'text-green-600' : 'text-red-600'"
                                                  x-text="(analysisResults.financial_metrics?.revenue_trend || 0).toFixed(1) + '%'"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Financial Health Score</span>
                                            <span class="font-medium text-gray-900 dark:text-white" 
                                                  x-text="(analysisResults.financial_metrics?.health_score || 0).toFixed(2)"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Risk Level</span>
                                            <span class="font-medium" 
                                                  :class="getRiskLevelColor(analysisResults.financial_metrics?.risk_level)"
                                                  x-text="analysisResults.financial_metrics?.risk_level || 'Unknown'"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Empty State -->
                                <div x-show="!analysisResults.financial_metrics" class="text-center py-8">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Select prospects and run 990 analysis</p>
                                </div>
                            </div>


                    <!-- Scoring Details Modal moved to global scope -->
                </div>

                <!-- STAGE 4: ANALYZE (CANDIDATES) -->
                <div x-show="activeStage === 'analyze'" class="space-y-6">
                    <!-- Analysis Header -->
                    <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Comprehensive Analysis <span class="text-lg font-normal">- Financial analysis, network mapping, and intelligence assessment</span></h3>
                    </div>

                    <!-- Profile Intelligence Center -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        
                        <!-- Profile Intelligence Center Header -->
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-xl font-semibold text-gray-900 dark:text-white">Profile Intelligence Center</h4>
                            <div x-show="selectedAnalyzeProfile" class="text-sm text-gray-600 dark:text-gray-400">
                                Selected: <span x-text="selectedAnalyzeProfile?.name" class="font-medium text-gray-900 dark:text-white"></span>
                            </div>
                        </div>

                        <!-- Current Profile Information -->
                        <div x-show="selectedAnalyzeProfile" class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-l-4 border-red-500">
                            <div class="mb-3">
                                <h5 class="font-semibold text-gray-900 dark:text-white">Current Profile</h5>
                            </div>
                            <div class="grid grid-cols-4 gap-3">
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Organization</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedAnalyzeProfile?.name">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">EIN</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedAnalyzeProfile?.ein || 'Not Available'">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Network Status</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="showNetworkCharts ? 'Loaded' : 'Ready'">Ready</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Candidates Count</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="candidatesCount">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- No Profile Selected State -->
                        <div x-show="!selectedAnalyzeProfile" class="mb-6 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-orange-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h5 class="text-sm font-medium text-orange-800 dark:text-orange-200">No Profile Selected</h5>
                                    <p class="text-xs text-orange-700 dark:text-orange-300 mt-1">Select an organization profile and progress through DISCOVER and PLAN stages to analyze candidates.</p>
                                    <button @click="switchStage('discover')" class="mt-2 text-xs bg-orange-100 dark:bg-orange-800 hover:bg-orange-200 dark:hover:bg-orange-700 text-orange-800 dark:text-orange-200 px-2 py-1 rounded">
                                        Go to Discovery
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- AI-Heavy Light Analysis - Comprehensive Screening -->
                        <div class="mb-6">
                            
                            <!-- Feature Grid -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-orange-200 dark:border-orange-700">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="text-orange-600 dark:text-orange-400 font-semibold text-sm">AI Intelligence</div>
                                        <button @click="runAIIntelligence()" 
                                                :disabled="analysisProgress.ai_intelligence_running" 
                                                class="bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                                            <span x-show="!analysisProgress.ai_intelligence_running">Run</span>
                                            <span x-show="analysisProgress.ai_intelligence_running">...</span>
                                        </button>
                                    </div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Strategic assessment & screening</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-blue-200 dark:border-blue-700">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="text-blue-600 dark:text-blue-400 font-semibold text-sm">Risk Assessment</div>
                                        <button @click="runRiskAssessment()" 
                                                :disabled="analysisProgress.risk_assessment_running" 
                                                class="bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                                            <span x-show="!analysisProgress.risk_assessment_running">Run</span>
                                            <span x-show="analysisProgress.risk_assessment_running">...</span>
                                        </button>
                                    </div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Compliance & stability analysis</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-purple-200 dark:border-purple-700">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="text-purple-600 dark:text-purple-400 font-semibold text-sm">Financial Analysis</div>
                                        <button @click="runFinancialAnalysis()" 
                                                :disabled="analysisProgress.financial_analysis_running" 
                                                class="bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                                            <span x-show="!analysisProgress.financial_analysis_running">Run</span>
                                            <span x-show="analysisProgress.financial_analysis_running">...</span>
                                        </button>
                                    </div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">AI-enhanced financial health</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-green-200 dark:border-green-700">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="text-green-600 dark:text-green-400 font-semibold text-sm">Network Analysis</div>
                                        <button @click="runNetworkAnalysis()" 
                                                :disabled="analysisProgress.network_analysis_running" 
                                                class="bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                                            <span x-show="!analysisProgress.network_analysis_running">Run</span>
                                            <span x-show="analysisProgress.network_analysis_running">...</span>
                                        </button>
                                    </div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Relationship potential mapping</div>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="flex items-center justify-center space-x-4 mt-6">
                                <button @click="runAIHeavyLightAnalysis()" 
                                        :disabled="analysisProgress.ai_heavy_light_running" 
                                        class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-md text-sm font-medium transition-colors">
                                    <span x-show="!analysisProgress.ai_heavy_light_running">Run Screening</span>
                                    <span x-show="analysisProgress.ai_heavy_light_running">Running...</span>
                                </button>
                                <button @click="toggleNetworkVisualizations()" 
                                        :disabled="loadingNetworkData"
                                        :class="showNetworkCharts ? 'bg-gray-600 hover:bg-gray-700' : 'bg-blue-600 hover:bg-blue-700'"
                                        class="px-6 py-2 disabled:bg-gray-400 text-white rounded-md text-sm font-medium transition-colors">
                                    <span x-show="loadingNetworkData">Loading...</span>
                                    <span x-show="!loadingNetworkData && !showNetworkCharts">Show Networks</span>
                                    <span x-show="!loadingNetworkData && showNetworkCharts">Hide Networks</span>
                                </button>
                            </div>
                        </div>

                    </div>

                    <!-- AI-Heavy Promotion Queue Interface -->
                    <div x-show="selectedAnalyzeProfile && candidatesCount > 0" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-xl font-semibold text-gray-900 dark:text-white">AI-Heavy Deep Research Queue</h4>
                            <div class="flex items-center space-x-3">
                                <div class="text-sm text-gray-600 dark:text-gray-400">
                                    <span x-text="getEligibleCandidatesCount()" class="font-medium text-orange-600"></span> candidates eligible
                                </div>
                                <button @click="showAIHeavyPromotionModal()" 
                                        :disabled="getEligibleCandidatesCount() === 0"
                                        class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-400 disabled:to-gray-500 text-white font-medium rounded-lg transition-all duration-200 shadow-md disabled:shadow-none">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        <span>Batch Promote to Deep Research</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Promotion Queue Statistics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-blue-700 dark:text-blue-300">AI Analyzed</p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100" x-text="getAILiteAnalyzedCount()">0</p>
                                    </div>
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-green-700 dark:text-green-300">High Score (‚â•75%)</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" x-text="getHighScoreCandidatesCount()">0</p>
                                    </div>
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-purple-700 dark:text-purple-300">AI-Heavy Ready</p>
                                        <p class="text-2xl font-bold text-purple-900 dark:text-purple-100" x-text="getEligibleCandidatesCount()">0</p>
                                    </div>
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-900/20 dark:to-slate-900/20 p-4 rounded-lg border border-gray-200 dark:border-gray-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-700 dark:text-gray-300">Est. Cost Range</p>
                                        <p class="text-lg font-bold text-gray-900 dark:text-gray-100">$0.08-0.25</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">per candidate</p>
                                    </div>
                                    <div class="w-8 h-8 bg-gray-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Promotion Actions -->
                        <div x-show="getEligibleCandidatesCount() > 0" class="bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full animate-pulse"></div>
                                    <div>
                                        <h5 class="font-medium text-orange-900 dark:text-orange-100">Ready for Deep Research</h5>
                                        <p class="text-sm text-orange-700 dark:text-orange-300">
                                            <span x-text="getEligibleCandidatesCount()"></span> candidates with AI scores ‚â•75% can be promoted to comprehensive deep analysis
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button @click="promoteAllEligible()" 
                                            class="px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white text-sm font-medium rounded-lg transition-colors">
                                        Promote All
                                    </button>
                                    <button @click="showAIHeavyPromotionModal()" 
                                            class="px-3 py-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 text-orange-600 border border-orange-300 dark:border-orange-600 text-sm font-medium rounded-lg transition-colors">
                                        Select Individual
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- No Eligible Candidates State -->
                        <div x-show="candidatesCount > 0 && getEligibleCandidatesCount() === 0" class="text-center py-8">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No candidates ready for AI-Heavy research</h3>
                            <p class="mt-2 text-gray-500 dark:text-gray-400">
                                Run AI analysis first to identify high-scoring candidates (‚â•75%) eligible for deep research
                            </p>
                            <div class="mt-4">
                                <button @click="startUnifiedAIResearch()" 
                                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
                                    Run AI Analysis
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- Network Visualization Section -->
                    <div x-show="showNetworkCharts" class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <!-- Board Member Network Chart -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Board Member Network</h4>
                                    <div class="flex items-center space-x-2">
                                        <button @click="toggleFullscreenNetwork('board')" 
                                                class="text-sm text-orange-600 hover:text-orange-800"
                                                title="Toggle Fullscreen">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path x-show="!fullscreenNetwork.board" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
                                                <path x-show="fullscreenNetwork.board" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9l6 6m0-6l-6 6m12-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </button>
                                        <button @click="refreshNetworkVisualization()" 
                                                class="text-sm text-orange-600 hover:text-orange-800"
                                                title="Refresh">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div id="board-network-chart" class="p-6 min-h-96">
                                <div x-show="!networkVisualizationData" class="flex items-center justify-center h-64 text-gray-400">
                                    <div class="text-center">
                                        <svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                        </svg>
                                        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Network visualization will appear here</h3>
                                        <p class="text-gray-500 dark:text-gray-400">Select a profile and load network data to see board member connections</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Influence Network Chart -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Influence Network</h4>
                                    <button @click="toggleFullscreenNetwork('influence')" 
                                            class="text-sm text-orange-600 hover:text-orange-800"
                                            title="Toggle Fullscreen">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path x-show="!fullscreenNetwork.influence" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
                                            <path x-show="fullscreenNetwork.influence" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9l6 6m0-6l-6 6m12-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div id="influence-network-chart" class="p-6 min-h-96">
                                <div x-show="!networkVisualizationData" class="flex items-center justify-center h-64 text-gray-400">
                                    <div class="text-center">
                                        <svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Influence network will appear here</h3>
                                        <p class="text-gray-500 dark:text-gray-400">Individual influence scoring and relationship mapping</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Candidates Analysis Table -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Candidates Analysis</h4>
                                <div class="flex items-center space-x-3">
                                    <select x-model="analyzeStageFilter" @change="updateAnalyzeData()"
                                            class="text-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                        <option value="">All Stages</option>
                                        <option value="candidates">#3 Candidates</option>
                                        <option value="targets">#4 Targets</option>
                                        <option value="opportunities">#5 Opportunities</option>
                                    </select>
                                    <input type="text" placeholder="Search candidates..." 
                                           x-model="analyzeSearchQuery" @input="updateAnalyzeData()"
                                           class="text-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700">
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Organization Name
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Stage
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Type
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Combined Score
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Network Score
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            AI Analysis
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            AI Status
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Actions
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <template x-for="candidate in analyzeData" :key="candidate.opportunity_id">
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer"
                                            x-init="addOpportunityContextMenu && addOpportunityContextMenu($el, candidate)"
                                            :class="{'!bg-blue-100 dark:!bg-blue-900 border-l-4 border-blue-500': isSelected && isSelected(candidate.opportunity_id)}"
                                            @click="toggleSelection && toggleSelection(candidate, $event)">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900 dark:text-white" 
                                                     x-text="candidate.organization_name"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                      :class="getStageColor(getActualStage(candidate))"
                                                      x-text="formatStageWithNumber(getActualStage(candidate))"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                      :class="getOrganizationTypeColor(candidate.source_type || candidate.organization_type || 'Nonprofit')"
                                                      x-text="candidate.source_type || candidate.organization_type || 'Nonprofit'"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-bold text-gray-900 dark:text-white" 
                                                     x-text="((candidate.combined_score || 0) * 100).toFixed(1) + '%'"></div>
                                                <div class="w-12 bg-gray-200 dark:bg-gray-600 rounded-full h-2 mt-1">
                                                    <div class="h-2 rounded-full" 
                                                         :class="(candidate.combined_score || 0) >= 0.9 ? 'bg-green-600' : 
                                                                 (candidate.combined_score || 0) >= 0.75 ? 'bg-yellow-600' : 
                                                                 (candidate.combined_score || 0) >= 0.5 ? 'bg-orange-600' : 'bg-red-600'"
                                                         :style="`width: ${(candidate.combined_score || 0) * 100}%`"></div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-xs font-medium text-gray-900 dark:text-white" 
                                                     x-text="((candidate.network_score || 0) * 100).toFixed(1) + '%'"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="space-y-1">
                                                    <!-- AI Compatibility Score -->
                                                    <div x-show="hasAIAnalysis(candidate)">
                                                        <div class="text-xs font-medium text-gray-900 dark:text-white">
                                                            AI: <span x-text="(getAICompatibilityScore(candidate) * 100).toFixed(1) + '%'"></span>
                                                        </div>
                                                        <div class="w-16 bg-gray-200 dark:bg-gray-600 rounded-full h-1.5 mt-1">
                                                            <div class="h-1.5 rounded-full transition-all duration-300" 
                                                                 :class="getAICompatibilityScore(candidate) >= 0.8 ? 'bg-green-500' : 
                                                                         getAICompatibilityScore(candidate) >= 0.6 ? 'bg-yellow-500' : 'bg-red-500'"
                                                                 :style="`width: ${getAICompatibilityScore(candidate) * 100}%`"></div>
                                                        </div>
                                                        <!-- Priority Rank -->
                                                        <div class="text-xs text-gray-500 dark:text-gray-400">
                                                            Priority: <span x-text="getAIPriorityRank(candidate)"></span>
                                                        </div>
                                                        <!-- Risk Flags -->
                                                        <div x-show="getAIRiskFlags(candidate).length > 0" class="flex flex-wrap gap-1 mt-1">
                                                            <template x-for="flag in getAIRiskFlags(candidate).slice(0, 2)" :key="flag">
                                                                <span class="inline-flex px-1 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 rounded">
                                                                    <span x-text="flag.replace('_', ' ')"></span>
                                                                </span>
                                                            </template>
                                                            <span x-show="getAIRiskFlags(candidate).length > 2" 
                                                                  class="text-xs text-gray-400"
                                                                  x-text="`+${getAIRiskFlags(candidate).length - 2} more`"></span>
                                                        </div>
                                                    </div>
                                                    <!-- No AI Analysis -->
                                                    <div x-show="!hasAIAnalysis(candidate)" class="text-xs text-gray-400 dark:text-gray-500">
                                                        No AI analysis
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="space-y-2">
                                                    <!-- Status Badges -->
                                                    <div class="space-y-1">
                                                        <!-- AI Lite Status -->
                                                        <div>
                                                            <span x-show="hasAIAnalysis(candidate)" 
                                                                  class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                                                AI Analyzed
                                                            </span>
                                                        </div>
                                                        
                                                        <!-- Deep AI Status -->
                                                        <div>
                                                            <span x-show="candidate.ai_analyzed && !candidate.ai_error" 
                                                                  class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                                                Deep AI
                                                            </span>
                                                            <span x-show="candidate.ai_error" 
                                                                  class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                                                                Error
                                                            </span>
                                                            <span x-show="!candidate.ai_analyzed && !candidate.ai_error && !hasAIAnalysis(candidate) && (candidate.combined_score || 0) < 0.75" 
                                                                  class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                                                Unavailable
                                                            </span>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Action Buttons -->
                                                    <div>
                                                        <!-- Initiate Deep AI button (requires AI Analysis + high score) -->
                                                        <button x-show="(!candidate.ai_analyzed && !candidate.ai_processing && !candidate.ai_error && hasAIAnalysis(candidate) && getAICompatibilityScore(candidate) >= 0.75)"
                                                                @click="runSingleAIAnalysis(candidate)" 
                                                                class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs font-medium rounded transition-colors">
                                                            Deep AI
                                                        </button>
                                                        
                                                        <!-- Unavailable for low AI scores -->
                                                        <div x-show="hasAIAnalysis(candidate) && !candidate.ai_analyzed && !candidate.ai_error && getAICompatibilityScore(candidate) < 0.75"
                                                             class="text-xs text-gray-500 dark:text-gray-400">
                                                            Deep AI Unavailable<br>
                                                            <span class="text-xs">(AI Score: <span x-text="(getAICompatibilityScore(candidate) * 100).toFixed(0)"></span>% &lt; 75%)</span>
                                                        </div>
                                                        
                                                        <!-- Retry button for errors -->
                                                        <button x-show="candidate.ai_error && !candidate.ai_processing"
                                                                @click="runSingleAIAnalysis(candidate)" 
                                                                class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs font-medium rounded transition-colors">
                                                            Retry
                                                        </button>
                                                        
                                                        <!-- Processing indicator -->
                                                        <button x-show="candidate.ai_processing"
                                                                disabled
                                                                class="px-3 py-1 bg-gray-400 text-white text-xs font-medium rounded cursor-not-allowed">
                                                            Processing...
                                                        </button>
                                                        
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-3 py-4 whitespace-nowrap text-sm">
                                                <div class="flex items-center space-x-2">
                                                    <button @click="openOpportunityModal(candidate, 'plan')" 
                                                            class="px-3 py-1 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md transition-colors">View Details</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                    
                                    <!-- Empty State -->
                                    <tr x-show="analyzeData.length === 0">
                                        <td colspan="7" class="px-6 py-12 text-center">
                                            <div class="text-gray-400 dark:text-gray-600">
                                                <svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No candidates for analysis</h3>
                                                <p class="text-gray-500 dark:text-gray-400">Complete DISCOVER and PLAN stages to generate candidates for analysis</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- STAGE 5: EXAMINE (TARGETS) -->
                <div x-show="activeStage === 'examine'" class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Target Examination <span class="text-lg font-normal">- Deep dive dossier building, comprehensive intelligence reports, and advanced AI analysis</span></h3>
                    </div>

                    <!-- Profile Intelligence Center -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        
                        <!-- Profile Intelligence Center Header -->
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-xl font-semibold text-gray-900 dark:text-white">Profile Intelligence Center</h4>
                            <div x-show="selectedExamineProfile" class="text-sm text-gray-600 dark:text-gray-400">
                                Selected: <span x-text="selectedExamineProfile?.name" class="font-medium text-gray-900 dark:text-white"></span>
                            </div>
                        </div>
                        
                        <!-- Current Profile Information -->
                        <div x-show="selectedExamineProfile" class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-l-4 border-blue-500">
                            <div class="flex items-center justify-between mb-3">
                                <h5 class="font-semibold text-gray-900 dark:text-white">Current Profile</h5>
                                <div class="flex space-x-2">
                                    <button @click="selectedExamineProfile = null" class="px-2 py-1 text-xs bg-gray-500 hover:bg-gray-600 text-white rounded">
                                        Close Profile
                                    </button>
                                    <button @click="switchStage('profiler')" class="px-2 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded">
                                        Select Profile
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-4 gap-3">
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Organization</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedExamineProfile?.name">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">EIN</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedExamineProfile?.ein || 'Not Available'">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Investigation Status</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedExamineProfile?.last_examine_date ? formatDate(selectedExamineProfile.last_examine_date) : 'Not Run'">Not Run</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Target Count</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="examineData.filter(t => t.funnel_stage === 'targets').length || 0">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- No Profile Selected State -->
                        <div x-show="!selectedExamineProfile" class="mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h5 class="text-sm font-medium text-blue-800 dark:text-blue-200">No Profile Selected</h5>
                                    <p class="text-xs text-blue-700 dark:text-blue-300 mt-1">Select an organization profile and progress through DISCOVER ‚Üí PLAN ‚Üí ANALYZE stages to generate targets for deep examination.</p>
                                    <button @click="switchStage('analyze')" class="mt-2 text-xs bg-blue-100 dark:bg-blue-800 hover:bg-blue-200 dark:hover:bg-blue-700 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">
                                        Go to Analysis
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Investigation Tracks -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-blue-900 dark:text-blue-100">Deep Research</h5>
                                    <button @click="showDeepResearchConfirmation = true" :disabled="investigationProgress.research"
                                            class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!investigationProgress.research">Run</span>
                                        <span x-show="investigationProgress.research">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-blue-700 dark:text-blue-300">Comprehensive deep research & strategic intelligence</p>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-purple-900 dark:text-purple-100">Board Analysis</h5>
                                    <button @click="runInvestigationTrack('board')" :disabled="investigationProgress.board"
                                            class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!investigationProgress.board">Run</span>
                                        <span x-show="investigationProgress.board">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-purple-700 dark:text-purple-300">Leadership and governance</p>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-green-900 dark:text-green-100">Strategic Assessment</h5>
                                    <button @click="runInvestigationTrack('strategic')" :disabled="investigationProgress.strategic"
                                            class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!investigationProgress.strategic">Run</span>
                                        <span x-show="investigationProgress.strategic">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-green-700 dark:text-green-300">Partnership opportunities</p>
                            </div>
                            <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-orange-900 dark:text-orange-100">Market Intelligence</h5>
                                    <button @click="runInvestigationTrack('market')" :disabled="investigationProgress.market"
                                            class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!investigationProgress.market">Run</span>
                                        <span x-show="investigationProgress.market">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-orange-700 dark:text-orange-300">Competitive landscape analysis</p>
                            </div>
                        </div>

                    </div>

                    <!-- AI-Heavy Research Integration -->
                    <div x-show="selectedExamineProfile && getAIHeavyPromotedTargetsCount() > 0" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-xl font-semibold text-gray-900 dark:text-white">AI-Heavy Research Results</h4>
                            <div class="flex items-center space-x-3">
                                <div class="text-sm text-gray-600 dark:text-gray-400">
                                    <span x-text="getAIHeavyPromotedTargetsCount()" class="font-medium text-purple-600"></span> promoted targets
                                </div>
                                <button @click="refreshAIHeavyResults()" 
                                        class="px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg transition-colors">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                        <span>Refresh Results</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- AI-Heavy Research Summary Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-purple-700 dark:text-purple-300">Research Complete</p>
                                        <p class="text-2xl font-bold text-purple-900 dark:text-purple-100" x-text="getCompletedResearchCount()">0</p>
                                    </div>
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-blue-700 dark:text-blue-300">High Priority</p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100" x-text="getHighPriorityTargetsCount()">0</p>
                                    </div>
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-green-700 dark:text-green-300">Dossiers Ready</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-100" x-text="getDossiersReadyCount()">0</p>
                                    </div>
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI-Heavy Research Results List -->
                        <div class="space-y-4">
                            <template x-for="target in getAIHeavyPromotedTargets()" :key="target.opportunity_id">
                                <div class="bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-800 dark:to-blue-900/20 border border-gray-200 dark:border-blue-700 rounded-lg p-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <!-- Target Header -->
                                            <div class="flex items-center space-x-3 mb-3">
                                                <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center">
                                                    <span class="text-white font-bold text-sm" x-text="target.organization_name.charAt(0)">T</span>
                                                </div>
                                                <div>
                                                    <h5 class="font-semibold text-gray-900 dark:text-white" x-text="target.organization_name">Organization Name</h5>
                                                    <p class="text-sm text-gray-600 dark:text-gray-400">
                                                        <span x-text="target.source_type">Source</span>
                                                        <span x-show="target.funding_amount"> ‚Ä¢ $<span x-text="target.funding_amount?.toLocaleString()">Amount</span></span>
                                                        <span class="ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">AI-Heavy</span>
                                                    </p>
                                                </div>
                                            </div>

                                            <!-- Research Summary -->
                                            <div x-show="target.ai_heavy_research" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg border">
                                                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Research Score</p>
                                                    <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="(target.ai_heavy_research.research_score * 100).toFixed(0) + '%'">-%</p>
                                                </div>
                                                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg border">
                                                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Success Rate</p>
                                                    <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="target.ai_heavy_research.risk_assessment?.success_probability ? (target.ai_heavy_research.risk_assessment.success_probability * 100).toFixed(0) + '%' : 'N/A'">-</p>
                                                </div>
                                                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg border">
                                                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Research Cost</p>
                                                    <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="target.ai_heavy_research.cost_breakdown?.total_cost ? '$' + target.ai_heavy_research.cost_breakdown.total_cost.toFixed(4) : 'N/A'">-</p>
                                                </div>
                                            </div>

                                            <!-- Quick Insights -->
                                            <div x-show="target.ai_heavy_research?.strategic_insights" class="mb-4">
                                                <h6 class="font-medium text-gray-900 dark:text-white text-sm mb-2">Key Strategic Insights</h6>
                                                <div class="space-y-2">
                                                    <template x-for="(insight, index) in (target.ai_heavy_research.strategic_insights?.key_points || []).slice(0, 2)" :key="index">
                                                        <p class="text-sm text-gray-700 dark:text-gray-300 flex items-start space-x-2">
                                                            <svg class="w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                            </svg>
                                                            <span x-text="insight">Insight</span>
                                                        </p>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Action Buttons -->
                                        <div class="flex flex-col space-y-2 ml-4">
                                            <button @click="openTargetDossier(target)" 
                                                    :disabled="!target.ai_heavy_research"
                                                    class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-400 disabled:to-gray-500 text-white text-sm font-medium rounded-lg transition-all duration-200 disabled:cursor-not-allowed">
                                                View Dossier
                                            </button>
                                            <button @click="exportTargetResearch(target)" 
                                                    :disabled="!target.ai_heavy_research"
                                                    class="px-4 py-2 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 text-purple-600 dark:text-purple-400 border border-purple-300 dark:border-purple-600 text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                                Export Report
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Research Status Bar -->
                                    <div x-show="target.ai_heavy_research" class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                        <div class="flex items-center justify-between text-sm">
                                            <div class="flex items-center space-x-4">
                                                <span class="flex items-center space-x-1">
                                                    <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                    <span class="text-gray-600 dark:text-gray-400">Research Complete</span>
                                                </span>
                                                <span class="text-gray-600 dark:text-gray-400">
                                                    Completed: <span x-text="formatDate(target.ai_heavy_research.research_timestamp)" class="font-medium">-</span>
                                                </span>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                      :class="target.ai_heavy_research.research_mode === 'comprehensive' ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200' : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'"
                                                      x-text="target.ai_heavy_research.research_mode === 'comprehensive' ? 'Comprehensive' : 'Standard'">Mode</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- No AI-Heavy Results State -->
                        <div x-show="getAIHeavyPromotedTargetsCount() === 0" class="text-center py-12">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No AI-Heavy research results</h3>
                            <p class="mt-2 text-gray-500 dark:text-gray-400">
                                Promote candidates from the ANALYZE tab to generate comprehensive AI-Heavy research
                            </p>
                            <div class="mt-4">
                                <button @click="switchStage('analyze')" 
                                        class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors">
                                    Go to Analysis
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Targets Analysis Table -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Targets Analysis</h4>
                                <div class="flex items-center space-x-3">
                                    <select x-model="examineStageFilter" @change="updateExamineData()"
                                            class="text-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                        <option value="">All Stages</option>
                                        <option value="targets">#4 Targets</option>
                                        <option value="opportunities">#5 Opportunities</option>
                                    </select>
                                    <input type="text" placeholder="Search targets..." 
                                           x-model="examineSearchQuery" @input="updateExamineData()"
                                           class="text-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700">
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Organization Name
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Stage
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Type
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            AI Analysis Score
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Funding Amount
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Deep AI Status
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                            Actions
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <template x-for="target in examineData" :key="target.opportunity_id">
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer"
                                            x-init="addOpportunityContextMenu && addOpportunityContextMenu($el, target)"
                                            :class="{'!bg-blue-100 dark:!bg-blue-900 border-l-4 border-blue-500': isSelected && isSelected(target.opportunity_id)}"
                                            @click="toggleSelection && toggleSelection(target, $event)">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900 dark:text-white" 
                                                     x-text="target.organization_name"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                      :class="getStageColor(getActualStage(target))"
                                                      x-text="formatStageWithNumber(getActualStage(target))"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium rounded-full"
                                                      :class="getOrganizationTypeColor(target.source_type || target.organization_type || 'Nonprofit')"
                                                      x-text="target.source_type || target.organization_type || 'Nonprofit'"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div x-show="hasAIAnalysis(target)" class="space-y-1">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white">
                                                        <span x-text="(getAICompatibilityScore(target) * 100).toFixed(1) + '%'"></span>
                                                    </div>
                                                    <div class="w-16 bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                                        <div class="h-2 rounded-full transition-all duration-300" 
                                                             :class="getAICompatibilityScore(target) >= 0.8 ? 'bg-green-500' : 
                                                                     getAICompatibilityScore(target) >= 0.6 ? 'bg-yellow-500' : 'bg-red-500'"
                                                             :style="`width: ${getAICompatibilityScore(target) * 100}%`"></div>
                                                    </div>
                                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                                        Priority: <span x-text="getAIPriorityRank(target)"></span>
                                                    </div>
                                                </div>
                                                <div x-show="!hasAIAnalysis(target)" class="text-xs text-gray-400 dark:text-gray-500">
                                                    No AI analysis
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900 dark:text-white">
                                                    <span x-text="target.funding_amount ? '$' + target.funding_amount.toLocaleString() : 'N/A'"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="space-y-2">
                                                    <!-- Deep AI Status Badges -->
                                                    <div>
                                                        <span x-show="target.deep_ai_analyzed && !target.deep_ai_error" 
                                                              class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                                            Complete
                                                        </span>
                                                        <span x-show="target.deep_ai_error" 
                                                              class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                                                            Error
                                                        </span>
                                                        <span x-show="target.deep_ai_processing" 
                                                              class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                                            Processing...
                                                        </span>
                                                        <span x-show="!target.deep_ai_analyzed && !target.deep_ai_error && !target.deep_ai_processing && (!hasAIAnalysis(target) || getAICompatibilityScore(target) < 0.75)" 
                                                              class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                                            Unavailable
                                                        </span>
                                                    </div>
                                                    
                                                    <!-- Deep AI Action Buttons -->
                                                    <div>
                                                        <!-- Initiate Deep AI button (requires AI Analysis + high score) -->
                                                        <button x-show="(!target.deep_ai_analyzed && !target.deep_ai_processing && !target.deep_ai_error && hasAIAnalysis(target) && getAICompatibilityScore(target) >= 0.75)"
                                                                @click="runDeepAIAnalysis(target)" 
                                                                class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white text-xs font-medium rounded transition-colors">
                                                            Deep AI
                                                        </button>
                                                        
                                                        <!-- Retry button for errors -->
                                                        <button x-show="target.deep_ai_error && !target.deep_ai_processing"
                                                                @click="runDeepAIAnalysis(target)" 
                                                                class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white text-xs font-medium rounded transition-colors">
                                                            Retry
                                                        </button>
                                                        
                                                        <!-- View Dossier button for completed analysis -->
                                                        <button x-show="target.deep_ai_analyzed && !target.deep_ai_error"
                                                                @click="viewTargetDossier(target)" 
                                                                class="px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium rounded transition-colors">
                                                            View Dossier
                                                        </button>
                                                        
                                                        <!-- Unavailable explanation for low scores -->
                                                        <div x-show="hasAIAnalysis(target) && !target.deep_ai_analyzed && !target.deep_ai_error && getAICompatibilityScore(target) < 0.75"
                                                             class="text-xs text-gray-500 dark:text-gray-400">
                                                            Deep AI Unavailable<br>
                                                            <span class="text-xs">(AI Score: <span x-text="(getAICompatibilityScore(target) * 100).toFixed(0)"></span>% &lt; 75%)</span>
                                                        </div>
                                                        
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-3 py-4 whitespace-nowrap text-sm">
                                                <div class="flex items-center space-x-2">
                                                    <button @click="openOpportunityModal(target, 'examine')" 
                                                            class="px-3 py-1 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md transition-colors">View Details</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                    
                                    <!-- Empty State -->
                                    <tr x-show="examineData.length === 0">
                                        <td colspan="7" class="px-6 py-12 text-center">
                                            <div class="text-gray-400 dark:text-gray-600">
                                                <svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No targets for examination</h3>
                                                <p class="text-gray-500 dark:text-gray-400">Complete DISCOVER, PLAN, and ANALYZE stages to generate targets for deep examination</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- STAGE 6: APPROACH (OPPORTUNITIES) -->
                <div x-show="activeStage === 'approach'" class="space-y-6">
                    <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Opportunity Approach <span class="text-lg font-normal">- Comprehensive Grant Application Intelligence & Team Readiness</span></h3>
                    </div>

                    <!-- Profile Intelligence Center -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        
                        <!-- Profile Intelligence Center Header -->
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-xl font-semibold text-gray-900 dark:text-white">Profile Intelligence Center</h4>
                            <div x-show="selectedProfile" class="text-sm text-gray-600 dark:text-gray-400">
                                Selected: <span x-text="selectedProfile?.name" class="font-medium text-gray-900 dark:text-white"></span>
                            </div>
                        </div>

                        <!-- Current Profile Information -->
                        <div x-show="selectedProfile" class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-l-4 border-green-500">
                            <div class="mb-3">
                                <h5 class="font-semibold text-gray-900 dark:text-white">Current Profile</h5>
                            </div>
                            <div class="grid grid-cols-4 gap-3">
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Organization</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedProfile?.name">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">EIN</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedProfile?.ein || 'Not Available'">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Approach Status</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="selectedProfile?.last_approach_date ? formatDate(selectedProfile.last_approach_date) : 'Not Run'">Not Run</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-2 rounded">
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Opportunity Count</div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="opportunitiesData.filter(o => o.funnel_stage === 'opportunities').length || 0">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- No Profile Selected State -->
                        <div x-show="!selectedProfile" class="mb-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h5 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">No Profile Selected</h5>
                                    <p class="text-xs text-yellow-700 dark:text-yellow-300 mt-1">Select an organization profile and progress through DISCOVER ‚Üí PLAN ‚Üí ANALYZE ‚Üí EXAMINE stages to generate strategic pursuit recommendations.</p>
                                    <button @click="switchStage('profiler')" class="mt-2 text-xs bg-yellow-100 dark:bg-yellow-800 hover:bg-yellow-200 dark:hover:bg-yellow-700 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded">
                                        Go to Profiler
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Strategic Approach Tracks -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-green-900 dark:text-green-100">Application Strategy</h5>
                                    <button @click="runApproachTrack('application')" :disabled="approachProgress.application"
                                            class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!approachProgress.application">Run</span>
                                        <span x-show="approachProgress.application">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-green-700 dark:text-green-300">Grant application preparation</p>
                            </div>
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-blue-900 dark:text-blue-100">Partnership Strategy</h5>
                                    <button @click="runApproachTrack('partnership')" :disabled="approachProgress.partnership"
                                            class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!approachProgress.partnership">Run</span>
                                        <span x-show="approachProgress.partnership">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-blue-700 dark:text-blue-300">Strategic relationship building</p>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-purple-900 dark:text-purple-100">Timeline Planning</h5>
                                    <button @click="runApproachTrack('timeline')" :disabled="approachProgress.timeline"
                                            class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!approachProgress.timeline">Run</span>
                                        <span x-show="approachProgress.timeline">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-purple-700 dark:text-purple-300">Execution scheduling</p>
                            </div>
                            <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-orange-900 dark:text-orange-100">Resource Allocation</h5>
                                    <button @click="runApproachTrack('resources')" :disabled="approachProgress.resources"
                                            class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white">
                                        <span x-show="!approachProgress.resources">Run</span>
                                        <span x-show="approachProgress.resources">Running...</span>
                                    </button>
                                </div>
                                <p class="text-sm text-orange-700 dark:text-orange-300">Team and budget planning</p>
                            </div>
                        </div>

                    </div>

                    <!-- Approach Content -->
                    <div x-show="selectedProfile" class="space-y-6">
                        
                        <!-- Strategic Pursuit Dashboard -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Grant Application Intelligence Panel -->
                            <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Grant Application Intelligence</h4>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300">
                                        Ready for Implementation
                                    </span>
                                </div>
                                
                                <!-- Grant Package Generation Status -->
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <div>
                                                <p class="font-medium text-gray-900 dark:text-white">Grant Requirements Analysis</p>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Comprehensive eligibility and documentation requirements</p>
                                            </div>
                                        </div>
                                        <span class="text-sm font-medium text-green-600 dark:text-green-400">Enhanced</span>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <div>
                                                <p class="font-medium text-gray-900 dark:text-white">Application Package Generator</p>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Document templates, checklists, and preparation phases</p>
                                            </div>
                                        </div>
                                        <span class="text-sm font-medium text-green-600 dark:text-green-400">Ready</span>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                            <div>
                                                <p class="font-medium text-gray-900 dark:text-white">Level of Effort (LOE) Estimation</p>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Realistic timeline and resource planning</p>
                                            </div>
                                        </div>
                                        <span class="text-sm font-medium text-blue-600 dark:text-blue-400">Integrated</span>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                            <div>
                                                <p class="font-medium text-gray-900 dark:text-white">Strategic Approach Recommendations</p>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Pursuit strategy, timing, and amount recommendations</p>
                                            </div>
                                        </div>
                                        <span class="text-sm font-medium text-blue-600 dark:text-blue-400">Enhanced</span>
                                    </div>
                                </div>

                                <!-- Generate Grant Package Button -->
                                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <button x-show="selectedTarget" 
                                            @click="generateGrantPackage()" 
                                            class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                                        <div class="flex items-center justify-center space-x-2">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            <span>Generate Comprehensive Grant Package</span>
                                        </div>
                                    </button>
                                    
                                    <div x-show="!selectedTarget" class="text-center py-4">
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Select a target from EXAMINE stage to generate grant application package</p>
                                        <button @click="switchStage('examine')" class="mt-2 text-sm bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-3 py-1 rounded">
                                            Go to Examine
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Grant Team Readiness Panel -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Grant Team Readiness</h4>
                                
                                <!-- Readiness Metrics -->
                                <div class="space-y-4">
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-green-600 dark:text-green-400">75%</div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Team Readiness Score</p>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-2">
                                            <div class="bg-green-600 h-2 rounded-full" style="width: 75%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Grant Requirements</span>
                                            <span class="text-sm font-medium text-green-600 dark:text-green-400">Complete</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Document Templates</span>
                                            <span class="text-sm font-medium text-green-600 dark:text-green-400">Ready</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Application Timeline</span>
                                            <span class="text-sm font-medium text-blue-600 dark:text-blue-400">In Progress</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Strategic Approach</span>
                                            <span class="text-sm font-medium text-blue-600 dark:text-blue-400">Pending</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Team Action Items -->
                                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <h5 class="font-medium text-gray-900 dark:text-white mb-3">Next Steps</h5>
                                    <div class="space-y-2">
                                        <div class="flex items-center space-x-2 text-sm">
                                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                            <span class="text-gray-600 dark:text-gray-400">Review grant requirements analysis</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-sm">
                                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                            <span class="text-gray-600 dark:text-gray-400">Download document templates</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-sm">
                                            <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                            <span class="text-gray-600 dark:text-gray-400">Plan application timeline</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-sm">
                                            <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                                            <span class="text-gray-600 dark:text-gray-400">Execute strategic approach</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Grant Application Package Results (placeholder for future implementation) -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Grant Application Package Generator</h4>
                            <div class="text-center py-8">
                                <div class="mx-auto h-12 w-12 text-gray-400 mb-4">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Comprehensive Grant Package Generation</h3>
                                <p class="text-gray-500 dark:text-gray-400 mb-4">
                                    Enhanced AI Heavy research now includes grant requirements analysis, document templates, 
                                    application checklists, and Level of Effort (LOE) estimation to get your grant team 60-80% ready to apply.
                                </p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                                        <h5 class="font-medium text-blue-800 dark:text-blue-200 mb-2">Grant Requirements</h5>
                                        <p class="text-sm text-blue-700 dark:text-blue-300">Eligibility analysis, documentation requirements, and application criteria</p>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                                        <h5 class="font-medium text-green-800 dark:text-green-200 mb-2">Document Templates</h5>
                                        <p class="text-sm text-green-700 dark:text-green-300">Narrative outlines, budget templates, and writing guidance</p>
                                    </div>
                                    <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg">
                                        <h5 class="font-medium text-purple-800 dark:text-purple-200 mb-2">Application Timeline</h5>
                                        <p class="text-sm text-purple-700 dark:text-purple-300">Preparation phases, milestones, and critical path planning</p>
                                    </div>
                                    <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg">
                                        <h5 class="font-medium text-orange-800 dark:text-orange-200 mb-2">Strategic Approach</h5>
                                        <p class="text-sm text-orange-700 dark:text-orange-300">Pursuit recommendations, timing, and amount optimization</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Strategic Pursuit Recommendations -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Strategic Pursuit Recommendations</h4>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Pursuit Strategy -->
                                <div class="space-y-4">
                                    <h5 class="font-medium text-gray-900 dark:text-white">Pursuit Strategy Framework</h5>
                                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                                        <div class="space-y-3">
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-900 dark:text-white">Request Amount Range:</span>
                                                <span class="text-sm text-green-600 dark:text-green-400 font-medium">AI-Optimized</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-900 dark:text-white">Optimal Timing:</span>
                                                <span class="text-sm text-blue-600 dark:text-blue-400 font-medium">Strategic Windows</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-900 dark:text-white">Success Probability:</span>
                                                <span class="text-sm text-green-600 dark:text-green-400 font-medium">Data-Driven Analysis</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-900 dark:text-white">Level of Effort:</span>
                                                <span class="text-sm text-orange-600 dark:text-orange-400 font-medium">Realistic Planning</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Framework -->
                                <div class="space-y-4">
                                    <h5 class="font-medium text-gray-900 dark:text-white">Grant Team Action Framework</h5>
                                    <div class="space-y-3">
                                        <div class="flex items-center space-x-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                            <div class="flex-1">
                                                <p class="text-sm font-medium text-green-800 dark:text-green-200">Research & Planning</p>
                                                <p class="text-xs text-green-700 dark:text-green-300">Requirements analysis and capacity assessment</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                            <div class="flex-1">
                                                <p class="text-sm font-medium text-blue-800 dark:text-blue-200">Relationship Building</p>
                                                <p class="text-xs text-blue-700 dark:text-blue-300">Stakeholder engagement and network development</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-3 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                            <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                                            <div class="flex-1">
                                                <p class="text-sm font-medium text-purple-800 dark:text-purple-200">Application Development</p>
                                                <p class="text-xs text-purple-700 dark:text-purple-300">Document creation and review cycles</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                            <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                                            <div class="flex-1">
                                                <p class="text-sm font-medium text-orange-800 dark:text-orange-200">Submission & Follow-up</p>
                                                <p class="text-xs text-orange-700 dark:text-orange-300">Final review, submission, and post-application strategy</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Grant Writer Handoff Section -->
                            <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <h5 class="font-medium text-gray-900 dark:text-white mb-3">Grant Writer Handoff Package</h5>
                                <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 p-4 rounded-lg">
                                    <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">
                                        Enhanced AI Heavy research now generates comprehensive grant packages with requirements analysis, 
                                        document templates, application checklists, and strategic recommendations - providing everything 
                                        your grant writer needs to get your team 60-80% ready for application submission.
                                    </p>
                                    <div class="flex space-x-3">
                                        <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-4 rounded transition-colors">
                                            Generate Complete Package
                                        </button>
                                        <button class="bg-white dark:bg-gray-700 border border-blue-600 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm font-medium py-2 px-4 rounded transition-colors">
                                            View Sample Package
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 7: SETTINGS (System Configuration) -->
                <div x-show="activeStage === 'settings'" class="space-y-6">
                    <!-- Pipeline Overview Header -->
                    <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-2xl font-bold">Pipeline Control Center - Real-time processing monitoring and control</h3>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-bold" x-text="activeWorkflows || '0'"></div>
                                <div class="text-sm opacity-90">Active Workflows</div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Metrics Dashboard -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center">
                                <span class="text-2xl mr-3">üìä</span>
                                Profile Metrics Dashboard
                            </h3>
                            <div class="flex items-center space-x-4">
                                <!-- Profile Selector -->
                                <select x-model="selectedMetricsProfile" @change="loadProfileMetrics()" 
                                        class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm">
                                    <option value="">Select Profile</option>
                                    <template x-for="profile in availableProfiles" :key="`dropdown-profile-${profile.profile_id}`">
                                        <option :value="profile.profile_id" x-text="profile.name"></option>
                                    </template>
                                </select>
                                <button @click="refreshMetrics()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
                                    Refresh
                                </button>
                            </div>
                        </div>

                        <!-- Metrics Content -->
                        <div x-show="profileMetrics && selectedMetricsProfile" class="space-y-6">
                            
                            <!-- Key Performance Indicators -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-blue-100 text-sm">Total Opportunities</p>
                                            <p class="text-2xl font-bold" x-text="profileMetrics?.total_opportunities || 0">0</p>
                                        </div>
                                        <div class="text-3xl opacity-80">üéØ</div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-green-100 text-sm">FTE Hours Saved</p>
                                            <p class="text-2xl font-bold" x-text="profileMetrics?.fte_hours_saved || 0">0</p>
                                        </div>
                                        <div class="text-3xl opacity-80">‚è±Ô∏è</div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-4 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-purple-100 text-sm">AI Processing Cost</p>
                                            <p class="text-2xl font-bold" x-text="`$${profileMetrics?.total_ai_cost?.toFixed(2) || '0.00'}`">$0.00</p>
                                        </div>
                                        <div class="text-3xl opacity-80">ü§ñ</div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-4 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-orange-100 text-sm">Success Rate</p>
                                            <p class="text-2xl font-bold" x-text="`${profileMetrics?.success_rate?.toFixed(1) || '0.0'}%`">0.0%</p>
                                        </div>
                                        <div class="text-3xl opacity-80">‚úÖ</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Funnel Progression Chart -->
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Opportunity Funnel Progression</h4>
                                <div class="space-y-4">
                                    <template x-for="(stage, index) in ['prospects', 'qualified_prospects', 'candidates', 'targets', 'opportunities']" :key="stage">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-32 text-sm font-medium text-gray-700 dark:text-gray-300 capitalize" x-text="stage.replace('_', ' ')">Stage</div>
                                            <div class="flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-4">
                                                <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-4 rounded-full transition-all duration-500"
                                                     :style="`width: ${getStagePercentage(stage)}%`"></div>
                                            </div>
                                            <div class="w-16 text-right text-sm font-semibold text-gray-900 dark:text-white" 
                                                 x-text="profileMetrics?.funnel_breakdown?.[stage] || 0">0</div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <!-- API Usage Breakdown -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">API Usage Breakdown</h4>
                                    <div class="space-y-3">
                                        <template x-for="(count, api) in profileMetrics?.api_calls || {}" :key="api">
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="formatApiName(api)">API</span>
                                                <span class="text-sm font-semibold text-gray-900 dark:text-white" x-text="count">0</span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Efficiency Metrics</h4>
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Cache Hit Rate</span>
                                            <span class="text-sm font-semibold text-gray-900 dark:text-white" x-text="`${profileMetrics?.cache_hit_rate?.toFixed(1) || '0.0'}%`">0.0%</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">ROI Multiplier</span>
                                            <span class="text-sm font-semibold text-gray-900 dark:text-white" x-text="`${profileMetrics?.roi_multiplier?.toFixed(1) || '0.0'}x`">0.0x</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">AI Analysis Calls</span>
                                            <span class="text-sm font-semibold text-gray-900 dark:text-white" x-text="profileMetrics?.ai_analysis_calls || 0">0</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">AI Heavy Calls</span>
                                            <span class="text-sm font-semibold text-gray-900 dark:text-white" x-text="profileMetrics?.ai_heavy_calls || 0">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Time Savings Calculator -->
                            <div class="bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg p-6">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">üìà FTE Time Savings Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                                    <div>
                                        <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="`${profileMetrics?.fte_hours_saved || 0} hrs`">0 hrs</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Total Hours Saved</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" x-text="`${profileMetrics?.processing_hours?.toFixed(1) || '0.0'} hrs`">0.0 hrs</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Processing Time</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" x-text="`${profileMetrics?.roi_multiplier?.toFixed(1) || '0.0'}x`">0.0x</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Efficiency Multiplier</div>
                                    </div>
                                </div>
                                <div class="mt-4 text-sm text-gray-600 dark:text-gray-400 text-center">
                                    <p>Automation has saved approximately <span class="font-semibold text-green-600 dark:text-green-400" x-text="`${(profileMetrics?.fte_hours_saved / 2080 * 100)?.toFixed(1) || '0.0'}%`">0.0%</span> of a full-time employee's annual work</p>
                                </div>
                            </div>
                            
                        </div>
                        
                        <!-- No Profile Selected State -->
                        <div x-show="!selectedMetricsProfile" class="text-center py-12 text-gray-500 dark:text-gray-400">
                            <div class="text-4xl mb-4">üìä</div>
                            <p class="text-lg">Select a profile to view detailed metrics</p>
                            <p class="text-sm mt-2">Track API usage, funnel progression, FTE hours saved, and more</p>
                        </div>
                        
                        <!-- No Metrics Data State -->
                        <div x-show="selectedMetricsProfile && (!profileMetrics || profileMetrics.error)" class="text-center py-12 text-gray-500 dark:text-gray-400">
                            <div class="text-4xl mb-4">üìà</div>
                            <p class="text-lg">No metrics data available</p>
                            <p class="text-sm mt-2">Run some discovery sessions to start generating metrics</p>
                        </div>
                    </div>

                    <!-- Pipeline Stage Status Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div><p class="text-sm font-medium text-gray-600 dark:text-gray-400">Stage 1: Discovery</p><p class="text-2xl font-bold text-gray-900 dark:text-white">12</p></div>
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-bold">1</div>
                            </div>
                            <div class="mt-2 flex items-center">
                                <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-blue-500 h-2 rounded-full" style="width: 75%"></div></div>
                                <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">75%</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-yellow-500">
                            <div class="flex items-center justify-between">
                                <div><p class="text-sm font-medium text-gray-600 dark:text-gray-400">Stage 2: Pre-Scoring</p><p class="text-2xl font-bold text-gray-900 dark:text-white">8</p></div>
                                <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center text-white text-sm font-bold">2</div>
                            </div>
                            <div class="mt-2 flex items-center">
                                <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-yellow-500 h-2 rounded-full" style="width: 45%"></div></div>
                                <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">45%</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-purple-500">
                            <div class="flex items-center justify-between">
                                <div><p class="text-sm font-medium text-gray-600 dark:text-gray-400">Stage 3: Analysis</p><p class="text-2xl font-bold text-gray-900 dark:text-white">5</p></div>
                                <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold">3</div>
                            </div>
                            <div class="mt-2 flex items-center">
                                <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-purple-500 h-2 rounded-full" style="width: 25%"></div></div>
                                <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">25%</span>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div><p class="text-sm font-medium text-gray-600 dark:text-gray-400">Stage 4: Recommendations</p><p class="text-2xl font-bold text-gray-900 dark:text-white">15</p></div>
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-bold">4</div>
                            </div>
                            <div class="mt-2 flex items-center">
                                <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full" style="width: 90%"></div></div>
                                <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">90%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Live Processing Activity -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Live Processing Activity</h4>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse mr-3"></div>
                                    <div><p class="font-medium">Profile: Tech Nonprofit Foundation</p><p class="text-sm text-gray-600 dark:text-gray-400">Discovery stage - Processing 247 opportunities</p></div>
                                </div>
                                <span class="text-sm font-medium text-blue-600 dark:text-blue-400">Stage 1</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse mr-3"></div>
                                    <div><p class="font-medium">Profile: Healthcare Initiative</p><p class="text-sm text-gray-600 dark:text-gray-400">Pre-scoring 189 candidates</p></div>
                                </div>
                                <span class="text-sm font-medium text-yellow-600 dark:text-yellow-400">Stage 2</span>
                            </div>
                        </div>
                    </div>

                    <!-- Resource Allocation & Controls -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Resource Allocation</h4>
                            <div class="space-y-4">
                                <div><div class="flex justify-between text-sm mb-1"><span>CPU Usage</span><span>68%</span></div><div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-blue-500 h-2 rounded-full" style="width: 68%"></div></div></div>
                                <div><div class="flex justify-between text-sm mb-1"><span>API Rate Limit</span><span>23%</span></div><div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full" style="width: 23%"></div></div></div>
                                <div><div class="flex justify-between text-sm mb-1"><span>Queue Depth</span><span>45%</span></div><div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"><div class="bg-yellow-500 h-2 rounded-full" style="width: 45%"></div></div></div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pipeline Controls</h4>
                            <div class="space-y-3">
                                <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">Start New Pipeline</button>
                                <button class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded-md transition-colors">Pause All Processing</button>
                                <button class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md transition-colors">Emergency Stop</button>
                                <button class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition-colors">View Detailed Logs</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Global Status Tab - DEPRECATED: Functionality moved to System Controls -->
                <div x-show="false" class="space-y-6">
                    
                    <!-- Real-Time Workflow Narration -->
                    <div x-show="workflowNarration.isNarrating" x-transition class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6">
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-lg font-semibold text-blue-900 dark:text-blue-100">Research in Progress</h3>
                                    <span class="text-sm text-blue-600 dark:text-blue-300">Live Analysis</span>
                                </div>
                                <p class="text-blue-800 dark:text-blue-200 text-base leading-relaxed" x-text="workflowNarration.currentStory">
                                    Currently analyzing your organization's opportunities...
                                </p>
                                <div class="mt-3 text-sm text-blue-600 dark:text-blue-400">
                                    <span class="inline-flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                        What this means: This step helps identify the best strategic opportunities for your organization
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Workflow Phase Progress -->
                    <div x-show="processFlow.steps.length > 0" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Research Workflow</h3>
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                <span x-text="workflowNarration.getPhaseContext(processFlow.currentPhase || 'discovery')"></span>
                            </div>
                        </div>
                        
                        <!-- Workflow Steps Visualization -->
                        <div class="relative">
                            <!-- Progress Line -->
                            <div class="absolute left-8 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-600"></div>
                            <div class="absolute left-8 top-0 w-0.5 bg-gradient-to-b from-blue-500 to-green-500 transition-all duration-500"
                                 :style="`height: ${getProcessFlowProgress()}%`"></div>
                            
                            <!-- Steps -->
                            <div class="space-y-6">
                                <template x-for="(step, index) in processFlow.steps.slice(0, 4)" :key="`process-flow-limited-${index}`">
                                    <div class="relative flex items-center space-x-4">
                                        <!-- Step Icon -->
                                        <div class="relative flex-shrink-0">
                                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold"
                                                 :class="{
                                                     'bg-gray-200 text-gray-500': step.status === 'pending',
                                                     'bg-blue-500 text-white animate-pulse': step.status === 'active',
                                                     'bg-green-500 text-white': step.status === 'completed',
                                                     'bg-red-500 text-white': step.status === 'error'
                                                 }"
                                                 x-text="index + 1">1</div>
                                        </div>
                                        
                                        <!-- Step Content -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center justify-between">
                                                <h4 class="text-sm font-medium text-gray-900 dark:text-white" x-text="step.label">Step Name</h4>
                                                <span class="text-xs px-2 py-1 rounded-full"
                                                      :class="{
                                                          'bg-gray-100 text-gray-600': step.status === 'pending',
                                                          'bg-blue-100 text-blue-700': step.status === 'active',
                                                          'bg-green-100 text-green-700': step.status === 'completed',
                                                          'bg-red-100 text-red-700': step.status === 'error'
                                                      }"
                                                      x-text="step.status">pending</span>
                                            </div>
                                            <p x-show="step.message" class="mt-1 text-sm text-gray-600 dark:text-gray-400" x-text="step.message"></p>
                                            
                                            <!-- "Why This Matters" for nonprofit audience -->
                                            <div x-show="step.status === 'active' || step.status === 'completed'" class="mt-2 text-xs text-blue-600 dark:text-blue-400">
                                                <span x-text="workflowNarration.getCurrentStageDescription('discovery', index)"></span>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        
                        <!-- Overall Progress Bar -->
                        <div class="mt-6">
                            <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2">
                                <span>Research Progress</span>
                                <span x-text="`${getProcessFlowProgress().toFixed(0)}% Complete`">0% Complete</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full transition-all duration-500"
                                     :style="`width: ${getProcessFlowProgress()}%`"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Session History & Next Steps (for active sessions) -->
                    <div x-show="workflowNarration.storyHistory.length > 0" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Session Overview</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Key Insights -->
                            <div>
                                <h4 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Key Insights Discovered</h4>
                                <ul class="space-y-2">
                                    <template x-for="insight in workflowNarration.extractKeyInsights()" :key="insight">
                                        <li class="flex items-start space-x-2 text-sm text-gray-600 dark:text-gray-400">
                                            <svg class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                            </svg>
                                            <span x-text="insight">Insight discovered</span>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                            
                            <!-- Next Steps -->
                            <div>
                                <h4 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Recommended Next Steps</h4>
                                <ul class="space-y-2">
                                    <template x-for="(step, index) in workflowNarration.generateNextSteps(selectedProfile?.name || 'Your Organization').slice(0, 3)" :key="index">
                                        <li class="flex items-start space-x-2 text-sm text-gray-600 dark:text-gray-400">
                                            <span class="w-4 h-4 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mt-0.5 flex-shrink-0" 
                                                  x-text="index + 1">1</span>
                                            <span x-text="step">Next step</span>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    
                    
                        
                        <!-- Real-time Performance Metrics -->
                        <div class="status-card">
                            <div class="status-card-header">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Performance Metrics</h3>
                                <div class="live-indicator">
                                    <div class="live-dot"></div>
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Live</span>
                                </div>
                            </div>
                            <div class="status-card-body">
                                <div class="metrics-grid">
                                    <div class="metric-card">
                                        <span class="metric-value" x-text="formatDuration(performanceMetrics.averageProcessingTime)">0ms</span>
                                        <span class="metric-label">Avg Processing Time</span>
                                        <span class="metric-change" 
                                              :class="getPerformanceClass('responseTime', performanceMetrics.averageProcessingTime)"
                                              x-text="`${performanceMetrics.averageProcessingTime > 1000 ? '‚Üë' : '‚Üì'} ${performanceMetrics.averageProcessingTime > 1000 ? 'Slow' : 'Fast'}`">
                                        </span>
                                    </div>
                                    <div class="metric-card">
                                        <span class="metric-value" x-text="performanceMetrics.throughputPerSecond.toFixed(2)">0.00</span>
                                        <span class="metric-label">Ops/Second</span>
                                        <span class="metric-change" 
                                              :class="getPerformanceClass('throughput', performanceMetrics.throughputPerSecond)"
                                              x-text="`${performanceMetrics.throughputPerSecond > 1 ? '‚Üë' : '‚Üì'} ${performanceMetrics.throughputPerSecond > 1 ? 'High' : 'Low'}`">
                                        </span>
                                    </div>
                                    <div class="metric-card">
                                        <span class="metric-value" x-text="performanceMetrics.successRate.toFixed(1) + '%'">100%</span>
                                        <span class="metric-label">Success Rate</span>
                                        <span class="metric-change" 
                                              :class="getPerformanceClass('successRate', performanceMetrics.successRate)"
                                              x-text="`${performanceMetrics.successRate >= 90 ? '‚Üë' : '‚Üì'} ${performanceMetrics.successRate >= 90 ? 'Excellent' : 'Needs Attention'}`">
                                        </span>
                                    </div>
                                    <div class="metric-card">
                                        <span class="metric-value" x-text="realTimeStatus.latency.toFixed(0) + 'ms'">0ms</span>
                                        <span class="metric-label">Latency</span>
                                        <span class="metric-change" 
                                              :class="getPerformanceClass('latency', realTimeStatus.latency)"
                                              x-text="`${realTimeStatus.latency <= 100 ? '‚Üì' : '‚Üë'} ${realTimeStatus.latency <= 100 ? 'Low' : 'High'}`">
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="status-card-footer">
                                <div class="timing-display">
                                    <div class="timing-metric">
                                        <span class="timing-value" x-text="performanceMetrics.currentOperations">0</span>
                                        <span class="timing-label">Active</span>
                                    </div>
                                    <div class="timing-metric">
                                        <span class="timing-value" x-text="performanceMetrics.completedOperations">0</span>
                                        <span class="timing-label">Completed</span>
                                    </div>
                                    <div class="timing-metric">
                                        <span class="timing-value" x-text="performanceMetrics.errorCount">0</span>
                                        <span class="timing-label">Errors</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- System Status Dashboard -->
                        <div class="status-card">
                            <div class="status-card-header">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">System Status</h3>
                                <div class="status-indicator status-healthy">
                                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                    <span x-text="systemStatus === 'healthy' ? 'Healthy' : 'Degraded'">Healthy</span>
                                </div>
                            </div>
                            <div class="status-card-body space-y-4">
                                <!-- Connection Status -->
                                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-2 h-2 rounded-full" 
                                             :class="realTimeStatus.connectionStatus === 'connected' ? 'bg-green-500' : 'bg-red-500'"></div>
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">WebSocket Connection</span>
                                    </div>
                                    <span class="text-sm" 
                                          :class="realTimeStatus.connectionStatus === 'connected' ? 'text-green-600' : 'text-red-600'"
                                          x-text="realTimeStatus.connectionStatus">Disconnected</span>
                                </div>
                                
                                <!-- API Status -->
                                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">API Services</span>
                                    </div>
                                    <span class="text-sm text-green-600" x-text="apiStatus">Healthy</span>
                                </div>
                                
                                <!-- Processors Status -->
                                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Processors Available</span>
                                    </div>
                                    <span class="text-sm text-blue-600" x-text="stats.processorsAvailable || '18'">18</span>
                                </div>
                                
                                <!-- Messages Processed -->
                                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Messages Processed</span>
                                    </div>
                                    <span class="text-sm text-purple-600" x-text="realTimeStatus.messageCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Process Flow Visualization -->
                    <div x-show="processFlow.steps.length > 0" class="status-card">
                        <div class="status-card-header">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Process Flow</h3>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-gray-600 dark:text-gray-400" 
                                      x-text="`Step ${processFlow.currentStep + 1} of ${processFlow.totalSteps}`">Step 1 of 5</span>
                                <span class="text-sm text-gray-600 dark:text-gray-400" 
                                      x-text="`${getProcessFlowProgress().toFixed(0)}% Complete`">0% Complete</span>
                            </div>
                        </div>
                        <div class="status-card-body">
                            <!-- Progress Bar -->
                            <div class="progress-container mb-6">
                                <div class="progress-bar progress-striped" 
                                     :style="`width: ${getProcessFlowProgress()}%`"></div>
                            </div>
                            
                            <!-- Process Steps -->
                            <div class="process-flow">
                                <template x-for="(step, index) in processFlow.steps" :key="`process-flow-all-${index}`">
                                    <div class="flex items-center">
                                        <div class="process-step">
                                            <div class="process-step-icon" 
                                                 :class="{
                                                     'process-step-pending': step.status === 'pending',
                                                     'process-step-active': step.status === 'active',
                                                     'process-step-completed': step.status === 'completed',
                                                     'process-step-error': step.status === 'error'
                                                 }"
                                                 x-text="index + 1">1</div>
                                            <div class="process-step-label" x-text="step.label">Step</div>
                                            <div x-show="step.message" class="text-xs text-gray-500 mt-1" x-text="step.message"></div>
                                        </div>
                                        <div x-show="index < processFlow.steps.length - 1" 
                                             class="process-connector"
                                             :class="{'process-connector-active': step.status === 'completed'}"></div>
                                    </div>
                                </template>
                            </div>
                            
                            <!-- Time Estimates -->
                            <div x-show="processFlow.estimatedTimeRemaining > 0" class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-blue-700 dark:text-blue-300">Estimated Time Remaining:</span>
                                    <span class="text-sm font-medium text-blue-800 dark:text-blue-200" 
                                          x-text="formatDuration(processFlow.estimatedTimeRemaining)">0ms</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                        
                        <!-- Info Message Example -->
                        <div x-show="realTimeStatus.messageCount > 0" class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 border-l-4 border-l-blue-500 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-blue-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-sm font-medium text-blue-800 dark:text-blue-200">
                                    Real-time monitoring active - <span x-text="realTimeStatus.messageCount">0</span> messages processed
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Tab -->
                <div x-show="false && activeTab === 'dashboard'" class="space-y-6">
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 transition-all duration-300 hover:shadow-xl hover:scale-105 animate-fade-in">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Active Workflows</p>
                                    <p class="text-3xl font-semibold text-gray-900 dark:text-white" x-text="stats.activeWorkflows"></p>
                                </div>
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center text-blue-600 dark:text-blue-400">
                                    üîÑ
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 transition-all duration-300 hover:shadow-xl hover:scale-105 animate-fade-in">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Organizations Processed</p>
                                    <p class="text-3xl font-semibold text-gray-900 dark:text-white" x-text="stats.totalProcessed.toLocaleString()"></p>
                                </div>
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center text-green-600 dark:text-green-400">
                                    üìä
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 transition-all duration-300 hover:shadow-xl hover:scale-105 animate-fade-in">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Success Rate</p>
                                    <p class="text-3xl font-semibold text-gray-900 dark:text-white"><span x-text="(stats.successRate * 100).toFixed(1)"></span>%</p>
                                </div>
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center text-green-600 dark:text-green-400">
                                    ‚úÖ
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 transition-all duration-300 hover:shadow-xl hover:scale-105 animate-fade-in">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Available Processors</p>
                                    <p class="text-3xl font-semibold text-gray-900 dark:text-white" x-text="stats.processorsAvailable"></p>
                                </div>
                                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/50 rounded-full flex items-center justify-center text-purple-600 dark:text-purple-400">
                                    ‚öôÔ∏è
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Progress Monitor -->
                    <div x-show="liveProgress.workflow_id" class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900">üî¥ LIVE: <span x-text="liveProgress.current_processor || 'Processing'"></span></h3>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Active</span>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div class="space-y-4">
                                <!-- Current Organization -->
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Current Organization:</span>
                                    <span class="font-medium" x-text="liveProgress.current_organization || 'Loading...'"></span>
                                </div>
                                
                                <!-- Progress Bar -->
                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-600">Progress</span>
                                        <span class="font-medium">
                                            <span x-text="liveProgress.processed_count || 0"></span> / 
                                            <span x-text="liveProgress.total_count || 0"></span>
                                            (<span x-text="Math.round(liveProgress.progress_percentage || 0)"></span>%)
                                        </span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div class="bg-blue-600 h-3 rounded-full transition-all duration-300" 
                                             :style="`width: ${liveProgress.progress_percentage || 0}%`"></div>
                                    </div>
                                </div>
                                
                                <!-- Performance Metrics -->
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-600">Speed: </span>
                                        <span class="font-semibold" x-text="(liveProgress.processing_speed || 0).toFixed(1)"></span> orgs/sec
                                    </div>
                                    <div>
                                        <span class="text-gray-600">ETA: </span>
                                        <span class="font-semibold" x-text="liveProgress.eta_minutes ? Math.round(liveProgress.eta_minutes) + ' min' : 'Calculating...'"></span>
                                    </div>
                                </div>
                                
                                <!-- Qualification Breakdown -->
                                <div x-show="liveProgress.qualification_breakdown">
                                    <h4 class="text-sm font-medium text-gray-900 mb-2">Live Qualification Breakdown:</h4>
                                    <div class="space-y-1">
                                        <template x-for="[factor, count] in Object.entries(liveProgress.qualification_breakdown || {})" :key="factor">
                                            <div class="flex justify-between text-sm">
                                                <span x-text="factor"></span>
                                                <span class="font-medium">
                                                    <span x-text="count"></span> 
                                                    (<span x-text="liveProgress.processed_count > 0 ? ((count / liveProgress.processed_count) * 100).toFixed(1) : 0"></span>%)
                                                </span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Workflows -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Recent Activity</h3>
                        </div>
                        <div class="p-6">
                            <div x-show="recentActivity.length === 0" class="text-center text-gray-500 py-8">
                                No recent activity
                            </div>
                            <div x-show="recentActivity.length > 0" class="space-y-4">
                                <template x-for="activity in recentActivity" :key="activity.id">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                <span x-text="activity.type === 'classification' ? 'üß†' : 'üîÑ'"></span>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900" x-text="activity.name"></h4>
                                                <p class="text-sm text-gray-600" x-text="activity.description"></p>
                                            </div>
                                        </div>
                                        <div class="text-sm text-gray-500" x-text="activity.time"></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Classification Tab -->
                <div x-show="false && activeTab === 'classification'" class="space-y-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 transition-all duration-300 animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">üß† Intelligent Classification</h3>
                        
                        <!-- Classification Form -->
                        <form @submit.prevent="startClassification()" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                                    <select x-model="classificationParams.state" class="w-full rounded-md border-gray-300 shadow-sm">
                                        <option value="VA">Virginia</option>
                                        <option value="MD">Maryland</option>
                                        <option value="DC">District of Columbia</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Minimum Score</label>
                                    <input type="number" x-model="classificationParams.minScore" min="0" max="1" step="0.1" 
                                           class="w-full rounded-md border-gray-300 shadow-sm">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Maximum Results</label>
                                    <input type="number" x-model="classificationParams.maxResults" min="1" max="10000" 
                                           class="w-full rounded-md border-gray-300 shadow-sm">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Export Format</label>
                                    <select x-model="classificationParams.exportFormat" class="w-full rounded-md border-gray-300 shadow-sm">
                                        <option value="csv">CSV</option>
                                        <option value="json">JSON</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="flex items-center">
                                <input type="checkbox" x-model="classificationParams.detailedAnalysis" id="detailed" 
                                       class="rounded border-gray-300 mr-2">
                                <label for="detailed" class="text-sm text-gray-700">Include detailed qualification analysis</label>
                            </div>
                            
                            <div class="pt-4">
                                <button type="submit" 
                                        :disabled="isRunningClassification"
                                        :class="isRunningClassification ? 'bg-gray-400 cursor-not-allowed' : 'bg-primary-600 hover:bg-primary-700 hover:scale-105'"
                                        class="px-6 py-3 text-white rounded-md font-medium transition-all duration-200 transform">
                                    <span x-show="!isRunningClassification" class="flex items-center">
                                        <span class="mr-2">üöÄ</span> Start Classification
                                    </span>
                                    <span x-show="isRunningClassification" class="flex items-center">
                                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        Processing...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Loading Skeleton for Classification Results -->
                    <div x-show="isRunningClassification && classificationResults.length === 0" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                        <div class="animate-pulse">
                            <div class="flex items-center justify-between mb-4">
                                <div class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-48"></div>
                                <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-24"></div>
                            </div>
                            <div class="space-y-3">
                                <div class="grid grid-cols-5 gap-4">
                                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded"></div>
                                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded"></div>
                                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded"></div>
                                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded"></div>
                                    <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded"></div>
                                </div>
                                <div x-data="{}" x-init="() => { for(let i = 0; i < 5; i++) { setTimeout(() => { $el.appendChild($el.firstElementChild.cloneNode(true)) }, i * 200) } }">
                                    <div class="grid grid-cols-5 gap-4">
                                        <div class="h-12 bg-gray-200 dark:bg-gray-700 rounded"></div>
                                        <div class="h-12 bg-gray-200 dark:bg-gray-700 rounded"></div>
                                        <div class="h-12 bg-gray-200 dark:bg-gray-700 rounded"></div>
                                        <div class="h-12 bg-gray-200 dark:bg-gray-700 rounded"></div>
                                        <div class="h-12 bg-gray-200 dark:bg-gray-700 rounded"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 text-center">
                                <div class="inline-flex items-center text-sm text-gray-500 dark:text-gray-400">
                                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Analyzing organizations...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Classification Results -->
                    <div x-show="classificationResults.length > 0" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 animate-slide-up">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Classification Results</h3>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-600 dark:text-gray-400" x-text="`${classificationResults.length} results`"></span>
                                    <input type="text" placeholder="Search organizations..." 
                                           class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                           x-model="searchQuery" @input="filterResults()">
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" @click="sortResults('name')">
                                                Organization
                                                <span x-show="sortField === 'name'" class="ml-1">
                                                    <span x-show="sortDirection === 'asc'">‚Üë</span>
                                                    <span x-show="sortDirection === 'desc'">‚Üì</span>
                                                </span>
                                            </th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" @click="sortResults('composite_score')">
                                                Score
                                                <span x-show="sortField === 'composite_score'" class="ml-1">
                                                    <span x-show="sortDirection === 'asc'">‚Üë</span>
                                                    <span x-show="sortDirection === 'desc'">‚Üì</span>
                                                </span>
                                            </th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Category</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Qualification</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Location</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="result in filteredResults.slice(0, 50)" :key="result.id || result.ein || result.name || $index">
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="result.name"></div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="result.ein"></div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-semibold text-gray-900 dark:text-white" x-text="(result.composite_score || 0).toFixed(3)"></div>
                                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1 mt-1">
                                                        <div class="bg-blue-600 h-1 rounded-full transition-all duration-300" 
                                                             :style="`width: ${(result.composite_score || 0) * 100}%`"></div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200"
                                                          x-text="result.predicted_category || 'N/A'"></span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900 dark:text-white" x-text="result.primary_qualification_reason || 'N/A'"></div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="result.qualification_strength || ''"></div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                                    <span x-text="(result.city || '') + ', ' + (result.state || '')"></span>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Workflows Tab -->
                <div x-show="false && activeTab === 'workflows'" class="space-y-6">
                    
                    <!-- New Workflow Form -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                            <span class="text-2xl mr-3">üöÄ</span>
                            Create New Workflow
                        </h3>
                        
                        <form @submit.prevent="startWorkflow()" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Workflow Type</label>
                                    <select x-model="workflowParams.type" class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                        <option value="standard">Standard Grant Research</option>
                                        <option value="classification">Intelligent Classification</option>
                                        <option value="analytics">Advanced Analytics</option>
                                        <option value="combined">Combined Analysis</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Target State</label>
                                    <select x-model="workflowParams.state" class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                        <option value="VA">Virginia</option>
                                        <option value="MD">Maryland</option>
                                        <option value="DC">District of Columbia</option>
                                        <option value="NC">North Carolina</option>
                                        <option value="WV">West Virginia</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Maximum Results</label>
                                    <input type="number" x-model="workflowParams.maxResults" min="1" max="10000" 
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Minimum Revenue</label>
                                    <input type="number" x-model="workflowParams.minRevenue" min="0" step="1000"
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">NTEE Codes (Health & Nutrition Focus)</label>
                                <div class="grid grid-cols-3 md:grid-cols-7 gap-2">
                                    <template x-for="code in availableNteeCodes" :key="code.code">
                                        <label class="flex items-center p-2 border dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                            <input type="checkbox" :value="code.code" x-model="workflowParams.nteeCodes" 
                                                   class="rounded border-gray-300 dark:border-gray-600 mr-2">
                                            <div>
                                                <div class="text-sm font-medium" x-text="code.code"></div>
                                                <div class="text-xs text-gray-500 dark:text-gray-400" x-text="code.name"></div>
                                            </div>
                                        </label>
                                    </template>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-4">
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="workflowParams.includeClassified" 
                                           class="rounded border-gray-300 dark:border-gray-600 mr-2">
                                    <span class="text-sm text-gray-700 dark:text-gray-300">Include intelligent classification</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="workflowParams.exportResults" 
                                           class="rounded border-gray-300 dark:border-gray-600 mr-2">
                                    <span class="text-sm text-gray-700 dark:text-gray-300">Auto-export results</span>
                                </label>
                            </div>
                            
                            <div class="pt-4 border-t dark:border-gray-700">
                                <button type="submit" 
                                        :disabled="isRunningWorkflow"
                                        :class="isRunningWorkflow ? 'bg-gray-400 cursor-not-allowed' : 'bg-primary-600 hover:bg-primary-700 hover:scale-105'"
                                        class="px-8 py-3 text-white rounded-md font-medium transition-all duration-200 transform flex items-center">
                                    <span x-show="!isRunningWorkflow" class="flex items-center">
                                        <span class="mr-2">üöÄ</span> Start Workflow
                                    </span>
                                    <span x-show="isRunningWorkflow" class="flex items-center">
                                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        Processing...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Processor Controls -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                            <span class="text-2xl mr-3">‚öôÔ∏è</span>
                            Advanced Processor Controls
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Government Scoring -->
                            <div class="p-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Government Scoring</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-center justify-between">
                                        <span>Grants.gov Integration</span>
                                        <span class="text-green-600 dark:text-green-400">‚úì Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span>USASpending.gov</span>
                                        <span class="text-green-600 dark:text-green-400">‚úì Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span>Opportunity Scorer</span>
                                        <span class="text-green-600 dark:text-green-400">‚úì Ready</span>
                                    </div>
                                </div>
                                <button class="w-full mt-3 px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                    Run Government Analysis
                                </button>
                            </div>

                            <!-- Document Processing -->
                            <div class="p-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Document Processing</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-center justify-between">
                                        <span>XML Downloader</span>
                                        <span class="text-green-600 dark:text-green-400">‚úì Ready</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span>PDF Downloader</span>
                                        <span class="text-green-600 dark:text-green-400">‚úì Ready</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span>OCR Processing</span>
                                        <span class="text-green-600 dark:text-green-400">‚úì Ready</span>
                                    </div>
                                </div>
                                <button class="w-full mt-3 px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                    Process Documents
                                </button>
                            </div>

                            <!-- Data Validation -->
                            <div class="p-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Data Validation</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-center justify-between">
                                        <span>EIN Cross-Reference</span>
                                        <span class="text-green-600 dark:text-green-400">‚úì Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span>Schedule I Processor</span>
                                        <span class="text-green-600 dark:text-green-400">‚úì Ready</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span>Data Integrity Check</span>
                                        <span class="text-yellow-600 dark:text-yellow-400">‚ö† Manual</span>
                                    </div>
                                </div>
                                <button class="w-full mt-3 px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                    Validate Data
                                </button>
                            </div>
                        </div>
                        
                        <!-- All Processors Status -->
                        <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <h4 class="font-medium text-gray-900 dark:text-white mb-3">System Status - 18 Processors</h4>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 text-sm">
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">EIN Lookup</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">BMF Filter</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">ProPublica</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">Financial Scorer</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">Classifier</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">Trend Analysis</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">Risk Assessor</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">Network Analysis</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">Competitive Intel</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">Grants.gov</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">USASpending</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-gray-700 dark:text-gray-300">XML/PDF/OCR</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Active Workflows -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 animate-fade-in">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                    <span class="text-2xl mr-3">‚ö°</span>
                                    Active Workflows
                                </h3>
                                <button @click="loadWorkflows()" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div x-show="activeWorkflowsList.length === 0" class="text-center text-gray-500 dark:text-gray-400 py-8">
                                <div class="text-4xl mb-4">üí§</div>
                                <p>No active workflows</p>
                                <p class="text-sm mt-2">Start a new workflow above to begin processing</p>
                            </div>
                            
                            <div x-show="activeWorkflowsList.length > 0" class="space-y-4">
                                <template x-for="workflow in activeWorkflowsList" :key="workflow.workflow_id">
                                    <div class="border dark:border-gray-600 rounded-lg p-4 hover:shadow-md dark:hover:shadow-gray-900/50 transition-all duration-200">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center">
                                                <div class="w-3 h-3 bg-green-400 rounded-full mr-3 animate-pulse"></div>
                                                <h4 class="font-semibold text-gray-900 dark:text-white" x-text="workflow.name || workflow.workflow_id"></h4>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200 text-xs rounded-full font-medium"
                                                      x-text="workflow.status"></span>
                                                <button @click="stopWorkflow(workflow.workflow_id)" 
                                                        class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 text-sm">
                                                    Stop
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                            <div>
                                                <span class="text-gray-600 dark:text-gray-400">Type:</span>
                                                <span class="font-medium ml-1" x-text="workflow.type || 'Standard'"></span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600 dark:text-gray-400">Progress:</span>
                                                <span class="font-medium ml-1">
                                                    <span x-text="workflow.processed_count || 0"></span>/<span x-text="workflow.total_count || 0"></span>
                                                </span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600 dark:text-gray-400">Speed:</span>
                                                <span class="font-medium ml-1" x-text="(workflow.processing_speed || 0).toFixed(1)"></span> orgs/sec
                                            </div>
                                            <div>
                                                <span class="text-gray-600 dark:text-gray-400">Started:</span>
                                                <span class="font-medium ml-1" x-text="formatTimeAgo(workflow.started_at)"></span>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-3">
                                            <div class="flex justify-between text-sm mb-1">
                                                <span class="text-gray-600 dark:text-gray-400">Progress</span>
                                                <span class="font-medium" x-text="Math.round(workflow.progress_percentage || 0)"></span>%
                                            </div>
                                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                                     :style="`width: ${workflow.progress_percentage || 0}%`"></div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Workflow History -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 animate-fade-in">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <span class="text-2xl mr-3">üìö</span>
                                Workflow History
                            </h3>
                        </div>
                        
                        <div class="p-6">
                            <div x-show="workflowHistory.length === 0" class="text-center text-gray-500 dark:text-gray-400 py-8">
                                No completed workflows
                            </div>
                            
                            <div x-show="workflowHistory.length > 0" class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Workflow</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Results</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Completed</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="workflow in workflowHistory.slice(0, 10)" :key="workflow.workflow_id">
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="workflow.name || workflow.workflow_id"></div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="workflow.workflow_id"></div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="workflow.type || 'Standard'"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="workflow.organizations_processed || 0"></td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span :class="workflow.status === 'completed' ? 'bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200' : 
                                                                 workflow.status === 'error' ? 'bg-red-100 dark:bg-red-900/50 text-red-800 dark:text-red-200' : 
                                                                 'bg-gray-100 dark:bg-gray-900/50 text-gray-800 dark:text-gray-200'"
                                                          class="px-2 py-1 text-xs font-semibold rounded-full" x-text="workflow.status"></span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400" x-text="formatTimeAgo(workflow.completed_at)"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                                                    <button @click="viewWorkflowResults(workflow.workflow_id)" 
                                                            class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                                        View
                                                    </button>
                                                    <button @click="exportWorkflow(workflow.workflow_id)" 
                                                            class="text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300">
                                                        Export
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profiles Tab (Hidden - Functionality moved to Profiler stage) -->
                <div x-show="false" class="space-y-6">
                    <!-- Profile Management Header -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 transition-all duration-300 animate-fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <span class="text-2xl mr-3">üë§</span>
                                Organization Profiles
                            </h3>
                            <div class="flex space-x-3">
                                <button @click="openCreateProfile()" 
                                        class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center">
                                    <span class="text-lg mr-2">‚ûï</span>
                                    Create Profile
                                </button>
                                <button @click="loadProfiles()" 
                                        class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center">
                                    <span class="text-lg mr-2">üîÑ</span>
                                    Refresh
                                </button>
                                <button @click="createSampleProfiles()" 
                                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center">
                                    <span class="text-lg mr-2">üìÅ</span>
                                    Sample Data
                                </button>
                            </div>
                        </div>
                        
                        <!-- Profile Stats - Compact -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-2">
                            <div class="bg-gray-50 dark:bg-gray-700 p-2 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-lg font-bold text-gray-900 dark:text-white" x-text="profileStats.total || 0"></span>
                                    <span class="text-sm font-bold text-gray-600 dark:text-gray-400">Total Profiles</span>
                                </div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 p-2 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-lg font-bold text-green-600 dark:text-green-400" x-text="profileStats.active || 0"></span>
                                    <span class="text-sm font-bold text-gray-600 dark:text-gray-400">Active Profiles</span>
                                </div>
                            </div>
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-lg font-bold text-blue-600 dark:text-blue-400" x-text="profileStats.opportunities || 0"></span>
                                    <span class="text-sm font-bold text-gray-600 dark:text-gray-400">Total Opportunities</span>
                                </div>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900/20 p-2 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-lg font-bold text-purple-600 dark:text-purple-400" x-text="profileStats.templates || 0"></span>
                                    <span class="text-sm font-bold text-gray-600 dark:text-gray-400">Templates</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Profile Dashboard (when profile is selected) -->
                    <div x-show="selectedProfile" class="space-y-6">
                        <!-- Profile Journey Overview -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white" x-text="selectedProfile?.name">Organization Name</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400" x-text="selectedProfile?.organization_type">Organization Type</p>
                                </div>
                                <div class="flex space-x-3">
                                    <button @click="startProfileAnalysis(selectedProfile)" 
                                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                                        </svg>
                                        Start Analysis
                                    </button>
                                    <button @click="generateExecutiveSummary(selectedProfile)" 
                                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4z" clip-rule="evenodd"></path>
                                        </svg>
                                        Executive Summary
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Profile Journey Timeline -->
                            <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Research Journey</h4>
                                <div class="relative">
                                    <!-- Timeline Line -->
                                    <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-600"></div>
                                    
                                    <!-- Timeline Items -->
                                    <div class="space-y-6">
                                        <template x-for="(session, index) in getProfileSessions(selectedProfile?.profile_id)" :key="index">
                                            <div class="relative flex items-start space-x-4">
                                                <div class="flex-shrink-0">
                                                    <div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                                                        <span class="text-sm font-semibold text-blue-600 dark:text-blue-300" x-text="index + 1">1</span>
                                                    </div>
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <div class="flex items-center justify-between">
                                                        <h5 class="text-sm font-medium text-gray-900 dark:text-white" x-text="session.title || 'Research Session'">Research Session</h5>
                                                        <span class="text-xs text-gray-500 dark:text-gray-400" x-text="formatDate(session.date)">Date</span>
                                                    </div>
                                                    <p class="mt-1 text-sm text-gray-600 dark:text-gray-400" x-text="session.summary">Session summary</p>
                                                    <div class="mt-2 flex flex-wrap gap-2">
                                                        <template x-for="insight in session.insights.slice(0, 2)" :key="insight">
                                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-200" x-text="insight">
                                                                Insight
                                                            </span>
                                                        </template>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        
                                        <!-- New Session Placeholder -->
                                        <div class="relative flex items-start space-x-4 opacity-50">
                                            <div class="flex-shrink-0">
                                                <div class="w-8 h-8 rounded-full border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center">
                                                    <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <p class="text-sm text-gray-500 dark:text-gray-400">Next research session</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Opportunity Pipeline -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Opportunity Pipeline</h4>
                            
                            <!-- Pipeline Stages -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="text-center">
                                    <div class="w-12 h-12 mx-auto mb-2 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                                        <span class="text-lg font-semibold text-blue-600 dark:text-blue-300" x-text="getPipelineCount(selectedProfile?.profile_id, 'discovered')">0</span>
                                    </div>
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white">Discovered</h5>
                                    <p class="text-xs text-gray-500">New opportunities found</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-12 h-12 mx-auto mb-2 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center">
                                        <span class="text-lg font-semibold text-yellow-600 dark:text-yellow-300" x-text="getPipelineCount(selectedProfile?.profile_id, 'researching')">0</span>
                                    </div>
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white">Researching</h5>
                                    <p class="text-xs text-gray-500">Under investigation</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-12 h-12 mx-auto mb-2 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center">
                                        <span class="text-lg font-semibold text-purple-600 dark:text-purple-300" x-text="getPipelineCount(selectedProfile?.profile_id, 'preparing')">0</span>
                                    </div>
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white">Preparing</h5>
                                    <p class="text-xs text-gray-500">Application in progress</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-12 h-12 mx-auto mb-2 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
                                        <span class="text-lg font-semibold text-green-600 dark:text-green-300" x-text="getPipelineCount(selectedProfile?.profile_id, 'submitted')">0</span>
                                    </div>
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white">Submitted</h5>
                                    <p class="text-xs text-gray-500">Applications submitted</p>
                                </div>
                            </div>
                            
                            <!-- Intelligence Ready Opportunities -->
                            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white">Intelligence Ready Opportunities</h5>
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Strong candidates for comprehensive analysis</span>
                                </div>
                                <div class="space-y-3">
                                    <template x-for="opportunity in getTopOpportunities(selectedProfile?.profile_id).slice(0, 2)" :key="opportunity.id">
                                        <div class="p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-700 rounded-lg">
                                            <div class="flex items-center justify-between">
                                                <div class="flex-1 min-w-0">
                                                    <div class="flex items-center space-x-2 mb-2">
                                                        <h6 class="text-sm font-semibold text-gray-900 dark:text-white truncate" x-text="opportunity.title || opportunity.organization_name">Strong Opportunity</h6>
                                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-200">
                                                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                                            </svg>
                                                            High Match
                                                        </span>
                                                    </div>
                                                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-2" x-text="opportunity.source || 'Strategic Match'">Source</p>
                                                    <div class="flex items-center space-x-4 text-xs">
                                                        <span class="text-green-600 font-semibold" x-text="'$' + (opportunity.amount || Math.floor(Math.random() * 500000 + 100000)).toLocaleString()">Amount</span>
                                                        <span class="text-gray-500" x-text="'Score: ' + (opportunity.score || Math.floor(Math.random() * 15 + 85))">Score</span>
                                                        <span class="text-gray-500" x-text="'Match: ' + (opportunity.match || Math.floor(Math.random() * 10 + 90)) + '%'">Match</span>
                                                    </div>
                                                </div>
                                                <div class="flex items-center space-x-2 ml-4">
                                                    <!-- Generate Intelligence Dossier Button - Primary -->
                                                    <button @click="open4TierIntelligenceModal(opportunity)"
                                                            class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-sm rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl flex items-center space-x-2">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                                        </svg>
                                                        <span>Generate Dossier</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <div x-show="!getTopOpportunities(selectedProfile?.profile_id).length" class="text-center text-gray-500 dark:text-gray-400 py-6">
                                        <div class="text-3xl mb-2">üîç</div>
                                        <p class="text-sm">No opportunities ready for intelligence analysis yet</p>
                                        <p class="text-xs mt-1">Complete PLAN ‚Üí ANALYZE ‚Üí EXAMINE workflow to identify strong candidates</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recent Opportunities -->
                            <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                                <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Recent Opportunities</h5>
                                <div class="space-y-3">
                                    <template x-for="opportunity in getRecentOpportunities(selectedProfile?.profile_id).slice(0, 3)" :key="opportunity.id">
                                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                            <div class="flex-1 min-w-0">
                                                <h6 class="text-sm font-medium text-gray-900 dark:text-white truncate" x-text="opportunity.title">Opportunity Title</h6>
                                                <p class="text-xs text-gray-500 dark:text-gray-400" x-text="opportunity.source">Source</p>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="text-sm font-semibold text-green-600" x-text="'$' + (opportunity.amount || 0).toLocaleString()">$0</span>
                                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                                                      :class="{
                                                          'bg-blue-100 text-blue-800': opportunity.status === 'discovered',
                                                          'bg-yellow-100 text-yellow-800': opportunity.status === 'researching',
                                                          'bg-purple-100 text-purple-800': opportunity.status === 'preparing',
                                                          'bg-green-100 text-green-800': opportunity.status === 'submitted'
                                                      }"
                                                      x-text="opportunity.status">Status</span>
                                                <!-- Generate Intelligence Dossier Button -->
                                                <button @click="open4TierIntelligenceModal(opportunity)"
                                                        class="px-3 py-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-xs rounded-full hover:from-blue-700 hover:to-purple-700 transition-all duration-200 font-medium shadow-sm flex items-center space-x-1"
                                                        title="Generate Intelligence Dossier">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                                    </svg>
                                                    <span>Intelligence</span>
                                                </button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Comparative Analysis -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Competitive Landscape</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Similar Organizations -->
                                <div>
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Similar Organizations</h5>
                                    <div class="space-y-3">
                                        <template x-for="org in getSimilarOrganizations(selectedProfile).slice(0, 3)" :key="org.id || org.ein || org.name || $index">
                                            <div class="flex items-center space-x-3 p-2 border border-gray-200 dark:border-gray-600 rounded-lg">
                                                <div class="flex-1 min-w-0">
                                                    <h6 class="text-sm font-medium text-gray-900 dark:text-white truncate" x-text="org.name">Organization Name</h6>
                                                    <p class="text-xs text-gray-500" x-text="org.location">Location</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-sm font-semibold text-gray-900 dark:text-white" x-text="'$' + (org.revenue || 0).toLocaleString()">$0</p>
                                                    <p class="text-xs text-gray-500">Annual Revenue</p>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- Success Patterns -->
                                <div>
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Success Patterns</h5>
                                    <div class="space-y-3">
                                        <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                            <h6 class="text-sm font-medium text-green-800 dark:text-green-200">Funding Strategy</h6>
                                            <p class="text-xs text-green-600 dark:text-green-300">Organizations like yours typically succeed with federal grants (60%) and foundation funding (30%)</p>
                                        </div>
                                        <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                            <h6 class="text-sm font-medium text-blue-800 dark:text-blue-200">Network Advantage</h6>
                                            <p class="text-xs text-blue-600 dark:text-blue-300">Strong board connections increase success rate by 40% in your sector</p>
                                        </div>
                                        <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                            <h6 class="text-sm font-medium text-purple-800 dark:text-purple-200">Timing Insights</h6>
                                            <p class="text-xs text-purple-600 dark:text-purple-300">Peak application periods: Q1 (March) and Q3 (September)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Create Profile Modal (DISABLED - Using newer modal) -->
                    <div x-show="false" 
                         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100"
                         x-transition:leave-end="opacity-0">
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
                             x-transition:enter="transition ease-out duration-300 transform"
                             x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                             x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                             x-transition:leave="transition ease-in duration-200 transform"
                             x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                             x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">
                            
                            <!-- Modal Header -->
                            <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Create Organization Profile</h3>
                                <button @click="showCreateProfile = false" 
                                        class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                                    <span class="text-2xl">&times;</span>
                                </button>
                            </div>
                            
                            <!-- Profile Creation Form -->
                            <form @submit.prevent="createProfile()" class="p-6 space-y-6">
                                <!-- Basic Information -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Organization Name *
                                        </label>
                                        <input type="text" x-model="profileForm.name" required
                                               @input="markFieldAsUserEdited('name')"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="Enter organization name">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Organization Type
                                        </label>
                                        <select x-model="profileForm.organization_type"
                                                @change="markFieldAsUserEdited('organization_type')"
                                                class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                            <option value="">Select type</option>
                                            <option value="nonprofit">Nonprofit</option>
                                            <option value="for_profit">For Profit</option>
                                            <option value="government">Government</option>
                                            <option value="academic">Academic</option>
                                            <option value="healthcare">Healthcare</option>
                                            <option value="foundation">Foundation</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        EIN (Tax ID)
                                    </label>
                                    <input type="text" x-model="profileForm.ein"
                                           @input="markFieldAsUserEdited('ein')"
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                           placeholder="XX-XXXXXXX (optional)">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Organization Website
                                        <span class="text-xs text-gray-500 dark:text-gray-400">(Primary URL source)</span>
                                    </label>
                                    <input type="url" x-model="profileForm.website_url"
                                           @input="markFieldAsUserEdited('website_url')"
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                           placeholder="https://www.organization.org">
                                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                                        Providing the official website improves data accuracy and reduces scraping errors.
                                    </p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Primary Location
                                        </label>
                                        <input type="text" x-model="profileForm.location"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="City, State">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Annual Revenue
                                        </label>
                                        <input type="number" x-model="profileForm.annual_revenue"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="0">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Additional Notes
                                    </label>
                                    <textarea x-model="profileForm.notes" rows="2"
                                              class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                              placeholder="Any additional information about the organization"></textarea>
                                </div>
                                
                                <!-- Mission Statement -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Mission Statement
                                    </label>
                                    <textarea x-model="profileForm.mission_statement" rows="3"
                                              @input="markFieldAsUserEdited('mission_statement')"
                                              class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                              placeholder="Describe your organization's mission and purpose"></textarea>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Focus Areas *
                                        </label>
                                        <input type="text" x-model="profileForm.focus_areas" required
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="Healthcare, Education, Community Development">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Target Populations
                                        </label>
                                        <input type="text" x-model="profileForm.target_populations"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="Youth, Seniors, Low-income families">
                                    </div>
                                </div>
                                
                                <!-- Geographic Scope -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Target States (comma-separated)
                                        </label>
                                        <input type="text" x-model="profileForm.states"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="VA, MD, DC">
                                    </div>
                                    <div class="flex items-center space-x-4 pt-6">
                                        <label class="flex items-center">
                                            <input type="checkbox" x-model="profileForm.nationwide"
                                                   class="rounded border-gray-300 text-primary-600 shadow-sm">
                                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Nationwide</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" x-model="profileForm.international"
                                                   class="rounded border-gray-300 text-primary-600 shadow-sm">
                                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">International</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Funding Preferences -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Min Funding Amount
                                        </label>
                                        <input type="number" x-model="profileForm.min_amount" min="0"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="50000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Max Funding Amount
                                        </label>
                                        <input type="number" x-model="profileForm.max_amount" min="0"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="500000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Annual Revenue/Budget
                                        </label>
                                        <input type="number" x-model="profileForm.annual_revenue" min="0"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               placeholder="1000000">
                                    </div>
                                </div>
                                
                                <!-- Funding Type Preferences -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Preferred Funding Types
                                    </label>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        <label class="flex items-center">
                                            <input type="checkbox" value="grants" x-model="profileForm.funding_types"
                                                   class="rounded border-gray-300 text-primary-600 shadow-sm">
                                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Grants</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" value="government" x-model="profileForm.funding_types"
                                                   class="rounded border-gray-300 text-primary-600 shadow-sm">
                                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Government</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" value="commercial" x-model="profileForm.funding_types"
                                                   class="rounded border-gray-300 text-primary-600 shadow-sm">
                                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Commercial</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" value="sponsorships" x-model="profileForm.funding_types"
                                                   class="rounded border-gray-300 text-primary-600 shadow-sm">
                                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Sponsorships</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" value="partnerships" x-model="profileForm.funding_types"
                                                   class="rounded border-gray-300 text-primary-600 shadow-sm">
                                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Partnerships</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Form Actions -->
                                <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700">
                                    <button type="button" @click="showCreateProfile = false"
                                            class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                                        Cancel
                                    </button>
                                    <button type="button" @click="saveProfileTemplate()"
                                            class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                                        Save as Template
                                    </button>
                                    <button type="submit" 
                                            :disabled="!profileForm.name || !profileForm.organization_type || !profileForm.focus_areas"
                                            class="px-6 py-2 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 text-white rounded-md text-sm font-medium transition-colors">
                                        Create Profile
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Profiles List -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 animate-fade-in">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">My Profiles</h3>
                                    <span class="text-sm text-gray-600 dark:text-gray-400" x-text="`${profiles.length} profiles`"></span>
                                    <input type="text" placeholder="Search profiles..." 
                                           class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                           x-model="profileSearchQuery" @input="filterProfiles()">
                                </div>
                                
                                <!-- Action Buttons -->
                                <div x-show="profiles.length > 0" class="flex space-x-3">
                                    <button @click="selectedDiscoveryProfile && viewProfile(selectedDiscoveryProfile)" 
                                            :disabled="!selectedDiscoveryProfile"
                                            :class="!selectedDiscoveryProfile ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                            class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center text-sm bg-primary-600 hover:bg-primary-700 text-white shadow-md">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                                        </svg>
                                        View
                                    </button>
                                    <button @click="selectedDiscoveryProfile && editProfile(selectedDiscoveryProfile)" 
                                            :disabled="!selectedDiscoveryProfile"
                                            :class="!selectedDiscoveryProfile ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                            class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center text-sm bg-blue-600 hover:bg-blue-700 text-white shadow-md">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                        </svg>
                                        Edit
                                    </button>
                                    <button @click="selectedDiscoveryProfile && selectProfileForDiscovery(selectedDiscoveryProfile)" 
                                            :disabled="!selectedDiscoveryProfile"
                                            :class="!selectedDiscoveryProfile ? 'opacity-50 cursor-not-allowed' : 'hover:shadow-lg'"
                                            class="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center text-sm bg-green-600 hover:bg-green-700 text-white shadow-md">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                        </svg>
                                        Discover
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile Status Filters -->
                        <div class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center space-x-2" x-data="{ profileStatusFilter: 'all' }">
                                <span class="text-sm text-gray-600 dark:text-gray-400 mr-3">Filter by status:</span>
                                <button @click="profileStatusFilter = 'all'; filterProfiles()" 
                                        :class="profileStatusFilter === 'all' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                                        class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors">
                                    All
                                </button>
                                <button @click="profileStatusFilter = 'active'; filterProfiles()" 
                                        :class="profileStatusFilter === 'active' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                                        class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors">
                                    Active
                                </button>
                                <button @click="profileStatusFilter = 'archived'; filterProfiles()" 
                                        :class="profileStatusFilter === 'archived' ? 'bg-primary-600 text-white' : 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 hover:bg-yellow-200 dark:hover:bg-yellow-800'"
                                        class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors">
                                    Archived
                                </button>
                                <button @click="profileStatusFilter = 'draft'; filterProfiles()" 
                                        :class="profileStatusFilter === 'draft' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                                        class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors">
                                    Draft
                                </button>
                            </div>
                        </div>
                        
                        <!-- Profiles Table -->
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Organization</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Focus Areas</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Opportunities</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Last Discovery</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <template x-for="profile in (filteredProfiles || [])" :key="`discovery-profile-${profile.profile_id}`">
                                        <tr class="cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border-l-4"
                                            :class="selectedDiscoveryProfile?.profile_id === profile.profile_id ? 'profile-row-selected' : 'profile-row-selectable border-l-transparent'"
                                            x-init="$nextTick(() => { if ($data.addProfileContextMenu && typeof $data.addProfileContextMenu === 'function') $data.addProfileContextMenu($el, profile); })"
                                            @click="selectedDiscoveryProfile = profile">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="profile.name"></div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="profile.ein || 'No EIN'"></div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200" 
                                                      x-text="profile.organization_type"></span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="text-sm text-gray-900 dark:text-white" x-text="profile.focus_areas?.join(', ') || 'None specified'"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                                <span x-text="profile.opportunities_count || 0"></span> leads
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span :class="profile.status === 'active' ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 
                                                               profile.status === 'draft' ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' : 
                                                               'bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200'"
                                                      class="px-2 py-1 text-xs font-medium rounded-full" 
                                                      x-text="profile.status"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex flex-col">
                                                    <span class="text-sm text-gray-900 dark:text-white"
                                                          x-text="profile.last_discovery_date ? new Date(profile.last_discovery_date).toLocaleDateString() : 'Never'"></span>
                                                    <span class="text-xs text-gray-500 dark:text-gray-400"
                                                          x-text="profile.last_discovery_date ? formatTimeAgo(profile.last_discovery_date) : 'Not run'"></span>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                    <tr x-show="filteredProfiles.length === 0">
                                        <td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                            <div class="text-4xl mb-4">üìù</div>
                                            <div>No profiles found. Create your first organization profile to get started!</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            
                        </div>
                    </div>
                    
                    <!-- View Profile Modal -->
                    <div x-show="showViewProfile" 
                         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                            <!-- Modal Header -->
                            <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center">
                                    <span class="text-2xl mr-3">üëÅÔ∏è</span>
                                    Profile Details
                                </h3>
                                <button @click="closeViewProfile()" 
                                        class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                                    <span class="text-2xl">&times;</span>
                                </button>
                            </div>
                            
                            <!-- Modal Content -->
                            <div class="p-6 space-y-6" x-show="selectedProfile">
                                <!-- Organization Info -->
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-3" x-text="selectedProfile?.name || 'Organization'"></h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">EIN:</span>
                                            <p class="text-gray-900 dark:text-white font-mono" x-text="selectedProfile?.ein || 'Not provided'"></p>
                                        </div>
                                        <div>
                                            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Status:</span>
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ml-2"
                                                  :class="selectedProfile?.status === 'active' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 
                                                         selectedProfile?.status === 'archived' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :
                                                         'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200'"
                                                  x-text="selectedProfile?.status || 'Unknown'"></span>
                                        </div>
                                        <div>
                                            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Type:</span>
                                            <p class="text-gray-900 dark:text-white" x-text="selectedProfile?.organization_type || 'Not specified'"></p>
                                        </div>
                                        <div>
                                            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Opportunities:</span>
                                            <p class="text-gray-900 dark:text-white" x-text="(selectedProfile?.opportunities_count || 0) + ' leads'"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Mission & Focus -->
                                <div>
                                    <h5 class="text-md font-semibold text-gray-900 dark:text-white mb-2">Mission Statement</h5>
                                    <p class="text-gray-700 dark:text-gray-300" x-text="selectedProfile?.mission_statement || 'Not provided'"></p>
                                </div>
                                
                                <div>
                                    <h5 class="text-md font-semibold text-gray-900 dark:text-white mb-2">Focus Areas</h5>
                                    <p class="text-gray-700 dark:text-gray-300" x-text="selectedProfile?.focus_areas || 'Not specified'"></p>
                                </div>
                            </div>
                            
                            <!-- Modal Footer -->
                            <div class="flex items-center justify-between px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600">
                                <button @click="editProfile(selectedProfile)" 
                                        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors">
                                    Edit Profile
                                </button>
                                <button @click="closeViewProfile()" 
                                        class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Edit Profile Modal -->
                    <div x-show="showEditProfile" 
                         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                            <!-- Modal Header -->
                            <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center">
                                    <span class="text-2xl mr-3">‚úèÔ∏è</span>
                                    Edit Profile
                                </h3>
                                <button @click="closeEditProfile()" 
                                        class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                                    <span class="text-2xl">&times;</span>
                                </button>
                            </div>
                            
                            <!-- Modal Content -->
                            <div class="p-6 space-y-6" x-show="selectedProfile">
                                <!-- Organization Info -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Organization Name *
                                        </label>
                                        <input type="text" x-model="selectedProfile.name" required
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                               x-init="if (selectedProfile && !selectedProfile.name) selectedProfile.name = ''">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            EIN (Tax ID)
                                        </label>
                                        <input type="text" x-model="selectedProfile.ein"
                                               class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white font-mono"
                                               placeholder="XX-XXXXXXX"
                                               x-init="if (selectedProfile && !selectedProfile.ein) selectedProfile.ein = ''">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Organization Type *
                                        </label>
                                        <select x-model="selectedProfile.organization_type" required
                                                class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                                x-init="if (selectedProfile && !selectedProfile.organization_type) selectedProfile.organization_type = ''">
                                            <option value="nonprofit">Nonprofit</option>
                                            <option value="government">Government</option>
                                            <option value="educational">Educational Institution</option>
                                            <option value="healthcare">Healthcare</option>
                                            <option value="foundation">Foundation</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Status
                                        </label>
                                        <select x-model="selectedProfile.status"
                                                class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                                x-init="if (selectedProfile && !selectedProfile.status) selectedProfile.status = 'active'">
                                            <option value="active">Active</option>
                                            <option value="archived">Archived</option>
                                            <option value="draft">Draft</option>
                                            <option value="template">Template</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Mission Statement
                                    </label>
                                    <textarea x-model="selectedProfile.mission_statement" rows="3"
                                              class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                              placeholder="Describe the organization's mission and purpose"
                                              x-init="if (selectedProfile && !selectedProfile.mission_statement) selectedProfile.mission_statement = ''"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Focus Areas * (comma-separated)
                                    </label>
                                    <input type="text" x-model="selectedProfile.focus_areas" required
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white"
                                           placeholder="health, education, community development"
                                           x-init="if (selectedProfile && !selectedProfile.focus_areas) selectedProfile.focus_areas = ''">
                                </div>
                            </div>
                            
                            <!-- Modal Footer -->
                            <div class="flex items-center justify-between px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600">
                                <div class="space-x-3">
                                    <button @click="currentEditingProfile && deleteProfile(currentEditingProfile.profile_id)" 
                                            :disabled="!currentEditingProfile"
                                            :class="!currentEditingProfile ? 'opacity-50 cursor-not-allowed' : 'hover:bg-red-700'"
                                            class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md transition-colors">
                                        Delete Profile
                                    </button>
                                    <button @click="archiveProfile()" 
                                            class="px-4 py-2 text-sm font-medium text-white bg-yellow-600 rounded-md hover:bg-yellow-700 transition-colors">
                                        Archive
                                    </button>
                                </div>
                                <div class="space-x-3">
                                    <button @click="closeEditProfile()" 
                                            class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        Cancel
                                    </button>
                                    <button @click="saveProfileChanges()" 
                                            :disabled="!selectedProfile?.name"
                                            class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:bg-gray-400 transition-colors">
                                        Save Changes
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Tab -->
                <div x-show="false && activeTab === 'analytics'" class="space-y-6">
                    
                    <!-- Enhanced Analytics Charts -->
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
                        <!-- Revenue Growth Chart -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Revenue Growth Trends</h3>
                            <div class="h-64 flex items-center justify-center">
                                <canvas id="revenueChart" class="w-full h-full"></canvas>
                            </div>
                        </div>
                        
                        <!-- Risk Distribution Chart -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Risk Distribution</h3>
                            <div class="h-64 flex items-center justify-center">
                                <canvas id="riskChart" class="w-full h-full"></canvas>
                            </div>
                        </div>
                        
                        <!-- Success Rate Trends -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Success Rate Trends</h3>
                            <div class="h-64 flex items-center justify-center">
                                <canvas id="successRateChart" class="w-full h-full"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Workflow Analytics Dashboard -->
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg p-6 text-white mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-2xl font-bold">Workflow Analytics & User Journey</h3>
                                <p class="mt-1 opacity-90">Session tracking, completion analytics, and user engagement insights</p>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-bold" x-text="Object.values(workflowProgress).filter(Boolean).length"></div>
                                <div class="text-sm opacity-80">Stages Completed</div>
                            </div>
                        </div>
                        
                        <!-- Session Summary -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
                            <div class="bg-white/10 rounded-lg p-4">
                                <div class="text-2xl font-bold" x-text="workflowAnalytics.sessionId.substring(0, 8)"></div>
                                <div class="text-sm opacity-80">Session ID</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-4">
                                <div class="text-2xl font-bold" x-text="((Date.now() - new Date(workflowAnalytics.sessionStart).getTime()) / 1000 / 60).toFixed(1) + 'm'"></div>
                                <div class="text-sm opacity-80">Session Time</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-4">
                                <div class="text-2xl font-bold" x-text="workflowAnalytics.userActions.length"></div>
                                <div class="text-sm opacity-80">User Actions</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-4">
                                <div class="text-2xl font-bold" x-text="(workflowAnalytics.completionRates.overall * 100).toFixed(1) + '%'"></div>
                                <div class="text-sm opacity-80">Completion Rate</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Workflow Progress Funnel -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Workflow Completion Funnel</h3>
                            <button @click="getWorkflowAnalyticsReport()" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                Generate Report
                            </button>
                        </div>
                        <div class="grid grid-cols-6 gap-4">
                            <div class="text-center">
                                <div class="w-16 h-16 rounded-full mx-auto mb-3 flex items-center justify-center text-white text-2xl font-bold"
                                     :class="workflowProgress.welcome ? 'bg-green-500' : 'bg-gray-400'">
                                    0
                                </div>
                                <div class="font-medium text-gray-900 dark:text-white">WELCOME</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400" 
                                     x-text="(workflowAnalytics.timeSpentInStages.welcome / 1000 / 60).toFixed(1) + 'm'"></div>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 rounded-full mx-auto mb-3 flex items-center justify-center text-white text-2xl font-bold"
                                     :class="workflowProgress.profiler ? 'bg-green-500' : 'bg-gray-400'">
                                    1
                                </div>
                                <div class="font-medium text-gray-900 dark:text-white">PROFILER</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400" 
                                     x-text="(workflowAnalytics.timeSpentInStages.profiler / 1000 / 60).toFixed(1) + 'm'"></div>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 rounded-full mx-auto mb-3 flex items-center justify-center text-white text-2xl font-bold"
                                     :class="workflowProgress.discover ? 'bg-green-500' : 'bg-gray-400'">
                                    2
                                </div>
                                <div class="font-medium text-gray-900 dark:text-white">DISCOVER</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400"
                                     x-text="(workflowAnalytics.timeSpentInStages.discover / 1000 / 60).toFixed(1) + 'm'"></div>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 rounded-full mx-auto mb-3 flex items-center justify-center text-white text-2xl font-bold"
                                     :class="workflowProgress.analyze ? 'bg-green-500' : 'bg-gray-400'">
                                    3
                                </div>
                                <div class="font-medium text-gray-900 dark:text-white">ANALYZE</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400"
                                     x-text="(workflowAnalytics.timeSpentInStages.analyze / 1000 / 60).toFixed(1) + 'm'"></div>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 rounded-full mx-auto mb-3 flex items-center justify-center text-white text-2xl font-bold"
                                     :class="workflowProgress.plan ? 'bg-green-500' : 'bg-gray-400'">
                                    4
                                </div>
                                <div class="font-medium text-gray-900 dark:text-white">PLAN</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400"
                                     x-text="(workflowAnalytics.timeSpentInStages.plan / 1000 / 60).toFixed(1) + 'm'"></div>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 rounded-full mx-auto mb-3 flex items-center justify-center text-white text-2xl font-bold"
                                     :class="workflowProgress.execute ? 'bg-green-500' : 'bg-gray-400'">
                                    5
                                </div>
                                <div class="font-medium text-gray-900 dark:text-white">EXECUTE</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400"
                                     x-text="(workflowAnalytics.timeSpentInStages.execute / 1000 / 60).toFixed(1) + 'm'"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Journey Analytics -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Recent Actions -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Recent User Actions</h3>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                <template x-for="action in workflowAnalytics.userActions.slice(-10).reverse()" :key="action.timestamp">
                                    <div class="flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-700 rounded-md">
                                        <div>
                                            <div class="font-medium text-sm text-gray-900 dark:text-white" x-text="action.type.replace('_', ' ').toUpperCase()"></div>
                                            <div class="text-xs text-gray-600 dark:text-gray-400" x-text="action.currentStage.toUpperCase()"></div>
                                        </div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400" x-text="new Date(action.timestamp).toLocaleTimeString()"></div>
                                    </div>
                                </template>
                                <div x-show="workflowAnalytics.userActions.length === 0" class="text-center text-gray-500 dark:text-gray-400 py-8">
                                    No actions recorded yet
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stage Transitions -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Stage Transitions</h3>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                <template x-for="transition in workflowAnalytics.stageTransitions.slice(-8).reverse()" :key="transition.timestamp">
                                    <div class="flex items-center py-2 px-3 bg-gray-50 dark:bg-gray-700 rounded-md">
                                        <div class="flex-1">
                                            <div class="font-medium text-sm text-gray-900 dark:text-white">
                                                <span x-text="transition.from ? transition.from.toUpperCase() : 'START'"></span>
                                                ‚Üí
                                                <span x-text="transition.to.toUpperCase()"></span>
                                            </div>
                                            <div class="text-xs text-gray-600 dark:text-gray-400" x-text="((transition.sessionTime / 1000 / 60).toFixed(1)) + ' minutes into session'"></div>
                                        </div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400" x-text="new Date(transition.timestamp).toLocaleTimeString()"></div>
                                    </div>
                                </template>
                                <div x-show="workflowAnalytics.stageTransitions.length === 0" class="text-center text-gray-500 dark:text-gray-400 py-8">
                                    No transitions recorded yet
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Insights -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Workflow Insights & Recommendations</h3>
                        <div class="space-y-3" x-data="{ insights: [] }" x-init="insights = generateWorkflowInsights()">
                            <template x-for="insight in insights" :key="insight.type">
                                <div class="flex items-start p-4 rounded-lg"
                                     :class="insight.type === 'completion_success' ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700' : 
                                             insight.type === 'high_engagement' ? 'bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700' :
                                             'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700'">
                                    <div class="flex-shrink-0 mr-3">
                                        <div class="w-6 h-6 rounded-full flex items-center justify-center"
                                             :class="insight.type === 'completion_success' ? 'bg-green-500' : 
                                                     insight.type === 'high_engagement' ? 'bg-blue-500' :
                                                     'bg-yellow-500'">
                                            <span class="text-white text-sm">!</span>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-medium text-gray-900 dark:text-white" x-text="insight.message"></div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mt-1" x-text="insight.recommendation"></div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="insights.length === 0" class="text-center text-gray-500 dark:text-gray-400 py-8">
                                Continue using the workflow to generate personalized insights
                            </div>
                        </div>
                    </div>
                    
                    <!-- Analytics Overview Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Processing Trends</h3>
                                <span class="text-2xl">üìä</span>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Today</span>
                                    <span class="font-medium" x-text="analyticsData.todaysProcessed || 0"></span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">This Week</span>
                                    <span class="font-medium" x-text="analyticsData.weekProcessed || 0"></span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Success Rate</span>
                                    <span class="font-medium">
                                        <span x-text="((analyticsData.successRate || 0) * 100).toFixed(1)"></span>%
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Performance Metrics</h3>
                                <span class="text-2xl">‚ö°</span>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Avg Processing Speed</span>
                                    <span class="font-medium" x-text="(analyticsData.avgSpeed || 0).toFixed(1)"></span> orgs/sec
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">API Success Rate</span>
                                    <span class="font-medium">
                                        <span x-text="((analyticsData.apiSuccessRate || 0) * 100).toFixed(1)"></span>%
                                    </span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Avg Response Time</span>
                                    <span class="font-medium" x-text="(analyticsData.avgResponseTime || 0).toFixed(0)"></span>ms
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Quality Metrics</h3>
                                <span class="text-2xl">üéØ</span>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">High Score Orgs</span>
                                    <span class="font-medium" x-text="analyticsData.highScoreOrgs || 0"></span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Avg Composite Score</span>
                                    <span class="font-medium" x-text="(analyticsData.avgCompositeScore || 0).toFixed(3)"></span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Classification Accuracy</span>
                                    <span class="font-medium">
                                        <span x-text="((analyticsData.classificationAccuracy || 0) * 100).toFixed(1)"></span>%
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Processing Volume Chart -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Processing Volume</h3>
                                <div class="flex space-x-2">
                                    <button @click="chartTimeRange = '7d'; loadAnalytics()" 
                                            :class="chartTimeRange === '7d' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                            class="px-3 py-1 text-xs rounded-md">7D</button>
                                    <button @click="chartTimeRange = '30d'; loadAnalytics()" 
                                            :class="chartTimeRange === '30d' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                            class="px-3 py-1 text-xs rounded-md">30D</button>
                                </div>
                            </div>
                            <div class="h-64">
                                <canvas id="processingVolumeChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                        
                        <!-- Success Rate Chart -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Success Rate Trends</h3>
                                <span class="text-sm text-gray-500 dark:text-gray-400">Last 30 days</span>
                            </div>
                            <div class="h-64">
                                <canvas id="successRateChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- NTEE Code Distribution -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">NTEE Code Distribution</h3>
                            <button @click="loadAnalytics()" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                Refresh
                            </button>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <template x-for="ntee in analyticsData.nteeDistribution || []" :key="ntee.code">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-gray-900 dark:text-white" x-text="ntee.count"></div>
                                    <div class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="ntee.code"></div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400" x-text="ntee.name"></div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 mt-2">
                                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                             :style="`width: ${ntee.percentage}%`"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Top Performing Organizations -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 animate-fade-in">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Top Performing Organizations</h3>
                        </div>
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Organization</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Score</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">NTEE Code</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Revenue</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Location</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-if="analyticsData && Array.isArray(analyticsData.topOrganizations)">
                                            <template x-for="org in analyticsData.topOrganizations" :key="org.id || org.ein || org.name || $index">
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="org.name"></div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="org.ein"></div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-semibold text-gray-900 dark:text-white" x-text="(org.composite_score || 0).toFixed(3)"></div>
                                                    <div class="w-16 bg-gray-200 dark:bg-gray-600 rounded-full h-1 mt-1">
                                                        <div class="bg-green-600 h-1 rounded-full transition-all duration-300" 
                                                             :style="`width: ${(org.composite_score || 0) * 100}%`"></div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200"
                                                          x-text="org.ntee_code || 'N/A'"></span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                                    $<span x-text="(org.revenue || 0).toLocaleString()"></span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                                    <span x-text="(org.city || '') + ', ' + (org.state || '')"></span>
                                                </td>
                                            </tr>
                                            </template>
                                        </template>
                                        <!-- Empty state for analytics -->
                                        <template x-if="!analyticsData || !analyticsData.topOrganizations || analyticsData.topOrganizations.length === 0">
                                            <tr>
                                                <td colspan="4" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                                    <div class="text-sm">No analytics data available</div>
                                                    <div class="text-xs mt-1">Run discovery to generate analytics</div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Predictive Analytics Tab -->
                <div x-show="false && activeTab === 'predictive'" class="space-y-6">
                    <!-- Header -->
                    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Predictive Success Analytics</h3>
                        <p class="mt-2 opacity-90">AI-powered success prediction and opportunity scoring</p>
                    </div>

                    <!-- Model Status and Controls -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Model Status</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between"><span>Model Version:</span><span class="font-medium">v2.1.0</span></div>
                                <div class="flex justify-between"><span>Accuracy:</span><span class="font-medium text-green-600">87.3%</span></div>
                                <div class="flex justify-between"><span>Training Data:</span><span class="font-medium">15,247 records</span></div>
                                <div class="flex justify-between"><span>Last Updated:</span><span class="font-medium">2 hours ago</span></div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Quick Prediction</h4>
                            <div class="space-y-3">
                                <select class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                                    <option>Select Organization...</option>
                                    <option>Tech Nonprofit Foundation</option>
                                    <option>Healthcare Initiative</option>
                                    <option>Education Alliance</option>
                                </select>
                                <button class="w-full bg-purple-600 text-white py-2 rounded-md hover:bg-purple-700">
                                    Predict Success
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Model Actions</h4>
                            <div class="space-y-2">
                                <button class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">
                                    Retrain Model
                                </button>
                                <button class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700">
                                    Validate Model
                                </button>
                                <button class="w-full bg-gray-600 text-white py-2 rounded-md hover:bg-gray-700">
                                    Export Predictions
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Success Score Breakdown -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                        <h4 class="text-lg font-semibold mb-6">Multi-Dimensional Success Scoring</h4>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <div class="text-center">
                                <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center">
                                    <div class="text-white font-bold text-lg">8.4</div>
                                </div>
                                <h5 class="font-medium">Financial Health</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Revenue & Stability</p>
                            </div>
                            <div class="text-center">
                                <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center">
                                    <div class="text-white font-bold text-lg">7.2</div>
                                </div>
                                <h5 class="font-medium">Capacity</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Staff & Experience</p>
                            </div>
                            <div class="text-center">
                                <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center">
                                    <div class="text-white font-bold text-lg">9.1</div>
                                </div>
                                <h5 class="font-medium">Alignment</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Strategic Fit</p>
                            </div>
                            <div class="text-center">
                                <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-to-br from-indigo-400 to-indigo-600 flex items-center justify-center">
                                    <div class="text-white font-bold text-lg">6.8</div>
                                </div>
                                <h5 class="font-medium">Network</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Influence & Connections</p>
                            </div>
                            <div class="text-center">
                                <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center">
                                    <div class="text-white font-bold text-lg">8.7</div>
                                </div>
                                <h5 class="font-medium">Track Record</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Past Success</p>
                            </div>
                        </div>
                    </div>

                    <!-- Prediction Results -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Recent Predictions</h4>
                            <div class="space-y-4">
                                <div class="border-l-4 border-green-500 pl-4">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="font-medium">Virginia Community Health</p>
                                            <p class="text-sm text-gray-600">Healthcare Grant Application</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-green-600">89%</div>
                                            <div class="text-sm text-gray-500">Success Rate</div>
                                        </div>
                                    </div>
                                    <p class="text-sm mt-2 text-gray-600">Highly recommended - Strong financial health and perfect alignment</p>
                                </div>
                                
                                <div class="border-l-4 border-yellow-500 pl-4">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="font-medium">Tech Education Initiative</p>
                                            <p class="text-sm text-gray-600">STEM Program Funding</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-yellow-600">67%</div>
                                            <div class="text-sm text-gray-500">Success Rate</div>
                                        </div>
                                    </div>
                                    <p class="text-sm mt-2 text-gray-600">Conditional - Need to strengthen track record and network</p>
                                </div>
                                
                                <div class="border-l-4 border-red-500 pl-4">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="font-medium">Regional Arts Council</p>
                                            <p class="text-sm text-gray-600">Community Arts Grant</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-red-600">34%</div>
                                            <div class="text-sm text-gray-500">Success Rate</div>
                                        </div>
                                    </div>
                                    <p class="text-sm mt-2 text-gray-600">Not recommended - Financial instability and poor alignment</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Improvement Recommendations</h4>
                            <div class="space-y-3">
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <h5 class="font-medium text-blue-800 dark:text-blue-200">Financial Health</h5>
                                    <p class="text-sm text-blue-700 dark:text-blue-300">Diversify revenue streams to improve financial stability</p>
                                </div>
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <h5 class="font-medium text-green-800 dark:text-green-200">Network Building</h5>
                                    <p class="text-sm text-green-700 dark:text-green-300">Build strategic board connections and partnerships</p>
                                </div>
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                    <h5 class="font-medium text-purple-800 dark:text-purple-200">Capacity Development</h5>
                                    <p class="text-sm text-purple-700 dark:text-purple-300">Invest in leadership development and experienced hires</p>
                                </div>
                                <div class="p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                    <h5 class="font-medium text-orange-800 dark:text-orange-200">Track Record</h5>
                                    <p class="text-sm text-orange-700 dark:text-orange-300">Improve project management for better completion rates</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Model Performance Metrics -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                        <h4 class="text-lg font-semibold mb-4">Model Performance Analysis</h4>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600">87.3%</div>
                                <div class="text-sm text-gray-600">Accuracy</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600">84.7%</div>
                                <div class="text-sm text-gray-600">Precision</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-purple-600">91.2%</div>
                                <div class="text-sm text-gray-600">Recall</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-indigo-600">87.8%</div>
                                <div class="text-sm text-gray-600">F1-Score</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ROI Analytics Tab -->
                <div x-show="false && activeTab === 'roi'" class="space-y-6">
                    <!-- Header -->
                    <div class="bg-gradient-to-r from-green-600 to-teal-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">ROI Analytics & Optimization</h3>
                        <p class="mt-2 opacity-90">Comprehensive return on investment tracking and portfolio optimization</p>
                    </div>

                    <!-- ROI Overview Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center">
                            <div class="text-3xl font-bold text-green-600">287%</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Portfolio ROI</div>
                            <div class="text-xs text-green-600 mt-1">+23% vs baseline</div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center">
                            <div class="text-3xl font-bold text-blue-600">$2.4M</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Expected Value</div>
                            <div class="text-xs text-blue-600 mt-1">15 opportunities</div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center">
                            <div class="text-3xl font-bold text-purple-600">$847K</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Total Investment</div>
                            <div class="text-xs text-purple-600 mt-1">Budget utilized: 84%</div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center">
                            <div class="text-3xl font-bold text-orange-600">0.24</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Risk Score</div>
                            <div class="text-xs text-green-600 mt-1">Low risk</div>
                        </div>
                    </div>

                    <!-- Portfolio Optimization -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Portfolio Optimization</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Optimization Method</label>
                                    <select class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                                        <option value="portfolio_balanced">Portfolio Balanced (Recommended)</option>
                                        <option value="risk_adjusted">Risk Adjusted</option>
                                        <option value="greedy">Maximum ROI</option>
                                        <option value="linear_programming">Linear Programming</option>
                                        <option value="knapsack">Knapsack</option>
                                    </select>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Budget Limit</label>
                                        <input type="number" placeholder="1000000" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Risk Tolerance</label>
                                        <select class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
                                            <option value="low">Low (0.2)</option>
                                            <option value="medium" selected>Medium (0.4)</option>
                                            <option value="high">High (0.6)</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700">
                                    Optimize Portfolio
                                </button>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Optimization Results</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Method Used:</span>
                                    <span class="font-medium">Portfolio Balanced</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Opportunities Selected:</span>
                                    <span class="font-medium">12 of 25</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Expected ROI:</span>
                                    <span class="font-medium text-green-600">287%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Improvement:</span>
                                    <span class="font-medium text-blue-600">+23% vs baseline</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Diversification Index:</span>
                                    <span class="font-medium">0.73</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Confidence Score:</span>
                                    <span class="font-medium">0.89</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ROI Breakdown Analysis -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                        <h4 class="text-lg font-semibold mb-6">Multi-Dimensional ROI Analysis</h4>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                            <div class="text-center">
                                <div class="w-24 h-24 mx-auto mb-3 relative">
                                    <svg class="w-24 h-24 transform -rotate-90">
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200 dark:text-gray-700"/>
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="75.36" class="text-green-500"/>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-xl font-bold">3.2</span>
                                    </div>
                                </div>
                                <h5 class="font-medium">Financial ROI</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Traditional Return</p>
                            </div>
                            <div class="text-center">
                                <div class="w-24 h-24 mx-auto mb-3 relative">
                                    <svg class="w-24 h-24 transform -rotate-90">
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200 dark:text-gray-700"/>
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="100.48" class="text-blue-500"/>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-xl font-bold">2.4</span>
                                    </div>
                                </div>
                                <h5 class="font-medium">Time ROI</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Time Efficiency</p>
                            </div>
                            <div class="text-center">
                                <div class="w-24 h-24 mx-auto mb-3 relative">
                                    <svg class="w-24 h-24 transform -rotate-90">
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200 dark:text-gray-700"/>
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="87.92" class="text-purple-500"/>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-xl font-bold">2.8</span>
                                    </div>
                                </div>
                                <h5 class="font-medium">Resource Efficiency</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Resource Utilization</p>
                            </div>
                            <div class="text-center">
                                <div class="w-24 h-24 mx-auto mb-3 relative">
                                    <svg class="w-24 h-24 transform -rotate-90">
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200 dark:text-gray-700"/>
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="125.6" class="text-yellow-500"/>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-xl font-bold">1.9</span>
                                    </div>
                                </div>
                                <h5 class="font-medium">Opportunity Cost</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Alternative Value</p>
                            </div>
                            <div class="text-center">
                                <div class="w-24 h-24 mx-auto mb-3 relative">
                                    <svg class="w-24 h-24 transform -rotate-90">
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200 dark:text-gray-700"/>
                                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="62.8" class="text-indigo-500"/>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-xl font-bold">3.6</span>
                                    </div>
                                </div>
                                <h5 class="font-medium">Strategic Value</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Long-term Impact</p>
                            </div>
                        </div>
                    </div>

                    <!-- Top Performing Opportunities -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Top ROI Opportunities</h4>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 border rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                        <div>
                                            <p class="font-medium">Healthcare Innovation Grant</p>
                                            <p class="text-sm text-gray-600">$500K opportunity</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-green-600">425%</div>
                                        <div class="text-xs text-gray-500">ROI</div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between p-3 border rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                        <div>
                                            <p class="font-medium">Education Technology Fund</p>
                                            <p class="text-sm text-gray-600">$300K opportunity</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-blue-600">387%</div>
                                        <div class="text-xs text-gray-500">ROI</div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between p-3 border rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                                        <div>
                                            <p class="font-medium">Community Development</p>
                                            <p class="text-sm text-gray-600">$150K opportunity</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-purple-600">298%</div>
                                        <div class="text-xs text-gray-500">ROI</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                            <h4 class="text-lg font-semibold mb-4">Optimization Recommendations</h4>
                            <div class="space-y-3">
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <h5 class="font-medium text-green-800 dark:text-green-200">Portfolio Optimization</h5>
                                    <p class="text-sm text-green-700 dark:text-green-300">Current portfolio shows excellent diversification and ROI potential</p>
                                </div>
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <h5 class="font-medium text-blue-800 dark:text-blue-200">Resource Allocation</h5>
                                    <p class="text-sm text-blue-700 dark:text-blue-300">Consider increasing budget allocation by 15% for maximum returns</p>
                                </div>
                                <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                                    <h5 class="font-medium text-yellow-800 dark:text-yellow-200">Risk Management</h5>
                                    <p class="text-sm text-yellow-700 dark:text-yellow-300">Low risk profile allows for potentially higher return opportunities</p>
                                </div>
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                    <h5 class="font-medium text-purple-800 dark:text-purple-200">Timeline Optimization</h5>
                                    <p class="text-sm text-purple-700 dark:text-purple-300">Stagger opportunity pursuit to maximize team efficiency</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Historical Performance -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                        <h4 class="text-lg font-semibold mb-4">Historical ROI Performance</h4>
                        <div class="grid grid-cols-2 lg:grid-cols-6 gap-4 text-center">
                            <div>
                                <div class="text-2xl font-bold text-gray-900 dark:text-white">23</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Total Tracked</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-green-600">78%</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Success Rate</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-blue-600">245%</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Avg Actual ROI</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-purple-600">+12%</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">vs Predicted</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-indigo-600">$3.8M</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Total Value</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-orange-600">0.19</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Avg Risk</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Exports Tab (Hidden - Functionality moved to Execute stage) -->
                <div x-show="false" class="space-y-6">
                    
                    <!-- Export Management -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                            <span class="text-2xl mr-3">üìÅ</span>
                            Available Exports
                        </h3>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">File</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Size</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Created</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <template x-for="file in exportFiles" :key="file.filename">
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <span class="text-2xl mr-3" x-text="getFileIcon(file.type)"></span>
                                                    <div>
                                                        <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="file.filename"></div>
                                                        <div class="text-sm text-gray-500 dark:text-gray-400" x-text="file.description || ''"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span :class="getTypeColor(file.type)" class="px-2 py-1 text-xs font-semibold rounded-full" x-text="file.type.toUpperCase()"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="formatFileSize(file.size)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400" x-text="formatTimeAgo(file.created_at)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                                                <button @click="downloadFile(file.filename)" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                                    Download
                                                </button>
                                                <button @click="deleteFile(file.filename)" class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300">
                                                    Delete
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Commercial Track Section -->
                <div x-show="false && activeTab === 'commercial'" class="space-y-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Commercial Opportunity Discovery</h2>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Corporate giving programs, foundations, and CSR initiatives</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Foundation Directory API</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                        <span class="text-sm text-gray-600 dark:text-gray-400">CSR Analysis</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="p-6">
                            <!-- Commercial Discovery Controls -->
                            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
                                <div class="xl:col-span-2">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Discovery Filters</h3>
                                    
                                    <!-- Industry Selection -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Target Industries</label>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                            <template x-for="industry in availableIndustries" :key="industry.value">
                                                <label class="flex items-center">
                                                    <input type="checkbox" :value="industry.value" x-model="commercialFilters.industries" class="rounded border-gray-300 text-blue-600">
                                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300" x-text="industry.label"></span>
                                                </label>
                                            </template>
                                        </div>
                                    </div>

                                    <!-- Company Size Selection -->
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Company Sizes</label>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                            <template x-for="size in availableCompanySizes" :key="size.value">
                                                <label class="flex items-center">
                                                    <input type="checkbox" :value="size.value" x-model="commercialFilters.company_sizes" class="rounded border-gray-300 text-blue-600">
                                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300" x-text="size.label"></span>
                                                </label>
                                            </template>
                                        </div>
                                    </div>

                                    <!-- Funding Range -->
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Min Amount ($)</label>
                                            <input type="number" x-model.number="commercialFilters.funding_range.min" min="0" step="1000"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Max Amount ($)</label>
                                            <input type="number" x-model.number="commercialFilters.funding_range.max" min="0" step="1000"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Discovery Actions</h3>
                                    
                                    <button @click="startCommercialDiscovery()" 
                                            :disabled="commercialDiscoveryInProgress"
                                            :class="commercialDiscoveryInProgress ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'"
                                            class="w-full px-4 py-3 text-white font-medium rounded-md transition-colors mb-4">
                                        <span x-show="!commercialDiscoveryInProgress">üè¢ Start Commercial Discovery</span>
                                        <span x-show="commercialDiscoveryInProgress" class="flex items-center justify-center">
                                            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                                            Discovering...
                                        </span>
                                    </button>

                                    <div class="space-y-2 text-sm">
                                        <div class="flex items-center justify-between py-1 px-2 bg-gray-50 dark:bg-gray-700 rounded">
                                            <span>Foundation Directory</span>
                                            <span class="text-green-600 dark:text-green-400">‚úì Ready</span>
                                        </div>
                                        <div class="flex items-center justify-between py-1 px-2 bg-gray-50 dark:bg-gray-700 rounded">
                                            <span>CSR Analysis</span>
                                            <span class="text-green-600 dark:text-green-400">‚úì Ready</span>
                                        </div>
                                        <div class="flex items-center justify-between py-1 px-2 bg-gray-50 dark:bg-gray-700 rounded">
                                            <span>Corporate Database</span>
                                            <span class="text-green-600 dark:text-green-400">‚úì Ready</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Commercial Results -->
                            <div x-show="commercialOpportunities.length > 0" class="mt-6">
                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Commercial Opportunities</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                                    <template x-for="opportunity in filterCommercialOpportunities()" :key="opportunity.id">
                                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:shadow-md transition-shadow" 
                                             x-data="{enhancedOrg: getEnhancedOrganizationDisplay(opportunity)}">
                                            <!-- Organization Header with Grant Priority -->
                                            <div class="flex items-start justify-between mb-3">
                                                <div class="flex-1">
                                                    <div class="flex items-center space-x-2 mb-1">
                                                        <h4 class="font-medium text-gray-900 dark:text-white text-sm" x-text="opportunity.organization_name"></h4>
                                                        <!-- Grant Research Priority Badge -->
                                                        <span :class="enhancedOrg.financial_intelligence.grant_priority.class" 
                                                              class="px-2 py-1 text-xs font-semibold rounded-full" 
                                                              x-text="enhancedOrg.financial_intelligence.grant_priority.text"></span>
                                                    </div>
                                                    <span :class="getCompatibilityClass(opportunity.compatibility_score)" 
                                                          class="px-2 py-1 text-xs font-semibold rounded-full" 
                                                          x-text="Math.round(opportunity.compatibility_score * 100) + '% Match'"></span>
                                                </div>
                                            </div>
                                            
                                            <!-- Financial Intelligence Section -->
                                            <div x-show="enhancedOrg.financial_intelligence.is_foundation" class="bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 border border-red-200 dark:border-red-700 rounded-lg p-3 mb-3">
                                                <h5 class="font-medium text-red-800 dark:text-red-200 text-sm mb-2">üéØ Foundation Grant Intelligence</h5>
                                                <div class="grid grid-cols-2 gap-2 text-xs">
                                                    <div>
                                                        <label class="text-red-700 dark:text-red-300 font-medium">Annual Distributions</label>
                                                        <div class="text-red-900 dark:text-red-100 font-semibold" 
                                                             x-text="formatFinancialAmount(enhancedOrg.financial_intelligence.grant_distributions)"></div>
                                                    </div>
                                                    <div>
                                                        <label class="text-red-700 dark:text-red-300 font-medium">Foundation Type</label>
                                                        <div class="text-red-900 dark:text-red-100" x-text="opportunity.foundation_code === '03' ? 'Non-Operating' : 'Operating'"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Financial Performance Metrics -->
                                            <div x-show="enhancedOrg.financial_intelligence.efficiency_ratio || enhancedOrg.financial_intelligence.program_revenue_ratio" 
                                                 class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-3 mb-3">
                                                <h5 class="font-medium text-blue-800 dark:text-blue-200 text-sm mb-2">üìä Financial Performance</h5>
                                                <div class="grid grid-cols-2 gap-2 text-xs">
                                                    <div x-show="enhancedOrg.financial_intelligence.efficiency_ratio">
                                                        <label class="text-blue-700 dark:text-blue-300 font-medium">Efficiency Ratio</label>
                                                        <div class="flex items-center space-x-1">
                                                            <span class="text-blue-900 dark:text-blue-100 font-semibold" 
                                                                  x-text="enhancedOrg.financial_intelligence.efficiency_ratio + '%'"></span>
                                                            <span :class="enhancedOrg.financial_intelligence.health_badge.class"
                                                                  class="px-1 py-0.5 text-xs rounded" 
                                                                  x-text="enhancedOrg.financial_intelligence.health_badge.text"></span>
                                                        </div>
                                                    </div>
                                                    <div x-show="enhancedOrg.financial_intelligence.program_revenue_ratio">
                                                        <label class="text-blue-700 dark:text-blue-300 font-medium">Program Revenue</label>
                                                        <div class="text-blue-900 dark:text-blue-100 font-semibold" 
                                                             x-text="enhancedOrg.financial_intelligence.program_revenue_ratio + '%'"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Financial Trend Chart (Compact) -->
                                            <div x-show="opportunity.total_revenue_990 || opportunity.f990_revenue" 
                                                 class="bg-gray-50 dark:bg-gray-600 rounded-lg p-2 mb-3">
                                                <h6 class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Revenue Trend</h6>
                                                <canvas :id="'trend-chart-' + opportunity.opportunity_id" 
                                                        class="w-full h-16"
                                                        x-init="$nextTick(() => createFinancialTrendChart('trend-chart-' + opportunity.opportunity_id, opportunity))"></canvas>
                                            </div>
                                            
                                            <p class="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2" x-text="opportunity.program_name"></p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3" x-text="opportunity.description"></p>
                                            
                                            <!-- Enhanced Financial Display -->
                                            <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                                                <div>
                                                    <label class="text-gray-500 dark:text-gray-400">Funding Amount</label>
                                                    <div class="font-medium text-green-600 dark:text-green-400" x-text="formatFundingAmount(opportunity.funding_amount)"></div>
                                                </div>
                                                <div x-show="opportunity.total_revenue_990 || opportunity.revenue">
                                                    <label class="text-gray-500 dark:text-gray-400">Annual Revenue</label>
                                                    <div class="font-medium text-gray-700 dark:text-gray-300" 
                                                         x-text="formatFinancialAmount(opportunity.total_revenue_990 || opportunity.revenue)"></div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-center justify-between text-xs">
                                                <span class="text-gray-500 dark:text-gray-400" x-text="opportunity.application_deadline"></span>
                                                <span class="text-gray-500 dark:text-gray-400" x-text="opportunity.state || 'Multi-State'"></span>
                                            </div>
                                            
                                            <div class="mt-3 flex items-center space-x-2">
                                                <template x-for="(value, factor) in opportunity.match_factors" :key="factor">
                                                    <div x-show="value" class="flex items-center">
                                                        <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                                                        <span class="text-xs text-gray-600 dark:text-gray-400" x-text="factor.replace('_', ' ')"></span>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- State Discovery Section -->
                <div x-show="false && activeTab === 'states'" class="space-y-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white">State-Level Grant Discovery</h2>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">State agency grants and state foundation programs</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Multi-State Integration</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="p-6">
                            <!-- State Selection -->
                            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
                                <div class="xl:col-span-2">
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">State Selection</h3>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <template x-for="state in availableStates" :key="state.code">
                                            <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                                                <label class="flex items-center cursor-pointer">
                                                    <input type="checkbox" :value="state.code" x-model="selectedStates" class="rounded border-gray-300 text-blue-600">
                                                    <div class="ml-3 flex-1">
                                                        <div class="flex items-center justify-between">
                                                            <span class="font-medium text-gray-900 dark:text-white" x-text="state.name"></span>
                                                            <span class="text-sm text-gray-500 dark:text-gray-400" x-text="state.code"></span>
                                                        </div>
                                                        <p class="text-sm text-gray-600 dark:text-gray-400" x-text="state.agencies + ' agencies integrated'"></p>
                                                    </div>
                                                </label>
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Discovery Actions</h3>
                                    
                                    <button @click="startStateDiscovery()" 
                                            :disabled="stateDiscoveryInProgress || selectedStates.length === 0"
                                            :class="(stateDiscoveryInProgress || selectedStates.length === 0) ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'"
                                            class="w-full px-4 py-3 text-white font-medium rounded-md transition-colors mb-4">
                                        <span x-show="!stateDiscoveryInProgress">üèõÔ∏è Start State Discovery</span>
                                        <span x-show="stateDiscoveryInProgress" class="flex items-center justify-center">
                                            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                                            Discovering...
                                        </span>
                                    </button>

                                    <div x-show="selectedStates.length > 0" class="space-y-2 text-sm">
                                        <p class="text-gray-600 dark:text-gray-400 mb-2">Selected States:</p>
                                        <template x-for="stateCode in selectedStates" :key="stateCode">
                                            <div class="flex items-center justify-between py-1 px-2 bg-blue-50 dark:bg-blue-900/20 rounded">
                                                <span x-text="availableStates.find(s => s.code === stateCode)?.name"></span>
                                                <span class="text-blue-600 dark:text-blue-400 text-xs" x-text="availableStates.find(s => s.code === stateCode)?.agencies + ' agencies'"></span>
                                            </div>
                                        </template>
                                    </div>

                                    <div x-show="selectedStates.length === 0" class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                                        Select one or more states to begin discovery
                                    </div>
                                </div>
                            </div>

                            <!-- State Results -->
                            <div x-show="stateOpportunities.length > 0" class="mt-6">
                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">State Opportunities</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <template x-for="opportunity in stateOpportunities" :key="opportunity.id">
                                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:shadow-md transition-shadow">
                                            <div class="flex items-start justify-between mb-3">
                                                <div class="flex items-center space-x-2">
                                                    <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full" x-text="opportunity.state"></span>
                                                    <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-full" x-text="Math.round(opportunity.priority_score * 100) + '%'"></span>
                                                </div>
                                            </div>
                                            
                                            <h4 class="font-medium text-gray-900 dark:text-white text-sm mb-1" x-text="opportunity.agency_name"></h4>
                                            <p class="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2" x-text="opportunity.program_name"></p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-3" x-text="opportunity.description"></p>
                                            
                                            <div class="flex items-center justify-between text-xs mb-2">
                                                <span class="font-medium text-green-600 dark:text-green-400" x-text="formatFundingAmount(opportunity.funding_amount)"></span>
                                                <span class="text-gray-500 dark:text-gray-400" x-text="opportunity.application_deadline"></span>
                                            </div>
                                            
                                            <div class="flex flex-wrap gap-1">
                                                <template x-for="area in opportunity.focus_areas" :key="area">
                                                    <span class="px-2 py-1 text-xs bg-gray-100 text-gray-600 dark:bg-gray-600 dark:text-gray-300 rounded" x-text="area.replace('_', ' ')"></span>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Testing Interface Tab -->
                <div x-show="false && activeTab === 'testing'" class="space-y-6" x-init="if (activeTab === 'testing') testingInterface.init()">
                    
                    <!-- Testing Header -->
                    <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-lg p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-3xl mr-4">üß™</span>
                                <div>
                                    <h2 class="text-2xl font-bold">Processor Testing Interface</h2>
                                    <p class="text-orange-100 mt-1">Real-time monitoring, testing, and validation</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button @click="testingInterface.refreshStatus()" 
                                        class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                                    <span class="text-lg mr-2">üîÑ</span>
                                    Refresh Status
                                </button>
                                <div class="flex items-center px-3 py-2 bg-white/20 rounded-lg">
                                    <span class="text-lg mr-2" x-text="testingInterface.getHealthStatusIcon(testingInterface.systemHealth)"></span>
                                    <span x-text="testingInterface.systemHealth.toUpperCase()"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System Status Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
                                    <span class="text-2xl">üíª</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total Processors</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white" x-text="testingInterface.processorStatuses.length"></p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-2 bg-green-100 dark:bg-green-900 rounded-lg">
                                    <span class="text-2xl">‚úÖ</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Healthy Processors</p>
                                    <p class="text-2xl font-bold text-green-600" x-text="testingInterface.processorStatuses.filter(p => p.health_status === 'healthy').length"></p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-2 bg-red-100 dark:bg-red-900 rounded-lg">
                                    <span class="text-2xl">‚ùå</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Error Count</p>
                                    <p class="text-2xl font-bold text-red-600" x-text="testingInterface.processorStatuses.filter(p => p.health_status === 'error').length"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Processor Status Table -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Processor Status Monitoring</h3>
                                <div class="flex items-center space-x-3">
                                    <button @click="testingInterface.toggleLogViewer()" 
                                            class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-2 rounded-md transition-colors">
                                        <span class="text-sm">üìã View Logs</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Processor</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Health Details</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <template x-for="processor in testingInterface.processorStatuses" :key="processor.name">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <span class="text-lg mr-2" x-text="testingInterface.getHealthStatusIcon(processor.health_status)"></span>
                                                    <span class="text-sm font-medium" 
                                                          :class="testingInterface.getHealthStatusColor(processor.health_status)"
                                                          x-text="processor.health_status"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="processor.name"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200" x-text="processor.type"></span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="text-sm text-gray-500 dark:text-gray-400" x-text="processor.health_details"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <div class="flex space-x-2">
                                                    <button @click="testingInterface.showTestDialog(processor.name)" 
                                                            :disabled="testingInterface.testRunning"
                                                            class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-3 py-1 rounded text-xs">
                                                        Configure & Test
                                                    </button>
                                                    <button @click="testingInterface.testProcessor(processor.name)" 
                                                            :disabled="testingInterface.testRunning"
                                                            class="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-3 py-1 rounded text-xs">
                                                        Quick Test
                                                    </button>
                                                    <button @click="testingInterface.loadProcessorLogs(processor.name)" 
                                                            class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-xs">
                                                        Logs
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Log Viewer Modal -->
                    <div x-show="testingInterface.logViewerVisible" 
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100"
                         x-transition:leave-end="opacity-0"
                         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-4xl h-3/4 overflow-hidden">
                            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">System Logs</h3>
                                <button @click="testingInterface.toggleLogViewer()" 
                                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                                    <span class="text-xl">√ó</span>
                                </button>
                            </div>
                            <div class="p-6 h-full overflow-y-auto">
                                <div class="space-y-2">
                                    <template x-for="log in testingInterface.systemLogs" :key="log.timestamp">
                                        <div class="flex space-x-4 py-2 border-b border-gray-100 dark:border-gray-700">
                                            <div class="text-xs text-gray-500 dark:text-gray-400 w-24 flex-shrink-0" x-text="new Date(log.timestamp).toLocaleTimeString()"></div>
                                            <div class="text-xs font-semibold w-16 flex-shrink-0" 
                                                 :class="{'text-red-600': log.level === 'ERROR', 'text-yellow-600': log.level === 'WARNING', 'text-blue-600': log.level === 'INFO', 'text-gray-600': log.level === 'DEBUG'}"
                                                 x-text="log.level"></div>
                                            <div class="text-sm text-gray-900 dark:text-white flex-1" x-text="log.message"></div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Configuration Dialog -->
                    <div x-show="testingInterface.configDialogVisible" 
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100"
                         x-transition:leave-end="opacity-0"
                         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-2xl max-h-3/4 overflow-hidden">
                            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                    Configure Test Parameters: <span x-text="testingInterface.selectedProcessor"></span>
                                </h3>
                                <button @click="testingInterface.closeConfigDialog()" 
                                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                                    <span class="text-xl">√ó</span>
                                </button>
                            </div>
                            <div class="p-6 overflow-y-auto">
                                <form @submit.prevent="testingInterface.runConfiguredTest()">
                                    <div class="space-y-6">
                                        
                                        <!-- Common Parameters -->
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                    Max Results
                                                </label>
                                                <input type="number" 
                                                       x-model="testingInterface.configParams.max_results"
                                                       min="1" max="100"
                                                       class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                    State
                                                </label>
                                                <select x-model="testingInterface.configParams.state"
                                                        class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                                    <option value="VA">Virginia</option>
                                                    <option value="MD">Maryland</option>
                                                    <option value="DC">Washington DC</option>
                                                    <option value="PA">Pennsylvania</option>
                                                    <option value="NC">North Carolina</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Processor-specific parameters -->
                                        <div x-show="['bmf_filter', 'propublica_fetch'].includes(testingInterface.selectedProcessor)">
                                            <h4 class="text-md font-semibold text-gray-900 dark:text-white mb-3">Organization Discovery Parameters</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                        Minimum Revenue
                                                    </label>
                                                    <input type="number" 
                                                           x-model="testingInterface.configParams.min_revenue"
                                                           min="0" step="1000"
                                                           class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                        NTEE Codes
                                                    </label>
                                                    <input type="text" 
                                                           x-model="testingInterface.configParams.ntee_codes"
                                                           placeholder="E.g., E21,E30,F30"
                                                           class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                                </div>
                                            </div>
                                        </div>

                                        <div x-show="['grants_gov_fetch', 'usaspending_fetch'].includes(testingInterface.selectedProcessor)">
                                            <h4 class="text-md font-semibold text-gray-900 dark:text-white mb-3">Government Grant Parameters</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                        Keywords
                                                    </label>
                                                    <input type="text" 
                                                           x-model="testingInterface.configParams.keywords"
                                                           placeholder="E.g., education,health,community"
                                                           class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                        Opportunity Category
                                                    </label>
                                                    <select x-model="testingInterface.configParams.opportunity_category"
                                                            class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                                        <option value="">All Categories</option>
                                                        <option value="D">Discretionary</option>
                                                        <option value="M">Mandatory</option>
                                                        <option value="O">Other</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div x-show="['foundation_directory_fetch', 'corporate_csr_analyzer'].includes(testingInterface.selectedProcessor)">
                                            <h4 class="text-md font-semibold text-gray-900 dark:text-white mb-3">Commercial Discovery Parameters</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                        Industries
                                                    </label>
                                                    <input type="text" 
                                                           x-model="testingInterface.configParams.industries"
                                                           placeholder="E.g., technology,healthcare"
                                                           class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                        Funding Range Min
                                                    </label>
                                                    <input type="number" 
                                                           x-model="testingInterface.configParams.funding_range_min"
                                                           min="0" step="1000"
                                                           class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                                </div>
                                            </div>
                                        </div>

                                        <div x-show="['intelligent_classifier'].includes(testingInterface.selectedProcessor)">
                                            <h4 class="text-md font-semibold text-gray-900 dark:text-white mb-3">Classification Parameters</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                        Minimum Score
                                                    </label>
                                                    <input type="number" 
                                                           x-model="testingInterface.configParams.min_score"
                                                           min="0" max="1" step="0.1"
                                                           class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                                </div>
                                                <div class="flex items-center">
                                                    <input type="checkbox" 
                                                           x-model="testingInterface.configParams.detailed_analysis"
                                                           class="rounded border-gray-300 dark:border-gray-600 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                                    <label class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                                                        Detailed Analysis
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Test Data Input -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                Test Data (JSON format, optional)
                                            </label>
                                            <textarea x-model="testingInterface.configParams.test_data"
                                                      rows="4"
                                                      placeholder='[{"ein": "123456789", "name": "Test Organization"}]'
                                                      class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm"></textarea>
                                        </div>

                                    </div>

                                    <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                                        <button type="button" 
                                                @click="testingInterface.closeConfigDialog()"
                                                class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-md transition-colors">
                                            Cancel
                                        </button>
                                        <button type="submit" 
                                                :disabled="testingInterface.testRunning"
                                                class="px-6 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 rounded-md transition-colors">
                                            <span x-show="!testingInterface.testRunning">Run Test</span>
                                            <span x-show="testingInterface.testRunning">Testing...</span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Test Results Panel -->
                    <div x-show="Object.keys(testingInterface.testResults).length > 0" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Test Results</h3>
                                <div class="flex items-center space-x-3">
                                    <select x-model="testingInterface.exportFormat" 
                                            class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                        <option value="json">JSON</option>
                                        <option value="csv">CSV</option>
                                    </select>
                                    <input type="text" 
                                           x-model="testingInterface.exportFilename"
                                           placeholder="Export filename"
                                           class="border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <template x-for="(result, processorName) in testingInterface.testResults" :key="processorName">
                                <div class="mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-semibold text-gray-900 dark:text-white" x-text="processorName"></h4>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xs text-gray-500 dark:text-gray-400" x-text="'Execution time: ' + result.execution_time_seconds + 's'"></span>
                                            <button @click="testingInterface.exportTestResults(processorName)" 
                                                    class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs">
                                                Export
                                            </button>
                                        </div>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-900 rounded-md p-3 text-sm">
                                        <pre class="text-gray-800 dark:text-gray-200 whitespace-pre-wrap" x-text="JSON.stringify(result, null, 2)"></pre>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                </div>

                <!-- Settings Tab -->
                <div x-show="false && activeTab === 'settings'" class="space-y-6">
                    
                    <!-- API Configuration -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                            <span class="text-2xl mr-3">üîë</span>
                            API Configuration
                        </h3>
                        
                        <form @submit.prevent="saveApiSettings()" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ProPublica API Key</label>
                                    <input type="password" x-model="settings.propublicaApiKey" placeholder="Enter API key..." 
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">API Timeout (ms)</label>
                                    <input type="number" x-model="settings.apiTimeout" min="1000" max="60000" 
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                </div>
                            </div>
                            
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Save API Settings
                            </button>
                        </form>
                    </div>
                    
                    <!-- Processing Settings -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                            <span class="text-2xl mr-3">‚ö°</span>
                            Processing Settings
                        </h3>
                        
                        <form @submit.prevent="saveProcessingSettings()" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Concurrent Requests</label>
                                    <input type="number" x-model="settings.concurrentRequests" min="1" max="20" 
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Retry Attempts</label>
                                    <input type="number" x-model="settings.retryAttempts" min="1" max="5" 
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cache Expiry (hours)</label>
                                    <input type="number" x-model="settings.cacheExpiry" min="1" max="168" 
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white">
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-4">
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="settings.enableCaching" class="rounded mr-2">
                                    <span class="text-sm text-gray-700 dark:text-gray-300">Enable caching</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="settings.autoExport" class="rounded mr-2">
                                    <span class="text-sm text-gray-700 dark:text-gray-300">Auto-export results</span>
                                </label>
                            </div>
                            
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Save Processing Settings
                            </button>
                        </form>
                    </div>
                    
                    <!-- System Information -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg dark:shadow-gray-900/50 p-6 animate-fade-in">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                            <span class="text-2xl mr-3">üíª</span>
                            System Information
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Version:</span>
                                    <span class="font-medium">Catalynx 2.0</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Processors Available:</span>
                                    <span class="font-medium" x-text="systemInfo.processorsCount || 12"></span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Cache Size:</span>
                                    <span class="font-medium" x-text="formatFileSize(systemInfo.cacheSize || 0)"></span>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Uptime:</span>
                                    <span class="font-medium" x-text="systemInfo.uptime || 'Unknown'"></span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Total Organizations:</span>
                                    <span class="font-medium" x-text="(systemInfo.totalOrganizations || 0).toLocaleString()"></span>
                                </div>
                                <div class="flex justify-between text-sm bmf-data-section">
                                    <span class="text-gray-600 dark:text-gray-400">BMF Records:</span>
                                    <span class="font-medium" x-text="(systemInfo.bmfRecords || 0).toLocaleString()"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                            <div class="flex space-x-4">
                                <button @click="clearCache()" class="px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700">
                                    Clear Cache
                                </button>
                                <button @click="exportSystemLogs()" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                                    Export Logs
                                </button>
                                <button @click="resetSettings()" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                                    Reset to Defaults
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 2: DISCOVER (Multi-Track Discovery) - DUPLICATE HIDDEN -->
                <div x-show="false" class="space-y-6">
                    <div class="bg-gradient-to-r from-green-600 to-teal-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Discovery Hub</h3>
                        <p class="mt-2 opacity-90">Multi-track opportunity discovery across all funding sources</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-semibold mb-4">Discovery Tracks</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                                <h5 class="font-medium text-blue-900 dark:text-blue-100">Nonprofits</h5>
                                <p class="text-sm text-blue-700 dark:text-blue-300">IRS data, 990 & 990-PF filings</p>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                                <h5 class="font-medium text-green-900 dark:text-green-100">Federal Grants</h5>
                                <p class="text-sm text-green-700 dark:text-green-300">Grants.gov opportunities</p>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg">
                                <h5 class="font-medium text-purple-900 dark:text-purple-100">State Agencies</h5>
                                <p class="text-sm text-purple-700 dark:text-purple-300">Virginia state grants</p>
                            </div>
                            <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg">
                                <h5 class="font-medium text-orange-900 dark:text-orange-100">Commercial</h5>
                                <p class="text-sm text-orange-700 dark:text-orange-300">Corporate foundations</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 3: ANALYZE (Comprehensive Analysis) - HIDDEN FULL CONTENT -->
                <div x-show="false" class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Analysis Hub</h3>
                        <p class="mt-2 opacity-90">Financial, network and intelligence analysis</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-semibold mb-4">Analysis Components</h4>
                        <div class="space-y-4">
                            <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                                <h5 class="font-medium">Financial Health Assessment</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Revenue analysis, financial stability scoring</p>
                            </div>
                            <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                                <h5 class="font-medium">Network Analysis</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Board connections and strategic relationships</p>
                            </div>
                            <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                                <h5 class="font-medium">Competitive Intelligence</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Market positioning and opportunity assessment</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 4: PLAN (Strategic Planning & AI Classification) - HIDDEN FULL CONTENT -->
                <div x-show="false" class="space-y-6">
                    <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Strategic Planning</h3>
                        <p class="mt-2 opacity-90">AI-powered recommendations and strategic guidance</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-semibold mb-4">Planning Tools</h4>
                        <div class="space-y-4">
                            <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                <h5 class="font-medium text-orange-900 dark:text-orange-100">AI Classification</h5>
                                <p class="text-sm text-orange-700 dark:text-orange-300">Intelligent opportunity categorization</p>
                            </div>
                            <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                <h5 class="font-medium text-red-900 dark:text-red-100">Strategic Recommendations</h5>
                                <p class="text-sm text-red-700 dark:text-red-300">Prioritized action plans and next steps</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 5: EXECUTE (Implementation & Export) - HIDDEN FULL CONTENT -->
                <div x-show="false" class="space-y-6">
                    <div class="bg-gradient-to-r from-gray-600 to-gray-700 rounded-lg p-6 text-white">
                        <h3 class="text-2xl font-bold">Implementation Hub</h3>
                        <p class="mt-2 opacity-90">Export comprehensive reports and manage implementation</p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-semibold mb-4">Export Options</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                                <h5 class="font-medium">CSV Reports</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Structured data exports</p>
                            </div>
                            <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                                <h5 class="font-medium">PDF Summaries</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Executive summaries</p>
                            </div>
                            <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                                <h5 class="font-medium">Interactive Networks</h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Network visualizations</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Scoring Details Modal (Global) -->
    <div x-show="showScoringModal" x-cloak
         class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-3xl shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="flex items-center justify-between pb-3 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white" 
                    x-text="selectedScoringDetails?.organization_name + ' - Scoring Details' || 'Scoring Details'"></h3>
                <button @click="showScoringModal = false" 
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mt-4">
                <!-- Organization Overview -->
                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-blue-900 dark:text-blue-100 mb-3">Organization Overview</h4>
                    <p class="text-blue-800 dark:text-blue-200 mb-3" x-text="selectedScoringDetails?.description || 'No description available'"></p>
                    
                    <h5 class="font-medium text-blue-900 dark:text-blue-100 mb-2">Financial Summary</h5>
                    <div class="text-sm text-blue-800 dark:text-blue-200">
                        <div><strong>Revenue:</strong> <span x-text="selectedScoringDetails?.revenue ? '$' + selectedScoringDetails.revenue.toLocaleString() : 'N/A'"></span></div>
                        <div><strong>Program Ratio:</strong> <span x-text="selectedScoringDetails?.program_expense_ratio ? (selectedScoringDetails.program_expense_ratio * 100).toFixed(1) + '%' : 'N/A'"></span></div>
                    </div>
                </div>

                <!-- Combined Score Display -->
                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Combined Score</h4>
                    <div class="flex items-center space-x-4">
                        <div class="flex-1">
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                                <div class="h-3 rounded-full transition-all duration-300" 
                                     :class="(selectedScoringDetails?.combined_score || 0) >= 0.9 ? 'bg-green-600' : 
                                             (selectedScoringDetails?.combined_score || 0) >= 0.75 ? 'bg-yellow-600' : 
                                             (selectedScoringDetails?.combined_score || 0) >= 0.5 ? 'bg-orange-600' : 'bg-red-600'"
                                     :style="`width: ${(selectedScoringDetails?.combined_score || 0) * 100}%`"></div>
                            </div>
                        </div>
                        <div class="text-lg font-bold text-gray-900 dark:text-white" 
                             x-text="((selectedScoringDetails?.combined_score || 0) * 100).toFixed(1) + '%'"></div>
                        <div class="text-sm px-2 py-1 rounded-full" 
                             :class="(selectedScoringDetails?.combined_score || 0) >= 0.75 ? 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100' : 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100'"
                             x-text="(selectedScoringDetails?.combined_score || 0) >= 0.75 ? 'Promotion Eligible' : 'Below Threshold'"></div>
                    </div>
                </div>

                <!-- Individual Score Breakdown -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- 990 XML Analysis Score -->
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                        <h5 class="font-medium text-blue-900 dark:text-blue-100 mb-2">990 XML Analysis</h5>
                        <div class="text-2xl font-bold text-blue-900 dark:text-blue-100" 
                             x-text="((selectedScoringDetails?.xml_990_score || 0) * 100).toFixed(1) + '%'"></div>
                        <div class="w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2 mt-2">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                 :style="`width: ${(selectedScoringDetails?.xml_990_score || 0) * 100}%`"></div>
                        </div>
                        <div class="text-xs text-blue-700 dark:text-blue-300 mt-1">Weight: 40%</div>
                    </div>

                    <!-- Network Discovery Score -->
                    <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4">
                        <h5 class="font-medium text-purple-900 dark:text-purple-100 mb-2">Network Discovery</h5>
                        <div class="text-2xl font-bold text-purple-900 dark:text-purple-100" 
                             x-text="((selectedScoringDetails?.network_score || 0) * 100).toFixed(1) + '%'"></div>
                        <div class="w-full bg-purple-200 dark:bg-purple-800 rounded-full h-2 mt-2">
                            <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" 
                                 :style="`width: ${(selectedScoringDetails?.network_score || 0) * 100}%`"></div>
                        </div>
                        <div class="text-xs text-purple-700 dark:text-purple-300 mt-1">Weight: 35%</div>
                    </div>

                    <!-- Enhanced Scoring -->
                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4">
                        <h5 class="font-medium text-green-900 dark:text-green-100 mb-2">Enhanced Scoring</h5>
                        <div class="text-2xl font-bold text-green-900 dark:text-green-100" 
                             x-text="((selectedScoringDetails?.enhanced_score || 0) * 100).toFixed(1) + '%'"></div>
                        <div class="w-full bg-green-200 dark:bg-green-800 rounded-full h-2 mt-2">
                            <div class="bg-green-600 h-2 rounded-full transition-all duration-300" 
                                 :style="`width: ${(selectedScoringDetails?.enhanced_score || 0) * 100}%`"></div>
                        </div>
                        <div class="text-xs text-green-700 dark:text-green-300 mt-1">Weight: 25%</div>
                    </div>
                </div>

                <!-- Organization Details -->
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mt-4 border border-gray-200 dark:border-gray-700">
                    <h5 class="font-medium text-gray-900 dark:text-white mb-3">Organization Details</h5>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="text-gray-900 dark:text-gray-100"><strong>Source:</strong> <span x-text="selectedScoringDetails?.discovery_source || 'N/A'"></span></div>
                        <div class="text-gray-900 dark:text-gray-100"><strong>Program:</strong> <span x-text="selectedScoringDetails?.program_name || 'N/A'"></span></div>
                        <div class="text-gray-900 dark:text-gray-100"><strong>Stage:</strong> <span x-text="formatStageWithNumber(getActualStage(selectedScoringDetails || {})) || 'N/A'"></span></div>
                        <div class="text-gray-900 dark:text-gray-100"><strong>Funding Amount:</strong> <span x-text="selectedScoringDetails?.funding_amount ? '$' + selectedScoringDetails.funding_amount.toLocaleString() : 'N/A'"></span></div>
                        <div class="text-gray-900 dark:text-gray-100"><strong>Deadline:</strong> <span x-text="selectedScoringDetails?.application_deadline || 'N/A'"></span></div>
                        <div class="text-gray-900 dark:text-gray-100"><strong>Discovered:</strong> <span x-text="selectedScoringDetails?.discovered_at ? new Date(selectedScoringDetails.discovered_at).toLocaleDateString() : 'N/A'"></span></div>
                        <div class="text-gray-900 dark:text-gray-100"><strong>Contact:</strong> <span x-text="selectedScoringDetails?.contact_info?.email || 'N/A'"></span></div>
                        <div class="text-gray-900 dark:text-gray-100"><strong>Location:</strong> <span x-text="selectedScoringDetails?.geographic_info ? (selectedScoringDetails.geographic_info.city + ', ' + selectedScoringDetails.geographic_info.state) : 'N/A'"></span></div>
                    </div>
                </div>
            </div>

            <!-- Modal Actions -->
            <div class="flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700">
                <button @click="showScoringModal = false" 
                        class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-400 dark:hover:bg-gray-500">
                    Close
                </button>
                <div class="flex space-x-2">
                    <button @click="demoteProspect(selectedScoringDetails)" 
                            :disabled="getActualStage(selectedScoringDetails || {}) === 'discovery'"
                            class="px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded">
                        Demote
                    </button>
                    <button @click="promoteProspect(selectedScoringDetails)" 
                            :disabled="(selectedScoringDetails?.combined_score || 0) < 0.75 || selectedScoringDetails?.funnel_stage === 'opportunities'"
                            class="px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded">
                        Promote
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Opportunity Details Modal -->
    <div x-show="showOpportunityModal && selectedOpportunity" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto">
        
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
             @click="showOpportunityModal = false"></div>
        
        <!-- Modal content -->
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 class="flex flex-col bg-white dark:bg-gray-800 rounded-lg text-left shadow-xl transform transition-all w-[95vw] max-w-6xl mx-auto border-2 border-gray-300 dark:border-gray-600 max-h-[90vh] overflow-hidden p-6">
                
                <!-- Modal Header -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-4">
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white">
                            <span x-text="selectedOpportunity?.organization_name || 'Opportunity Details'"></span>
                        </h3>
                        <!-- Overall Score Badge -->
                        <div class="flex items-center space-x-3">
                            <span class="inline-flex items-center px-4 py-2 rounded-full text-lg font-bold"
                                  :class="selectedOpportunity && getOpportunityScore(selectedOpportunity) >= 0.80 ? 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100' : 
                                          selectedOpportunity && getOpportunityScore(selectedOpportunity) >= 0.65 ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100' : 
                                          'bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100'">
                                <span x-text="selectedOpportunity ? (getOpportunityScore(selectedOpportunity) * 100).toFixed(1) + '%' : 'N/A'"></span>
                            </span>
                            <!-- Promotion Status Badge -->
                            <span x-show="selectedOpportunity && getOpportunityScore(selectedOpportunity) >= 0.80" 
                                  class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"></div>
                                Auto-Promote Ready
                            </span>
                            <span x-show="selectedOpportunity && getOpportunityScore(selectedOpportunity) >= 0.65 && getOpportunityScore(selectedOpportunity) < 0.80" 
                                  class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full mr-1"></div>
                                Review for Promotion
                            </span>
                            <!-- Stage Display Badge -->
                            <div class="flex flex-col items-center">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100 mb-1">
                                    <span x-text="getStageDisplayName(selectedOpportunity?.funnel_stage || selectedOpportunity?.stage || 'prospects')"></span>
                                </span>
                                <span class="text-xs text-gray-500 dark:text-gray-400" x-text="'DB: ' + (selectedOpportunity?.current_stage || selectedOpportunity?.pipeline_stage || 'discovery')"></span>
                            </div>
                        </div>
                    </div>
                    <button @click="closeOpportunityModal()" 
                            class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300">
                        <span class="text-2xl">&times;</span>
                    </button>
                </div>
                
                <!-- Modal Content -->
                <div class="flex flex-col flex-1 min-h-0 max-h-[80vh] overflow-hidden">
                    
                    <!-- Enhanced Tab Navigation -->
                    <div class="bg-gray-50 dark:bg-gray-700 px-4 pt-4 pb-0 mb-4">
                        <nav class="flex space-x-2 overflow-x-auto pb-4">
                            <!-- Overview Tab (merged Summary + Overview) -->
                            <button @click="modalActiveTab = 'overview'" 
                                    :class="modalActiveTab === 'overview' ? 'bg-indigo-500 text-white shadow-md' : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-gray-500'"
                                    class="flex items-center space-x-2 px-4 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                <span>Overview</span>
                            </button>
                            
                            <!-- DISCOVER Results Tab -->
                            <button x-show="hasDiscoverResults(selectedOpportunity)"
                                    @click="modalActiveTab = 'discover'" 
                                    :class="modalActiveTab === 'discover' ? 'bg-green-500 text-white shadow-md' : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-green-50 dark:hover:bg-gray-500'"
                                    class="flex items-center space-x-2 px-4 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap relative">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                                <span>DISCOVER</span>
                                <!-- Processing Indicator -->
                                <div x-show="selectedOpportunity && hasDiscoverResults(selectedOpportunity) && !selectedOpportunity?.government_scores"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse">
                                </div>
                                <!-- Completion Badge -->
                                <div x-show="selectedOpportunity?.government_scores"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-green-600 rounded-full">
                                    <div class="w-full h-full bg-green-600 rounded-full flex items-center justify-center">
                                        <svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                </div>
                            </button>
                            
                            <!-- PLAN Results Tab -->
                            <button @click="modalActiveTab = 'plan'" 
                                    :class="modalActiveTab === 'plan' ? 'bg-yellow-500 text-white shadow-md' : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-yellow-50 dark:hover:bg-gray-500'"
                                    class="flex items-center space-x-2 px-4 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap relative">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span>PLAN</span>
                                <!-- Processing Indicator -->
                                <div x-show="selectedOpportunity && hasPlanResults(selectedOpportunity) && !selectedOpportunity?.ai_analysis"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-yellow-400 rounded-full animate-pulse">
                                </div>
                                <!-- Completion Badge -->
                                <div x-show="selectedOpportunity?.ai_analysis"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-yellow-600 rounded-full">
                                    <div class="w-full h-full bg-yellow-600 rounded-full flex items-center justify-center">
                                        <svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                </div>
                            </button>
                            
                            <!-- ANALYZE Results Tab -->
                            <button @click="modalActiveTab = 'analyze'" 
                                    :class="modalActiveTab === 'analyze' ? 'bg-orange-500 text-white shadow-md' : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-orange-50 dark:hover:bg-gray-500'"
                                    class="flex items-center space-x-2 px-4 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap relative">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <span>ANALYZE</span>
                                <!-- Processing Indicator -->
                                <div x-show="selectedOpportunity && hasAnalyzeResults(selectedOpportunity) && !selectedOpportunity?.network_analysis && !selectedOpportunity?.board_connections"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-orange-400 rounded-full animate-pulse">
                                </div>
                                <!-- Completion Badge -->
                                <div x-show="selectedOpportunity?.network_analysis || selectedOpportunity?.board_connections"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-orange-600 rounded-full">
                                    <div class="w-full h-full bg-orange-600 rounded-full flex items-center justify-center">
                                        <svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                </div>
                            </button>
                            
                            <!-- EXAMINE Results Tab -->
                            <button @click="modalActiveTab = 'examine'" 
                                    :class="modalActiveTab === 'examine' ? 'bg-blue-500 text-white shadow-md' : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-gray-500'"
                                    class="flex items-center space-x-2 px-4 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap relative">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                <span>EXAMINE</span>
                                <!-- Processing Indicator -->
                                <div x-show="selectedOpportunity && hasExamineResults(selectedOpportunity) && !selectedOpportunity?.strategic_dossier && !selectedOpportunity?.intelligence_patterns"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-blue-400 rounded-full animate-pulse">
                                </div>
                                <!-- Completion Badge -->
                                <div x-show="selectedOpportunity?.strategic_dossier || selectedOpportunity?.intelligence_patterns"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-blue-600 rounded-full">
                                    <div class="w-full h-full bg-blue-600 rounded-full flex items-center justify-center">
                                        <svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                </div>
                                <!-- Target Badge for targets stage -->
                                <div x-show="selectedOpportunity?.stage === 'targets' || selectedOpportunity?.current_stage === 'targets'"
                                     class="absolute -top-2 -left-2 text-xs bg-blue-600 text-white px-1.5 py-0.5 rounded-full font-bold">
                                    Target
                                </div>
                            </button>
                            
                            <!-- APPROACH Results Tab -->
                            <button @click="modalActiveTab = 'approach'" 
                                    :class="modalActiveTab === 'approach' ? 'bg-green-500 text-white shadow-md' : 'bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-green-50 dark:hover:bg-gray-500'"
                                    class="flex items-center space-x-2 px-4 py-3 rounded-lg font-medium text-sm transition-all duration-200 whitespace-nowrap relative">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                                </svg>
                                <span>APPROACH</span>
                                <!-- Processing Indicator -->
                                <div x-show="selectedOpportunity && hasApproachResults(selectedOpportunity) && !selectedOpportunity?.approach_strategy"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse">
                                </div>
                                <!-- Completion Badge -->
                                <div x-show="selectedOpportunity?.approach_strategy"
                                     class="absolute -top-1 -right-1 w-3 h-3 bg-green-600 rounded-full">
                                    <div class="w-full h-full bg-green-600 rounded-full flex items-center justify-center">
                                        <svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                </div>
                                <!-- Opportunity Badge for opportunities stage -->
                                <div x-show="selectedOpportunity?.stage === 'opportunities' || selectedOpportunity?.current_stage === 'opportunities'"
                                     class="absolute -top-2 -left-2 text-xs bg-green-600 text-white px-1.5 py-0.5 rounded-full font-bold">
                                    Opportunity
                                </div>
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="flex-1 overflow-y-auto px-4 pb-4" style="min-height: 0;">
                        
                        
                        <!-- Overview Tab -->
                        <div x-show="modalActiveTab === 'overview'" class="space-y-6">
                            <!-- Opportunity Highlights Header -->
                            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg border border-indigo-200 dark:border-indigo-800 p-6">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <h4 class="text-xl font-bold text-indigo-900 dark:text-indigo-100">
                                            <span x-text="selectedOpportunity?.organization_name || 'Opportunity Details'"></span>
                                        </h4>
                                        <p class="text-indigo-700 dark:text-indigo-300 mt-1" 
                                           x-text="selectedOpportunity?.discovery_source || 'Unknown Source'"></p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-indigo-900 dark:text-indigo-100" 
                                             x-text="selectedOpportunity?.funding_amount ? '$' + selectedOpportunity.funding_amount.toLocaleString() : 'Amount TBD'"></div>
                                        <div class="text-sm text-indigo-700 dark:text-indigo-300">Funding Amount</div>
                                    </div>
                                </div>
                                
                                <!-- Key Opportunity Details Grid -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Organization Type</div>
                                        <div class="font-semibold text-gray-900 dark:text-white" 
                                             x-text="selectedOpportunity?.source_type || selectedOpportunity?.organization_type || 'Nonprofit'"></div>
                                    </div>
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Current Stage</div>
                                        <div class="font-semibold">
                                            <span :class="selectedOpportunity ? getStageColor(getActualStage(selectedOpportunity)) : ''"
                                                  class="px-2 py-1 rounded-full text-xs"
                                                  x-text="selectedOpportunity ? formatStageWithNumber(getActualStage(selectedOpportunity)) : 'N/A'"></span>
                                        </div>
                                    </div>
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Match Score</div>
                                        <div class="font-semibold">
                                            <span :class="selectedOpportunity && getOpportunityScore(selectedOpportunity) >= 0.80 ? 'text-green-600' : 
                                                          selectedOpportunity && getOpportunityScore(selectedOpportunity) >= 0.65 ? 'text-yellow-600' : 'text-red-600'"
                                                  x-text="selectedOpportunity ? (getOpportunityScore(selectedOpportunity) * 100).toFixed(1) + '%' : 'N/A'"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Geographic Scope & Eligibility -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">üìç Geographic Scope & Eligibility</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Geographic Information -->
                                    <div>
                                        <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Geographic Coverage</h5>
                                        <div class="space-y-2">
                                            <div x-show="selectedOpportunity?.geographic_scope" class="flex items-center space-x-2">
                                                <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                                <span class="text-sm text-gray-600 dark:text-gray-400" 
                                                      x-text="selectedOpportunity?.geographic_scope || 'Geographic scope not specified'"></span>
                                            </div>
                                            <div x-show="selectedOpportunity?.states_served" class="flex items-center space-x-2">
                                                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                                <span class="text-sm text-gray-600 dark:text-gray-400">
                                                    States: <span x-text="Array.isArray(selectedOpportunity?.states_served) ? selectedOpportunity.states_served.join(', ') : selectedOpportunity?.states_served || 'Not specified'"></span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Eligibility Requirements -->
                                    <div>
                                        <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Eligibility Requirements</h5>
                                        <div class="space-y-2">
                                            <div class="flex items-center space-x-2">
                                                <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                                                <span class="text-sm text-gray-600 dark:text-gray-400">
                                                    NTEE Focus: <span x-text="selectedOpportunity?.ntee_classification || 'General'"></span>
                                                </span>
                                            </div>
                                            <div x-show="selectedOpportunity?.min_revenue_requirement" class="flex items-center space-x-2">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full"></span>
                                                <span class="text-sm text-gray-600 dark:text-gray-400">
                                                    Min Revenue: <span x-text="'$' + (selectedOpportunity?.min_revenue_requirement?.toLocaleString() || '0')"></span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Application Information -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">üìã Application Information</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Application Status -->
                                    <div>
                                        <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Application Acceptance</h5>
                                        <div x-show="selectedOpportunity?.accepts_applications !== undefined" class="space-y-2">
                                            <div class="flex items-center space-x-2">
                                                <span :class="selectedOpportunity?.accepts_applications ? 'w-3 h-3 bg-green-500 rounded-full' : 'w-3 h-3 bg-red-500 rounded-full'"></span>
                                                <span class="font-medium" :class="selectedOpportunity?.accepts_applications ? 'text-green-700 dark:text-green-300' : 'text-red-700 dark:text-red-300'"
                                                      x-text="selectedOpportunity?.accepts_applications ? 'Accepts Direct Applications' : 'Invitation Only / No Applications'"></span>
                                            </div>
                                            <div x-show="selectedOpportunity?.application_deadline" class="text-sm text-gray-600 dark:text-gray-400">
                                                Deadline: <span x-text="selectedOpportunity?.application_deadline || 'Not specified'"></span>
                                            </div>
                                        </div>
                                        <div x-show="selectedOpportunity?.accepts_applications === undefined" class="text-sm text-gray-500 dark:text-gray-400">
                                            Application status not available
                                        </div>
                                    </div>
                                    
                                    <!-- Requirements Summary -->
                                    <div>
                                        <h5 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Key Requirements</h5>
                                        <div class="space-y-2">
                                            <div x-show="selectedOpportunity?.required_documents" class="text-sm text-gray-600 dark:text-gray-400">
                                                <span class="font-medium">Documents:</span> 
                                                <span x-text="Array.isArray(selectedOpportunity?.required_documents) ? selectedOpportunity.required_documents.join(', ') : selectedOpportunity?.required_documents || 'Standard nonprofit documentation'"></span>
                                            </div>
                                            <div x-show="selectedOpportunity?.matching_requirement" class="text-sm text-gray-600 dark:text-gray-400">
                                                <span class="font-medium">Matching Funds:</span> 
                                                <span x-text="selectedOpportunity?.matching_requirement ? selectedOpportunity.matching_requirement + '% required' : 'Not specified'"></span>
                                            </div>
                                            <div x-show="selectedOpportunity?.project_duration" class="text-sm text-gray-600 dark:text-gray-400">
                                                <span class="font-medium">Project Duration:</span> 
                                                <span x-text="selectedOpportunity?.project_duration || 'Not specified'"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Financial Summary -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">üí∞ Financial Overview</h4>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div class="text-2xl font-bold text-green-600 dark:text-green-400" 
                                             x-text="selectedOpportunity?.funding_amount ? '$' + (selectedOpportunity.funding_amount / 1000) + 'K' : 'TBD'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Grant Amount</div>
                                    </div>
                                    <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" 
                                             x-text="selectedOpportunity?.organization_revenue ? '$' + (selectedOpportunity.organization_revenue / 1000000).toFixed(1) + 'M' : 'N/A'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Org Revenue</div>
                                    </div>
                                    <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" 
                                             x-text="selectedOpportunity?.organization_assets ? '$' + (selectedOpportunity.organization_assets / 1000000).toFixed(1) + 'M' : 'N/A'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Org Assets</div>
                                    </div>
                                    <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div class="text-2xl font-bold text-orange-600 dark:text-orange-400" 
                                             x-text="selectedOpportunity?.funding_amount && selectedOpportunity?.organization_revenue ? ((selectedOpportunity.funding_amount / selectedOpportunity.organization_revenue) * 100).toFixed(1) + '%' : 'N/A'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">% of Revenue</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- DISCOVER Results Tab -->
                        <div x-show="modalActiveTab === 'discover'" class="space-y-4">
                            <!-- Government Scoring Breakdown -->
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg border border-green-200 dark:border-green-800 p-4">
                                <h4 class="text-lg font-bold text-green-900 dark:text-green-100 mb-3">üîç Government Scoring Analysis</h4>
                                
                                <!-- Data Available State -->
                                <div x-show="_hasTabData(selectedOpportunity, 'discover')" class="space-y-4">
                                
                                <!-- Enhanced Scoring Grid -->
                                <div class="grid grid-cols-2 lg:grid-cols-5 gap-3 mb-6">
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center border-l-4 border-green-500">
                                        <div class="text-lg font-bold text-green-600 dark:text-green-400" 
                                             x-text="(getOpportunityScore(selectedOpportunity) * 100).toFixed(1) + '%'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Overall Score</div>
                                        <div class="text-xs text-green-600 dark:text-green-400 mt-1">
                                            <span x-text="selectedOpportunity?.scoring?.confidence_level ? 'Confidence: ' + (selectedOpportunity.scoring.confidence_level * 100).toFixed(0) + '%' : 'Dynamic'"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center border-l-4 border-blue-500">
                                        <div class="text-lg font-bold text-blue-600 dark:text-blue-400" 
                                             x-text="selectedOpportunity?.government_scores?.eligibility_score ? (selectedOpportunity.government_scores.eligibility_score * 100).toFixed(0) + '%' : 'Data not available'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Eligibility</div>
                                        <div class="text-xs text-blue-600 dark:text-blue-400 mt-1">Weight: 30%</div>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center border-l-4 border-purple-500">
                                        <div class="text-lg font-bold text-purple-600 dark:text-purple-400"
                                             x-text="selectedOpportunity?.government_scores?.geographic_score ? (selectedOpportunity.government_scores.geographic_score * 100).toFixed(0) + '%' : 'Data not available'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Geographic</div>
                                        <div class="text-xs text-purple-600 dark:text-purple-400 mt-1">Weight: 20%</div>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center border-l-4 border-orange-500">
                                        <div class="text-lg font-bold text-orange-600 dark:text-orange-400"
                                             x-text="selectedOpportunity?.government_scores?.timing_score ? (selectedOpportunity.government_scores.timing_score * 100).toFixed(0) + '%' : 'Data not available'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Timing</div>
                                        <div class="text-xs text-orange-600 dark:text-orange-400 mt-1">Weight: 20%</div>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center border-l-4 border-yellow-500">
                                        <div class="text-lg font-bold text-yellow-600 dark:text-yellow-400"
                                             x-text="selectedOpportunity?.government_scores?.financial_score ? (selectedOpportunity.government_scores.financial_score * 100).toFixed(0) + '%' : 'Data not available'"></div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Financial Fit</div>
                                        <div class="text-xs text-yellow-600 dark:text-yellow-400 mt-1">Weight: 15%</div>
                                    </div>
                                </div>
                                
                                <!-- Algorithm Transparency -->
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-green-200 dark:border-green-700 mb-4">
                                    <h5 class="font-semibold text-green-900 dark:text-green-100 mb-3 flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                        Scoring Algorithm Breakdown
                                    </h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <h6 class="font-medium text-gray-900 dark:text-white mb-2">Calculation Method</h6>
                                            <p class="text-gray-600 dark:text-gray-400 text-xs">
                                                Overall Score = (Eligibility √ó 0.30) + (Geographic √ó 0.20) + (Timing √ó 0.20) + (Financial √ó 0.15) + (Historical √ó 0.15)
                                            </p>
                                        </div>
                                        <div>
                                            <h6 class="font-medium text-gray-900 dark:text-white mb-2">Data Sources</h6>
                                            <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                                                <li>‚Ä¢ <span x-text="selectedOpportunity?.external_data?.ntee_code ? 'NTEE Code: ' + selectedOpportunity.external_data.ntee_code : 'Organization classification'"></span></li>
                                                <li>‚Ä¢ <span x-text="selectedOpportunity?.external_data?.state ? 'Location: ' + selectedOpportunity.external_data.state : 'Geographic data'"></span></li>
                                                <li>‚Ä¢ <span x-text="selectedOpportunity?.financial_data ? 'Financial records available' : 'Revenue/Asset estimation'"></span></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Dynamic Insights -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-4">
                                        <h5 class="font-medium text-green-800 dark:text-green-200 text-sm mb-3 flex items-center">
                                            <span class="text-green-600 mr-2">‚úÖ</span>
                                            Scoring Strengths
                                        </h5>
                                        <ul class="text-xs text-green-700 dark:text-green-300 space-y-2">
                                            <li x-show="selectedOpportunity?.external_data?.ntee_code" class="flex items-start">
                                                <span class="w-1 h-1 bg-green-500 rounded-full mt-2 mr-2 flex-shrink-0"></span>
                                                <span>Mission alignment via NTEE code <span x-text="selectedOpportunity?.external_data?.ntee_code" class="font-mono"></span></span>
                                            </li>
                                            <li x-show="selectedOpportunity?.external_data?.state === 'VA'" class="flex items-start">
                                                <span class="w-1 h-1 bg-green-500 rounded-full mt-2 mr-2 flex-shrink-0"></span>
                                                <span>Geographic advantage (Virginia-based)</span>
                                            </li>
                                            <li x-show="getOpportunityScore(selectedOpportunity) >= 0.7" class="flex items-start">
                                                <span class="w-1 h-1 bg-green-500 rounded-full mt-2 mr-2 flex-shrink-0"></span>
                                                <span>High overall compatibility score</span>
                                            </li>
                                            <li x-show="selectedOpportunity?.financial_data?.total_revenue" class="flex items-start">
                                                <span class="w-1 h-1 bg-green-500 rounded-full mt-2 mr-2 flex-shrink-0"></span>
                                                <span>Financial data available for assessment</span>
                                            </li>
                                            <li x-show="!selectedOpportunity?.external_data?.ntee_code && !selectedOpportunity?.external_data?.state && getOpportunityScore(selectedOpportunity) < 0.7" class="text-gray-500 italic">
                                                Analysis in progress...
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-4">
                                        <h5 class="font-medium text-yellow-800 dark:text-yellow-200 text-sm mb-3 flex items-center">
                                            <span class="text-yellow-600 mr-2">‚ö†Ô∏è</span>
                                            Considerations
                                        </h5>
                                        <ul class="text-xs text-yellow-700 dark:text-yellow-300 space-y-2">
                                            <li x-show="getOpportunityScore(selectedOpportunity) < 0.6" class="flex items-start">
                                                <span class="w-1 h-1 bg-yellow-500 rounded-full mt-2 mr-2 flex-shrink-0"></span>
                                                <span>Score below optimal threshold</span>
                                            </li>
                                            <li x-show="!selectedOpportunity?.financial_data" class="flex items-start">
                                                <span class="w-1 h-1 bg-yellow-500 rounded-full mt-2 mr-2 flex-shrink-0"></span>
                                                <span>Limited financial data for assessment</span>
                                            </li>
                                            <li x-show="selectedOpportunity?.external_data?.state && selectedOpportunity?.external_data?.state !== 'VA'" class="flex items-start">
                                                <span class="w-1 h-1 bg-yellow-500 rounded-full mt-2 mr-2 flex-shrink-0"></span>
                                                <span>Geographic distance may impact accessibility</span>
                                            </li>
                                            <li x-show="selectedOpportunity?.current_stage === 'pre_scoring'" class="flex items-start">
                                                <span class="w-1 h-1 bg-yellow-500 rounded-full mt-2 mr-2 flex-shrink-0"></span>
                                                <span>Early stage - additional analysis needed</span>
                                            </li>
                                            <li x-show="getOpportunityScore(selectedOpportunity) >= 0.6 && selectedOpportunity?.financial_data && (selectedOpportunity?.external_data?.state === 'VA' || !selectedOpportunity?.external_data?.state)" class="text-gray-500 italic">
                                                No significant concerns identified
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <!-- Comprehensive Opportunity Details Section -->
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 mb-4">
                                    <h5 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                        <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                                        Opportunity Details
                                    </h5>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <!-- Basic Information -->
                                        <div>
                                            <h6 class="font-medium text-gray-900 dark:text-white mb-3">Basic Information</h6>
                                            <div class="space-y-2 text-sm">
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Organization:</span>
                                                    <span class="font-medium text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.organization_name || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Current Stage:</span>
                                                    <span class="font-medium text-right capitalize text-gray-900 dark:text-white" x-text="selectedOpportunity?.funnel_stage || selectedOpportunity?.stage || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Database Stage:</span>
                                                    <span class="font-medium text-right capitalize text-gray-500 dark:text-gray-400" x-text="selectedOpportunity?.current_stage || selectedOpportunity?.pipeline_stage || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Opportunity ID:</span>
                                                    <span class="font-mono text-xs text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.opportunity_id || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Discovery Date:</span>
                                                    <span class="text-right text-xs text-gray-900 dark:text-white" x-text="selectedOpportunity?.created_at ? new Date(selectedOpportunity.created_at).toLocaleDateString() : 'Data not available'"></span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Financial Information -->
                                        <div>
                                            <h6 class="font-medium text-gray-900 dark:text-white mb-3">Financial Information</h6>
                                            <div class="space-y-2 text-sm">
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Award Amount:</span>
                                                    <span class="font-medium text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.award_amount ? '$' + Number(selectedOpportunity.award_amount).toLocaleString() : 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Min Revenue Req:</span>
                                                    <span class="text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.min_revenue_requirement || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Org Revenue:</span>
                                                    <span class="text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.financial_data?.total_revenue ? '$' + Number(selectedOpportunity.financial_data.total_revenue).toLocaleString() : 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Assets:</span>
                                                    <span class="text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.financial_data?.total_assets ? '$' + Number(selectedOpportunity.financial_data.total_assets).toLocaleString() : 'Data not available'"></span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Location & Classification -->
                                        <div>
                                            <h6 class="font-medium text-gray-900 dark:text-white mb-3">Location & Classification</h6>
                                            <div class="space-y-2 text-sm">
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">State:</span>
                                                    <span class="font-medium text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.external_data?.state || selectedOpportunity?.state || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">City:</span>
                                                    <span class="text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.external_data?.city || selectedOpportunity?.city || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">NTEE Code:</span>
                                                    <span class="font-mono text-xs text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.external_data?.ntee_code || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">EIN:</span>
                                                    <span class="font-mono text-xs text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.ein || selectedOpportunity?.external_data?.ein || 'Data not available'"></span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Timeline & Requirements -->
                                        <div>
                                            <h6 class="font-medium text-gray-900 dark:text-white mb-3">Timeline & Requirements</h6>
                                            <div class="space-y-2 text-sm">
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Application Deadline:</span>
                                                    <span class="text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.application_deadline ? new Date(selectedOpportunity.application_deadline).toLocaleDateString() : 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Project Duration:</span>
                                                    <span class="text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.project_duration || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Matching Requirement:</span>
                                                    <span class="text-right text-gray-900 dark:text-white" x-text="selectedOpportunity?.matching_requirement || 'Data not available'"></span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600 dark:text-gray-400">Last Updated:</span>
                                                    <span class="text-right text-xs text-gray-900 dark:text-white" x-text="selectedOpportunity?.updated_at ? new Date(selectedOpportunity.updated_at).toLocaleDateString() : 'Data not available'"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- User Comments Section -->
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 mb-4">
                                    <h5 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                        <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>
                                        Notes & Comments
                                    </h5>
                                    
                                    <div class="space-y-4" x-show="selectedOpportunity">
                                        <!-- Comment Input -->
                                        <div>
                                            <label for="opportunity-comments" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                Add your notes, observations, or action items for this opportunity:
                                            </label>
                                            <textarea id="opportunity-comments" 
                                                      :value="selectedOpportunity?.user_comments || ''"
                                                      @input="updateUserComments($event.target.value); saveOpportunityComments()"
                                                      rows="4"
                                                      placeholder="Add notes about this opportunity... e.g., why it's a good fit, concerns, next steps, contact information, etc."
                                                      class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-y min-h-[100px]"></textarea>
                                        </div>
                                        
                                        <!-- Comments Display Info -->
                                        <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                                            <span>Comments are automatically saved as you type</span>
                                            <span x-show="selectedOpportunity?.user_comments && (selectedOpportunity.user_comments?.length || 0) > 0" 
                                                  x-text="(selectedOpportunity?.user_comments?.length || 0) + ' characters'"></span>
                                        </div>
                                        
                                        <!-- Sample/Helpful Prompts -->
                                        <div x-show="!selectedOpportunity?.user_comments || (selectedOpportunity.user_comments && selectedOpportunity.user_comments.trim() === '')" 
                                             class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                                            <h6 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">üí° Suggested notes to include:</h6>
                                            <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                                                <li>‚Ä¢ Why this opportunity aligns with your organization's mission</li>
                                                <li>‚Ä¢ Specific concerns or risks to consider</li>
                                                <li>‚Ä¢ Key contacts or relationships that could help</li>
                                                <li>‚Ä¢ Action items or next steps needed</li>
                                                <li>‚Ä¢ Timeline considerations or deadline reminders</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                </div> <!-- End Data Available State -->
                                
                                <!-- Ready to Process State -->
                                <div x-show="!_hasTabData(selectedOpportunity, 'discover')" class="text-center py-8">
                                    <div class="flex flex-col items-center space-y-4">
                                        <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center">
                                            <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h5 class="text-lg font-semibold text-green-900 dark:text-green-100 mb-2">Ready for Discovery Analysis</h5>
                                            <p class="text-sm text-green-700 dark:text-green-300 max-w-md mx-auto">
                                                This opportunity is ready to be analyzed for government scoring, eligibility assessment, and strategic fit evaluation.
                                            </p>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs text-green-600 dark:text-green-400">
                                            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                            <span>Stage: <span x-text="selectedOpportunity?.current_stage || selectedOpportunity?.stage || 'Unknown'"></span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PLAN Results Tab -->
                        <div x-show="modalActiveTab === 'plan'" class="space-y-4">
                            <!-- AI Lite Analysis -->
                            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800 p-4">
                                <h4 class="text-lg font-bold text-yellow-900 dark:text-yellow-100 mb-3">AI Strategic Analysis</h4>
                                
                                <!-- Priority & Category -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div class="bg-white dark:bg-gray-800 rounded p-3">
                                        <h5 class="font-medium text-gray-900 dark:text-white text-sm mb-2">Strategic Category</h5>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium">Funding Source</span>
                                        </div>
                                    </div>
                                    <div class="bg-white dark:bg-gray-800 rounded p-3">
                                        <h5 class="font-medium text-gray-900 dark:text-white text-sm mb-2">Priority Level</h5>
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100">
                                            High Priority
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Next Steps -->
                                <div class="bg-blue-50 dark:bg-blue-900/20 rounded p-3">
                                    <h5 class="font-medium text-blue-800 dark:text-blue-200 text-sm mb-2">Next Steps</h5>
                                    <ul class="text-xs text-blue-700 dark:text-blue-300 space-y-1">
                                        <li>1. Review application requirements</li>
                                        <li>2. Prepare supporting documentation</li>
                                        <li>3. Submit letter of intent</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ANALYZE Results Tab -->
                        <div x-show="modalActiveTab === 'analyze'" class="space-y-4">
                            <!-- Network Analysis -->
                            <div class="bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-lg border border-purple-200 dark:border-purple-800 p-4">
                                <h4 class="text-lg font-bold text-orange-900 dark:text-orange-100 mb-3">Network Analysis</h4>
                                
                                <!-- Data Available State -->
                                <div x-show="_hasTabData(selectedOpportunity, 'analyze')" class="space-y-4">
                                
                                <!-- Network Stats -->
                                <div class="grid grid-cols-3 gap-3 mb-4">
                                    <div class="text-center bg-white dark:bg-gray-800 rounded p-3">
                                        <div class="text-lg font-bold text-orange-600 dark:text-orange-400">3</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Board Connections</div>
                                    </div>
                                    <div class="text-center bg-white dark:bg-gray-800 rounded p-3">
                                        <div class="text-lg font-bold text-blue-600 dark:text-blue-400">85%</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Success Rate</div>
                                    </div>
                                    <div class="text-center bg-white dark:bg-gray-800 rounded p-3">
                                        <div class="text-lg font-bold text-green-600 dark:text-green-400">High</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Network Score</div>
                                    </div>
                                </div>
                                
                                <!-- Key Insights -->
                                <div class="bg-orange-100 dark:bg-orange-900/30 rounded p-3">
                                    <h5 class="font-medium text-orange-800 dark:text-orange-200 text-sm mb-2">Key Insights</h5>
                                    <ul class="text-xs text-orange-700 dark:text-orange-300 space-y-1">
                                        <li>‚Ä¢ Strong board connections provide access</li>
                                        <li>‚Ä¢ Historical success with similar orgs</li>
                                        <li>‚Ä¢ Strategic timing advantage</li>
                                    </ul>
                                </div>
                                </div> <!-- End Data Available State -->
                                
                                <!-- Ready to Process State -->
                                <div x-show="!_hasTabData(selectedOpportunity, 'analyze')" class="text-center py-8">
                                    <div class="flex flex-col items-center space-y-4">
                                        <div class="w-16 h-16 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center">
                                            <svg class="w-8 h-8 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h5 class="text-lg font-semibold text-orange-900 dark:text-orange-100 mb-2">Ready for Network Analysis</h5>
                                            <p class="text-sm text-orange-700 dark:text-orange-300 max-w-md mx-auto">
                                                This opportunity is ready for board network analysis, relationship mapping, and strategic connection assessment.
                                            </p>
                                        </div>
                                        <div x-show="_isCandidateStage(selectedOpportunity)" class="bg-orange-100 dark:bg-orange-900/30 rounded-lg p-3 max-w-sm">
                                            <div class="flex items-center space-x-2 text-sm text-orange-800 dark:text-orange-200">
                                                <span class="font-bold">CANDIDATE STAGE ACTIVE</span>
                                                <span class="font-medium">CANDIDATE STAGE ACTIVE</span>
                                            </div>
                                            <p class="text-xs text-orange-700 dark:text-orange-300 mt-1">
                                                Advanced network analysis and strategic relationship intelligence available.
                                            </p>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs text-orange-600 dark:text-orange-400">
                                            <span class="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></span>
                                            <span>Stage: <span x-text="selectedOpportunity?.current_stage || selectedOpportunity?.stage || 'Unknown'"></span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- EXAMINE Results Tab - AI Heavy Dossier Builder -->
                        <div x-show="modalActiveTab === 'examine'" class="space-y-4">
                            <!-- AI Heavy Dossier Builder Interface -->
                            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-lg border border-blue-200 dark:border-blue-800 p-4">
                                <h4 class="text-lg font-bold text-blue-900 dark:text-blue-100 mb-3">AI Heavy Dossier Builder</h4>
                                
                                <!-- Data Available State -->
                                <div x-show="_hasTabData(selectedOpportunity, 'examine')" class="space-y-4">
                                
                                <!-- Executive Decision Brief -->
                                <div class="bg-white dark:bg-gray-800 rounded p-4 mb-4">
                                    <h5 class="font-medium text-gray-900 dark:text-white text-sm mb-2">Executive Decision Brief</h5>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Confidence Score:</span>
                                            <span class="text-sm font-bold text-green-600 dark:text-green-400">87%</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Success Probability:</span>
                                            <span class="text-sm font-bold text-blue-600 dark:text-blue-400">72%</span>
                                        </div>
                                        <div class="bg-green-50 dark:bg-green-900/20 rounded p-3">
                                            <span class="text-sm font-medium text-green-800 dark:text-green-200">Recommendation: PURSUE</span>
                                            <p class="text-xs text-green-700 dark:text-green-300 mt-1">
                                                High-value opportunity with strong strategic alignment. Network connections provide competitive advantage.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Implementation Blueprint -->
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded p-3 mb-4">
                                    <h5 class="font-medium text-blue-800 dark:text-blue-200 text-sm mb-2">Implementation Blueprint</h5>
                                    <div class="space-y-2">
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">1</span>
                                            <span class="text-blue-700 dark:text-blue-300">Initial relationship mapping (Week 1)</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">2</span>
                                            <span class="text-blue-700 dark:text-blue-300">Strategic outreach via board connections (Week 2-3)</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">3</span>
                                            <span class="text-blue-700 dark:text-blue-300">Proposal development & submission (Week 4-8)</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Relationship Intelligence -->
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded p-3 mb-4">
                                    <h5 class="font-medium text-purple-800 dark:text-purple-200 text-sm mb-2">Relationship Intelligence</h5>
                                    <div class="space-y-2">
                                        <div class="text-xs text-purple-700 dark:text-purple-300">
                                            <span class="font-medium">2 Board Connections:</span> Direct pathway through shared directors
                                        </div>
                                        <div class="text-xs text-purple-700 dark:text-purple-300">
                                            <span class="font-medium">Network Strength:</span> Strong (3rd degree connections)
                                        </div>
                                        <div class="text-xs text-purple-700 dark:text-purple-300">
                                            <span class="font-medium">Engagement Strategy:</span> Warm introduction via mutual connections
                                        </div>
                                    </div>
                                </div>

                                <!-- Document Generation Actions -->
                                <div class="border-t border-blue-200 dark:border-blue-700 pt-4">
                                    <h5 class="font-medium text-blue-800 dark:text-blue-200 text-sm mb-3">Generate Decision Documents</h5>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button @click="generateDossierDocument('executive_brief')" 
                                                class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded transition-colors">
                                            Executive Brief
                                        </button>
                                        <button @click="generateDossierDocument('detailed_report')" 
                                                class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded transition-colors">
                                            Detailed Report
                                        </button>
                                        <button @click="generateDossierDocument('presentation')" 
                                                class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded transition-colors">
                                            Presentation
                                        </button>
                                        <button @click="generateDossierDocument('compliance_report')" 
                                                class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded transition-colors">
                                            Compliance Report
                                        </button>
                                    </div>
                                </div>
                                </div> <!-- End Data Available State -->
                                
                                <!-- Ready to Process State -->
                                <div x-show="!_hasTabData(selectedOpportunity, 'examine')" class="text-center py-8">
                                    <div class="flex flex-col items-center space-y-4">
                                        <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center">
                                            <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h5 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2">Ready for AI Heavy Dossier</h5>
                                            <p class="text-sm text-blue-700 dark:text-blue-300 max-w-md mx-auto">
                                                Generate comprehensive decision-ready dossiers with executive briefs, implementation blueprints, and relationship intelligence.
                                            </p>
                                        </div>
                                        <div x-show="_isTargetsStage(selectedOpportunity)" class="bg-gradient-to-r from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30 rounded-lg p-4 max-w-sm border-2 border-blue-200 dark:border-blue-700">
                                            <div class="flex items-center space-x-3 text-sm text-blue-800 dark:text-blue-200 mb-2">
                                                <span class="font-bold">AI HEAVY DOSSIER AVAILABLE</span>
                                            </div>
                                            <p class="text-xs text-blue-700 dark:text-blue-300">
                                                Generate comprehensive dossiers with executive decision briefs, implementation blueprints, relationship intelligence, and decision-ready documents.
                                            </p>
                                        </div>
                                        <button @click="generateComprehensiveDossier(selectedOpportunity)" 
                                                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors">
                                            Generate AI Heavy Dossier
                                        </button>
                                        <div class="flex items-center space-x-2 text-xs text-blue-600 dark:text-blue-400">
                                            <span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
                                            <span>Stage: <span x-text="selectedOpportunity?.current_stage || selectedOpportunity?.stage || 'Unknown'"></span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- APPROACH Results Tab -->
                        <div x-show="modalActiveTab === 'approach'" class="space-y-4">
                            <!-- Strategic Approach Analysis -->
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg border border-green-200 dark:border-green-800 p-4">
                                <h4 class="text-lg font-bold text-green-900 dark:text-green-100 mb-3">Strategic Approach Planning</h4>
                                
                                <!-- Data Available State -->
                                <div x-show="_hasTabData(selectedOpportunity, 'approach')" class="space-y-4">
                                
                                <!-- Strategic Positioning -->
                                <div class="bg-white dark:bg-gray-800 rounded p-4 mb-4">
                                    <h5 class="font-medium text-gray-900 dark:text-white text-sm mb-2">Strategic Positioning</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">
                                        This opportunity is positioned as a high-priority target with optimal alignment across all key dimensions. 
                                        Strategic approach focuses on competitive differentiation and relationship leverage.
                                    </p>
                                </div>
                                
                                <!-- Competitive Analysis -->
                                <div class="bg-orange-100 dark:bg-orange-900/30 rounded p-3 mb-4">
                                    <h5 class="font-medium text-orange-800 dark:text-orange-200 text-sm mb-2">Competitive Landscape</h5>
                                    <div class="space-y-2">
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-orange-600 text-white rounded-full flex items-center justify-center text-xs">1</span>
                                            <span class="text-orange-700 dark:text-orange-300">Estimated 15-25 qualified applicants</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-orange-600 text-white rounded-full flex items-center justify-center text-xs">2</span>
                                            <span class="text-orange-700 dark:text-orange-300">Strong regional positioning advantage</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-orange-600 text-white rounded-full flex items-center justify-center text-xs">3</span>
                                            <span class="text-orange-700 dark:text-orange-300">Network connections provide strategic edge</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Implementation Strategy -->
                                <div class="bg-amber-100 dark:bg-amber-900/30 rounded p-3">
                                    <h5 class="font-medium text-amber-800 dark:text-amber-200 text-sm mb-2">Implementation Strategy</h5>
                                    <div class="space-y-2">
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-amber-600 text-white rounded-full flex items-center justify-center text-xs">A</span>
                                            <span class="text-amber-700 dark:text-amber-300">Pre-application stakeholder engagement</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-amber-600 text-white rounded-full flex items-center justify-center text-xs">B</span>
                                            <span class="text-amber-700 dark:text-amber-300">Proposal development with expert input</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs">
                                            <span class="w-4 h-4 bg-amber-600 text-white rounded-full flex items-center justify-center text-xs">C</span>
                                            <span class="text-amber-700 dark:text-amber-300">Strategic timing and submission optimization</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Decision Synthesis Section -->
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded p-3 mt-4">
                                    <h5 class="font-medium text-blue-800 dark:text-blue-200 text-sm mb-3">AI Decision Synthesis</h5>
                                    <p class="text-xs text-blue-700 dark:text-blue-300 mb-3">
                                        Generate comprehensive decision analysis using Phase 6 AI synthesis framework
                                    </p>
                                    <button @click="synthesizeDecision(selectedOpportunity)"
                                            :disabled="!selectedProfile || isProcessing"
                                            class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                        </svg>
                                        Generate Decision Synthesis
                                    </button>
                                </div>
                                </div> <!-- End Data Available State -->
                                
                                <!-- Waiting for Previous Stage State -->
                                <div x-show="!_hasTabData(selectedOpportunity, 'approach')" class="text-center py-8">
                                    <div class="flex flex-col items-center space-y-4">
                                        <div class="w-16 h-16 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center">
                                            <svg class="w-8 h-8 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h5 class="text-lg font-semibold text-orange-900 dark:text-orange-100 mb-2">Strategic Approach Development</h5>
                                            <p class="text-sm text-orange-700 dark:text-orange-300 max-w-md mx-auto">
                                                Advanced strategic approach planning becomes available once the opportunity reaches the final opportunity stage.
                                            </p>
                                        </div>
                                        <div x-show="_isOpportunitiesStage(selectedOpportunity)" class="bg-gradient-to-r from-orange-100 to-amber-100 dark:from-orange-900/30 dark:to-amber-900/30 rounded-lg p-4 max-w-sm border-2 border-orange-200 dark:border-orange-700">
                                            <div class="flex items-center space-x-3 text-sm text-orange-800 dark:text-orange-200 mb-2">
                                                <span class="font-bold">OPPORTUNITY STAGE ACTIVE</span>
                                            </div>
                                            <p class="text-xs text-orange-700 dark:text-orange-300">
                                                This opportunity has reached the final opportunity stage. Strategic approach planning, competitive analysis, and implementation strategies are now available.
                                            </p>
                                        </div>
                                        <div x-show="!_isOpportunitiesStage(selectedOpportunity)" class="bg-gradient-to-r from-gray-100 to-slate-100 dark:from-gray-800/30 dark:to-slate-800/30 rounded-lg p-4 max-w-sm border-2 border-gray-200 dark:border-gray-700">
                                            <div class="flex items-center space-x-3 text-sm text-gray-800 dark:text-gray-200 mb-2">
                                                <span class="font-bold">WAITING FOR OPPORTUNITY STAGE</span>
                                            </div>
                                            <p class="text-xs text-gray-700 dark:text-gray-300">
                                                Strategic approach planning will be available once this opportunity advances through all previous stages and reaches the opportunity stage.
                                            </p>
                                        </div>
                                        <div class="flex items-center space-x-2 text-xs text-orange-600 dark:text-orange-400">
                                            <span class="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></span>
                                            <span>Stage: <span x-text="selectedOpportunity?.current_stage || selectedOpportunity?.stage || 'Unknown'"></span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Actions -->
                <div class="bg-gray-50 dark:bg-gray-700 px-6 py-4 flex flex-col sm:flex-row sm:justify-between items-center space-y-4 sm:space-y-0">
                    <div class="flex flex-wrap justify-center sm:justify-start gap-3">
                        <!-- Manual Promote Button -->
                        <button @click="showPromoteConfirmation(selectedOpportunity)"
                                :disabled="isProcessing || (selectedOpportunity?.funnel_stage || selectedOpportunity?.stage) === 'opportunities'"
                                :class="canPromote(selectedOpportunity) ? 
                                    'inline-flex items-center px-6 py-2.5 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm ring-2 ring-green-300' : 
                                    'inline-flex items-center px-6 py-2.5 border border-transparent text-sm font-medium rounded-md text-white bg-gray-400 hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm'"
                                class="inline-flex items-center px-6 py-2.5 border border-transparent text-sm font-medium rounded-md text-white transition-colors shadow-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5-5 5M6 12h12"></path>
                            </svg>
                            <span x-show="!isProcessing">Promote</span>
                            <span x-show="isProcessing">Processing...</span>
                        </button>
                        
                        <!-- Manual Demote Button -->
                        <button @click="showDemoteConfirmation(selectedOpportunity)"
                                :disabled="isProcessing || !canDemote(selectedOpportunity)"
                                :class="canDemote(selectedOpportunity) ? 
                                    'inline-flex items-center px-6 py-2.5 border border-orange-300 dark:border-orange-600 text-sm font-medium rounded-md text-orange-700 dark:text-orange-300 bg-orange-50 dark:bg-orange-900/20 hover:bg-orange-100 dark:hover:bg-orange-900/40 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm ring-2 ring-orange-300' : 
                                    'inline-flex items-center px-6 py-2.5 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm'"
                                class="inline-flex items-center px-6 py-2.5 border text-sm font-medium rounded-md transition-colors shadow-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5 5-5m6 10H6"></path>
                            </svg>
                            <span x-show="!isProcessing">Demote</span>
                            <span x-show="isProcessing">Processing...</span>
                        </button>
                        
                        <!-- Re-score Button -->
                        <button @click="rescoreOpportunity(selectedOpportunity)"
                                :disabled="isProcessing"
                                class="inline-flex items-center px-6 py-2.5 border border-blue-300 dark:border-blue-600 text-sm font-medium rounded-md text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/40 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            <span x-show="!isProcessing">Re-calculate</span>
                            <span x-show="isProcessing" class="flex items-center">
                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-blue-600" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                Re-calculating...
                            </span>
                        </button>
                        
                        <!-- Phase 6 Comprehensive Export Button -->
                        <button @click="openExportDialog(selectedOpportunity)"
                                :disabled="isProcessing || !selectedProfile"
                                class="inline-flex items-center px-6 py-2.5 border border-purple-300 dark:border-purple-600 text-sm font-medium rounded-md text-purple-700 dark:text-purple-300 bg-purple-50 dark:bg-purple-900/20 hover:bg-purple-100 dark:hover:bg-purple-900/40 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Export
                        </button>
                    </div>
                    
                    <!-- Modal Footer with Actions -->
                    <div class="flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700">
                        <!-- Delete Button (Left Side) -->
                        <button @click="confirmDeleteOpportunity(selectedOpportunity)" 
                                class="flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors font-medium"
                                aria-label="Delete this opportunity permanently"
                                title="Delete this opportunity permanently">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                            <span>Delete Opportunity</span>
                        </button>
                        
                        <!-- Close Button (Right Side) -->
                        <button @click="closeOpportunityModal()" 
                                class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Opportunity Details Modal -->
    
    <!-- Delete Confirmation Modal -->
    <div x-show="showDeleteConfirmModal" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto"
         role="dialog"
         aria-modal="true"
         aria-labelledby="delete-modal-title"
         aria-describedby="delete-modal-description"
         @keydown.escape.window="cancelDeleteOpportunity()">
        
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" 
                 @click="cancelDeleteOpportunity()"></div>
            
            <!-- Modal positioning helper -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>
            
            <!-- Confirmation dialog -->
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <!-- Header -->
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <!-- Warning Icon -->
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900 sm:mx-0 sm:h-10 sm:w-10">
                            <svg class="h-6 w-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L4.316 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        
                        <!-- Content -->
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 id="delete-modal-title" class="text-lg leading-6 font-medium text-gray-900 dark:text-white">
                                Delete Opportunity
                            </h3>
                            <div class="mt-2">
                                <p id="delete-modal-description" class="text-sm text-gray-500 dark:text-gray-400">
                                    Are you sure you want to delete 
                                    <span class="font-semibold text-gray-900 dark:text-white" x-text="opportunityToDelete?.organization_name || 'this opportunity'"></span>?
                                    This action cannot be undone.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Verification Step (shown after first confirmation) -->
                <div x-show="deleteVerificationStep" class="bg-yellow-50 dark:bg-yellow-900 px-4 py-3 border-t border-yellow-200 dark:border-yellow-700">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-800 dark:text-yellow-200 font-medium">
                                Verify this decision: This will permanently remove all data associated with this opportunity.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Action buttons -->
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <!-- Delete button (changes after verification step) -->
                    <button x-show="!deleteVerificationStep"
                            @click="proceedToVerification()"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Delete
                    </button>
                    
                    <!-- Final confirmation button -->
                    <button x-show="deleteVerificationStep"
                            @click="executeDeleteOpportunity()"
                            :disabled="deletingOpportunity"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-800 text-base font-medium text-white hover:bg-red-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        <span x-show="!deletingOpportunity">Confirm Delete</span>
                        <span x-show="deletingOpportunity" class="flex items-center">
                            <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Deleting...
                        </span>
                    </button>
                    
                    <!-- Cancel button -->
                    <button @click="cancelDeleteOpportunity()"
                            :disabled="deletingOpportunity"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-500 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End Delete Confirmation Modal -->
    
    <!-- Stage Change Confirmation Modal -->
    <div x-show="showStageChangeModal" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto"
         role="dialog"
         aria-modal="true"
         @keydown.escape.window="cancelStageChange()">
        
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" 
                 @click="cancelStageChange()"></div>
            
            <!-- Modal positioning helper -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>
            
            <!-- Confirmation dialog -->
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <!-- Header -->
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <!-- Icon -->
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full sm:mx-0 sm:h-10 sm:w-10"
                             :class="stageChangeAction === 'promote' ? 'bg-green-100 dark:bg-green-900' : 'bg-orange-100 dark:bg-orange-900'">
                            <svg class="h-6 w-6"
                                 :class="stageChangeAction === 'promote' ? 'text-green-600 dark:text-green-400' : 'text-orange-600 dark:text-orange-400'"
                                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path x-show="stageChangeAction === 'promote'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5-5 5M6 12h12" />
                                <path x-show="stageChangeAction === 'demote'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5 5-5m6 10H6" />
                            </svg>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">
                                <span x-show="stageChangeAction === 'promote'">Promote Opportunity</span>
                                <span x-show="stageChangeAction === 'demote'">Demote Opportunity</span>
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    Are you sure you want to 
                                    <span x-show="stageChangeAction === 'promote'" class="font-medium text-green-600 dark:text-green-400">promote</span>
                                    <span x-show="stageChangeAction === 'demote'" class="font-medium text-orange-600 dark:text-orange-400">demote</span>
                                    <span class="font-medium" x-text="stageChangeOpportunity?.organization_name"></span>
                                    from <span class="font-medium" x-text="stageChangeFromStage"></span> to <span class="font-medium" x-text="stageChangeToStage"></span>?
                                </p>
                                
                                <!-- Comment/Reason Field -->
                                <div class="mt-4">
                                    <label for="stage-change-reason" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Reason for change (optional)
                                    </label>
                                    <textarea id="stage-change-reason" 
                                              x-model="stageChangeReason"
                                              rows="3"
                                              placeholder="Explain why you are making this stage change..."
                                              class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="confirmStageChange()"
                            :disabled="isProcessing"
                            :class="stageChangeAction === 'promote' ? 
                                'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50' :
                                'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-600 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50'"
                            class="disabled:cursor-not-allowed">
                        <span x-show="!isProcessing">
                            <span x-show="stageChangeAction === 'promote'">Confirm Promote</span>
                            <span x-show="stageChangeAction === 'demote'">Confirm Demote</span>
                        </span>
                        <span x-show="isProcessing">Processing...</span>
                    </button>
                    <button @click="cancelStageChange()"
                            :disabled="isProcessing"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End Stage Change Confirmation Modal -->
    
    
    <!-- Profile Creation/Edit Modal -->
    <div x-show="showProfileModal" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto">
        
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
             @click="showProfileModal = false"></div>

        <!-- Modal content -->
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-4 sm:p-0">
            <div x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full sm:p-6">
                
                <!-- Modal Header -->
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">
                        <span x-text="isEditingProfile ? 'Edit Organization Profile' : 'Create Organization Profile'"></span>
                    </h3>
                    <button @click="saveModalData(); showProfileModal = false"
                            class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300">
                        <span class="text-2xl">&times;</span>
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="mt-3">

                    <!-- Profile Form -->
                    <form @submit.prevent="saveProfile()" class="space-y-6">

                    <!-- Tab Navigation -->
                    <div class="border-b-2 border-gray-300 dark:border-gray-600 mb-6">
                        <nav class="-mb-0.5 flex space-x-1">
                            <button type="button"
                                    @click="profileModalActiveTab = 'basic'"
                                    :class="profileModalActiveTab === 'basic' ? 'bg-purple-100 border-purple-500 text-purple-700 dark:bg-purple-900 dark:border-purple-400 dark:text-purple-300' : 'bg-gray-100 border-gray-300 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 hover:text-gray-800 dark:hover:text-gray-200'"
                                    class="px-4 py-3 border-2 border-b-0 rounded-t-lg font-semibold text-sm transition-all shadow-sm">
                                Basic Information
                            </button>
                            <button type="button"
                                    @click="profileModalActiveTab = 'ntee'"
                                    :class="profileModalActiveTab === 'ntee' ? 'bg-purple-100 border-purple-500 text-purple-700 dark:bg-purple-900 dark:border-purple-400 dark:text-purple-300' : 'bg-gray-100 border-gray-300 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 hover:text-gray-800 dark:hover:text-gray-200'"
                                    class="px-4 py-3 border-2 border-b-0 rounded-t-lg font-semibold text-sm transition-all shadow-sm">
                                NTEE Codes
                            </button>
                            <button type="button"
                                    @click="profileModalActiveTab = 'government'"
                                    :class="profileModalActiveTab === 'government' ? 'bg-purple-100 border-purple-500 text-purple-700 dark:bg-purple-900 dark:border-purple-400 dark:text-purple-300' : 'bg-gray-100 border-gray-300 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 hover:text-gray-800 dark:hover:text-gray-200'"
                                    class="px-4 py-3 border-2 border-b-0 rounded-t-lg font-semibold text-sm transition-all shadow-sm">
                                Government Criteria
                            </button>
                            <button type="button"
                                    @click="profileModalActiveTab = 'tax-filing'"
                                    :class="profileModalActiveTab === 'tax-filing' ? 'bg-purple-100 border-purple-500 text-purple-700 dark:bg-purple-900 dark:border-purple-400 dark:text-purple-300' : 'bg-gray-100 border-gray-300 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 hover:text-gray-800 dark:hover:text-gray-200'"
                                    class="px-4 py-3 border-2 border-b-0 rounded-t-lg font-semibold text-sm transition-all shadow-sm">
                                Tax Filing Data
                                <span x-show="webScrapingResults?.verified_leadership?.length > 0"
                                      class="ml-1 inline-flex items-center justify-center w-4 h-4 text-xs font-bold text-white bg-blue-500 rounded-full">
                                    <span x-text="webScrapingResults?.verified_leadership?.length || 0"></span>
                                </span>
                            </button>
                            <button type="button"
                                    @click="profileModalActiveTab = 'web-search'"
                                    :class="profileModalActiveTab === 'web-search' ? 'bg-purple-100 border-purple-500 text-purple-700 dark:bg-purple-900 dark:border-purple-400 dark:text-purple-300' : 'bg-gray-100 border-gray-300 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 hover:text-gray-800 dark:hover:text-gray-200'"
                                    class="px-4 py-3 border-2 border-b-0 rounded-t-lg font-semibold text-sm transition-all shadow-sm">
                                Web Search Data
                                <span x-show="webScrapingResults && webScrapingResults.successful_scrapes && webScrapingResults.successful_scrapes.length > 0"
                                      class="ml-1 inline-flex items-center justify-center w-4 h-4 text-xs font-bold text-white bg-purple-500 rounded-full">
                                    <span x-text="webScrapingResults?.successful_scrapes?.length || 0"></span>
                                </span>
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="mt-6">
                        
                        <!-- Basic Information Tab -->
                        <div x-show="profileModalActiveTab === 'basic'" class="p-2">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                                <!-- Header Section -->
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Basic Information</h4>
                                    <button type="button" @click="fetchEINData()"
                                            :disabled="!profileForm.ein || einFetchLoading"
                                            :class="!profileForm.ein || einFetchLoading ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'"
                                            class="px-4 py-2 bg-blue-600 text-white rounded text-sm font-medium transition-colors">
                                        <span x-show="!einFetchLoading">Fetch</span>
                                        <span x-show="einFetchLoading">Fetching...</span>
                                    </button>
                                </div>

                                <!-- Fields stacked vertically -->
                                <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Organization Name *</label>
                                    <input type="text" 
                                           x-model="profileForm.name"
                                           required
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"
                                           placeholder="Enter organization name">
                                </div>
                                <!-- EIN and Schedule I Status Row -->
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">EIN (Tax ID) *</label>
                                        <input type="text" 
                                               x-model="profileForm.ein"
                                               pattern="^\d{2}-?\d{7}$"
                                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"
                                               placeholder="12-3456789">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Schedule I Status</label>
                                        <div class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 text-sm h-[38px] flex items-center">
                                            <template x-if="!profileForm.schedule_i_grantees && !profileForm.schedule_i_status">
                                                <span class="text-gray-500 dark:text-gray-400 text-xs">Not checked</span>
                                            </template>
                                            <template x-if="profileForm.schedule_i_status === 'no_xml'">
                                                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300">
                                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L5.636 5.636"></path>
                                                    </svg>
                                                    No XML Data
                                                </span>
                                            </template>
                                            <template x-if="profileForm.schedule_i_status === 'no_grantees'">
                                                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-700 dark:bg-yellow-800 dark:text-yellow-200">
                                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.865-.833-2.635 0L4.179 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                                    </svg>
                                                    No Grantees
                                                </span>
                                            </template>
                                            <template x-if="profileForm.schedule_i_grantees && profileForm.schedule_i_grantees.length > 0">
                                                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 text-green-700 dark:bg-green-800 dark:text-green-200">
                                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                    <span x-text="profileForm.schedule_i_grantees.length"></span> Grantees
                                                </span>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Organization Website
                                        <span class="text-xs text-gray-500 dark:text-gray-400">(Primary URL source)</span>
                                    </label>
                                    <input type="url" x-model="profileForm.website_url"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"
                                           placeholder="https://www.organization.org">
                                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                                        Providing the official website improves data accuracy and reduces scraping errors.
                                    </p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Organization Type</label>
                                    <select x-model="profileForm.organization_type" 
                                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm">
                                        <option value="">Select type...</option>
                                        <option value="nonprofit">Nonprofit</option>
                                        <option value="for_profit">For-Profit</option>
                                        <option value="government">Government</option>
                                        <option value="academic">Academic</option>
                                        <option value="healthcare">Healthcare</option>
                                        <option value="foundation">Foundation</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Mission Statement
                                    </label>
                                    <textarea x-model="profileForm.mission_statement"
                                              rows="3"
                                              class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"
                                              placeholder="Describe your organization's mission and purpose"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Keywords</label>
                                    <textarea x-model="profileForm.keywords"
                                              @input="markFieldAsUserEdited('keywords')"
                                              rows="3"
                                              class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"
                                              placeholder="Key terms and phrases that describe your work"></textarea>
                                </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- NTEE Codes Tab -->
                        <div x-show="profileModalActiveTab === 'ntee'" class="p-2">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 flex flex-col h-full">
                                <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">NTEE Codes</h4>
                            </div>
                            
                            <button type="button" @click="openNteeModal()"
                                    class="w-full px-4 py-2 mb-4 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white rounded-md transition-colors text-sm">
                                Select NTEE Codes
                            </button>
                            
                            <!-- Scrollable Selected Codes Table -->
                            <div class="flex-1 border border-gray-200 dark:border-gray-600 rounded-md flex flex-col">
                                <div class="bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-600">
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white">Selected Codes</h5>
                                </div>
                                <div class="p-4 flex-1 overflow-y-auto">
                                    <div x-show="nteeModal.selectedNteeCodes.length === 0" class="text-sm text-gray-500 dark:text-gray-400 text-center">
                                        No NTEE codes selected
                                    </div>
                                    <div x-show="nteeModal.selectedNteeCodes.length > 0" class="space-y-1">
                                        <template x-for="codeInfo in getSelectedNteeCodesInfo()" :key="codeInfo.code">
                                            <div class="flex items-center justify-between p-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded text-sm">
                                                <div class="flex items-center space-x-2 flex-1">
                                                    <span class="font-medium text-gray-900 dark:text-white" x-text="codeInfo.code"></span>
                                                    <span class="text-gray-600 dark:text-gray-300 text-sm truncate" x-text="codeInfo.name"></span>
                                                </div>
                                                <button @click="removeNteeCode(codeInfo.code)"
                                                        class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 ml-2 flex-shrink-0">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                        
                        <!-- Government Criteria Tab -->
                        <div x-show="profileModalActiveTab === 'government'" class="p-2">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 flex flex-col h-full">
                                <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Government Criteria</h4>
                            </div>
                            
                            <button type="button" @click="openGovernmentCriteriaModal()"
                                    class="w-full px-4 py-2 mb-4 bg-purple-600 hover:bg-purple-700 text-white rounded-md text-sm font-medium transition-colors">
                                Select Criteria
                            </button>
                            
                            <!-- Scrollable Selected Criteria Table -->
                            <div class="flex-1 border border-gray-200 dark:border-gray-600 rounded-md">
                                <div class="bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-600">
                                    <h5 class="text-sm font-medium text-gray-900 dark:text-white">Selected Criteria</h5>
                                </div>
                                <div class="p-4 flex-1 overflow-y-auto">
                                    <!-- Show message when no criteria selected -->
                                    <div x-show="getSelectedGovernmentCriteriaInfo().length === 0" 
                                         class="text-sm text-gray-500 dark:text-gray-400 text-center">
                                        No government criteria selected
                                    </div>
                                    
                                    <!-- Show selected criteria -->
                                    <div x-show="getSelectedGovernmentCriteriaInfo().length > 0" class="space-y-1">
                                        <template x-for="criteria in getSelectedGovernmentCriteriaInfo()" :key="criteria.id">
                                            <div class="flex items-center justify-between p-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded text-sm">
                                                <div class="flex items-center space-x-2 flex-1 min-w-0">
                                                    <span class="font-medium text-gray-900 dark:text-white text-xs" x-text="criteria.category.split(' ')[0]"></span>
                                                    <span class="text-gray-600 dark:text-gray-300 text-sm truncate" x-text="criteria.name"></span>
                                                </div>
                                                <!-- Source badges - right justified on same line -->
                                                <div class="flex gap-1 ml-2">
                                                    <template x-for="source in criteria.sources" :key="source">
                                                        <span :class="source === 'Federal' ? 'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-200' : 
                                                                       source === 'State' ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200' : 
                                                                       'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-200'"
                                                              class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium" 
                                                              x-text="source">
                                                        </span>
                                                    </template>
                                                </div>
                                                <button @click="removeGovernmentCriteria(criteria.id)" 
                                                        class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 ml-2 flex-shrink-0">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                        
                        <!-- Tax Filing Data Tab -->
                        <div x-show="profileModalActiveTab === 'tax-filing'" class="p-2">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 flex flex-col h-full">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Tax Filing Data</h4>
                                    <div class="text-right">
                                        <!-- Source Breakdown Display -->
                                        <div x-show="webScrapingResults?.verified_leadership?.length > 0" class="text-xs text-gray-500 dark:text-gray-400 mb-1">
                                            <div class="flex items-center gap-2">
                                                <span class="px-2 py-1 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 rounded"
                                                      x-text="'Leadership: ' + (webScrapingResults?.verified_leadership?.length || 0)"></span>
                                            </div>
                                        </div>
                                        <div x-show="webScrapingResults?.foundation_intelligence?.is_foundation" class="text-xs text-gray-500 dark:text-gray-400">
                                            Foundation (990-PF) Data Available
                                        </div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">
                                            IRS Tax Filing Data
                                        </div>
                                    </div>
                                </div>

                                

                                <div class="space-y-4 flex-1 overflow-y-auto pr-2" style="scrollbar-width: thin;">

                                        <!-- Tax Filing Leadership -->
                                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                                <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                </svg>
                                                Leadership & Officers (Tax Filing Data)
                                            </h5>

                                            <div x-show="webScrapingResults?.extracted_info?.leadership?.length > 0" class="space-y-2">
                                                <template x-for="(leader, index) in webScrapingResults?.extracted_info?.leadership || []" :key="index">
                                                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded p-3 border-l-4 border-blue-400">
                                                        <div class="flex justify-between items-start">
                                                            <div class="flex-1">
                                                                <div class="font-medium text-gray-900 dark:text-white" x-text="leader.name || 'Unknown Name'"></div>
                                                                <div class="text-sm text-gray-600 dark:text-gray-400" x-text="leader.title || 'Unknown Title'"></div>
                                                            </div>
                                                            <div class="text-xs text-blue-600 dark:text-blue-400 ml-4">
                                                                <div x-text="(leader.confidence_score * 100 || 90).toFixed(0) + '% confidence'"></div>
                                                                <div class="text-xs text-gray-500">IRS Tax Filing</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>

                                            <div x-show="!webScrapingResults?.extracted_info?.leadership?.length" class="text-sm text-gray-500 dark:text-gray-400 italic text-center py-4">
                                                No leadership data available from tax filings
                                            </div>
                                        </div>

                                        <!-- Contact Information (BusinessOfficerGrp) -->
                                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                                <svg class="w-4 h-4 mr-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                                </svg>
                                                Contact Information (Tax Filing Data)
                                            </h5>

                                            <div x-show="webScrapingResults?.extracted_info?.contact_info?.length > 0" class="space-y-3">
                                                <template x-for="(contact, index) in webScrapingResults?.extracted_info?.contact_info || []" :key="index">
                                                    <div class="bg-orange-50 dark:bg-orange-900/20 rounded p-3 border-l-4 border-orange-400">
                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                            <!-- Contact Type and Value -->
                                                            <div>
                                                                <div class="text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wide" x-text="contact.type || 'Contact'"></div>
                                                                <div class="text-sm text-gray-700 dark:text-gray-300" x-text="contact.value || contact.content || contact"></div>
                                                            </div>

                                                            <!-- Source -->
                                                            <div x-show="contact.source">
                                                                <div class="text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wide">Source</div>
                                                                <div class="text-sm text-gray-700 dark:text-gray-300" x-text="contact.source"></div>
                                                            </div>
                                                        </div>
                                                        <div class="text-xs text-orange-600 dark:text-orange-400 mt-2">Source: IRS Tax Filing</div>
                                                    </div>
                                                </template>
                                            </div>

                                            <div x-show="!webScrapingResults?.extracted_info?.contact_info?.length" class="text-sm text-gray-500 dark:text-gray-400 italic text-center py-4">
                                                No contact information available from tax filings
                                            </div>
                                        </div>

                                        <!-- Financial Data (CYTotalRevenueAmt, CYTotalExpensesAmt) -->
                                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                                <svg class="w-4 h-4 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                                </svg>
                                                Financial Data (Tax Filing Data)
                                            </h5>

                                            <div x-show="webScrapingResults?.extracted_info?.financials" class="space-y-3">
                                                <div class="bg-green-50 dark:bg-green-900/20 rounded p-3 border-l-4 border-green-400">
                                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        <!-- Total Revenue -->
                                                        <div x-show="webScrapingResults?.extracted_info?.financials?.total_revenue">
                                                            <div class="text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wide">Total Revenue (CYTotalRevenueAmt)</div>
                                                            <div class="text-lg font-semibold text-green-600 dark:text-green-400" x-text="'$' + (webScrapingResults?.extracted_info?.financials?.total_revenue || 0).toLocaleString()"></div>
                                                        </div>

                                                        <!-- Total Expenses -->
                                                        <div x-show="webScrapingResults?.extracted_info?.financials?.total_expenses">
                                                            <div class="text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wide">Total Expenses (CYTotalExpensesAmt)</div>
                                                            <div class="text-lg font-semibold text-red-600 dark:text-red-400" x-text="'$' + (webScrapingResults?.extracted_info?.financials?.total_expenses || 0).toLocaleString()"></div>
                                                        </div>

                                                        <!-- Net Income -->
                                                        <div x-show="webScrapingResults?.extracted_info?.financials?.total_revenue && webScrapingResults?.extracted_info?.financials?.total_expenses">
                                                            <div class="text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wide">Net Income</div>
                                                            <div class="text-lg font-semibold"
                                                                 :class="((webScrapingResults?.extracted_info?.financials?.total_revenue || 0) - (webScrapingResults?.extracted_info?.financials?.total_expenses || 0)) >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'"
                                                                 x-text="'$' + ((webScrapingResults?.extracted_info?.financials?.total_revenue || 0) - (webScrapingResults?.extracted_info?.financials?.total_expenses || 0)).toLocaleString()"></div>
                                                        </div>

                                                        <!-- Tax Year -->
                                                        <div x-show="webScrapingResults?.extracted_info?.financials?.tax_year">
                                                            <div class="text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wide">Tax Year</div>
                                                            <div class="text-sm text-gray-700 dark:text-gray-300" x-text="webScrapingResults?.extracted_info?.financials?.tax_year"></div>
                                                        </div>
                                                    </div>
                                                    <div class="text-xs text-green-600 dark:text-green-400 mt-2">Source: 990 Financial Data (IRS Tax Filing)</div>
                                                </div>
                                            </div>

                                            <div x-show="!webScrapingResults?.extracted_info?.financials" class="text-sm text-gray-500 dark:text-gray-400 italic text-center py-4">
                                                No financial data available from tax filings
                                            </div>
                                        </div>

                                        <!-- Foundation Intelligence (990-PF only) -->
                                        <div x-show="webScrapingResults?.foundation_intelligence?.is_foundation" class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                                <svg class="w-4 h-4 mr-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                                </svg>
                                                Foundation Intelligence (990-PF)
                                            </h5>

                                            <!-- Foundation Grant Making -->
                                            <div x-show="webScrapingResults?.foundation_grants?.length > 0" class="mb-4">
                                                <h6 class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">Recent Grants Awarded</h6>
                                                <template x-for="(grant, index) in webScrapingResults?.foundation_grants || []" :key="index">
                                                    <div class="text-sm text-gray-700 dark:text-gray-300 bg-orange-50 dark:bg-orange-900/20 rounded px-3 py-2 mb-2 border-l-4 border-orange-400">
                                                        <div class="font-medium" x-text="grant.recipient_name || grant.name || 'Grant Recipient'"></div>
                                                        <div x-show="grant.amount" class="text-green-600 dark:text-green-400 font-medium" x-text="'$' + (grant.amount || 0).toLocaleString()"></div>
                                                        <div x-show="grant.purpose" class="text-xs text-gray-600 dark:text-gray-400 mt-1" x-text="grant.purpose"></div>
                                                        <div class="text-xs text-orange-600 dark:text-orange-400 mt-1">Source: IRS 990-PF Filing</div>
                                                    </div>
                                                </template>
                                            </div>

                                            <!-- Foundation Capacity -->
                                            <div x-show="webScrapingResults?.foundation_intelligence?.grant_making_capacity" class="mb-4">
                                                <h6 class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">Grant Making Capacity</h6>
                                                <div class="grid grid-cols-2 gap-3 text-sm">
                                                    <div x-show="webScrapingResults?.foundation_intelligence?.grant_making_capacity?.annual_distribution" class="bg-gray-50 dark:bg-gray-700 rounded px-3 py-2">
                                                        <div class="text-xs text-gray-500 dark:text-gray-400">Annual Distribution</div>
                                                        <div class="font-medium" x-text="'$' + (webScrapingResults?.foundation_intelligence?.grant_making_capacity?.annual_distribution || 0).toLocaleString()"></div>
                                                    </div>
                                                    <div x-show="webScrapingResults?.foundation_intelligence?.grant_making_capacity?.total_assets" class="bg-gray-50 dark:bg-gray-700 rounded px-3 py-2">
                                                        <div class="text-xs text-gray-500 dark:text-gray-400">Total Assets</div>
                                                        <div class="font-medium" x-text="'$' + (webScrapingResults?.foundation_intelligence?.grant_making_capacity?.total_assets || 0).toLocaleString()"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Application Process -->
                                            <div x-show="webScrapingResults?.foundation_intelligence?.application_process" class="mb-4">
                                                <h6 class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">Application Information</h6>
                                                <div class="text-sm text-gray-700 dark:text-gray-300 bg-blue-50 dark:bg-blue-900/20 rounded px-3 py-2">
                                                    <div x-show="webScrapingResults?.foundation_intelligence?.application_process?.contact_info" x-text="webScrapingResults?.foundation_intelligence?.application_process?.contact_info"></div>
                                                    <div x-show="webScrapingResults?.foundation_intelligence?.application_process?.deadlines" x-text="'Deadlines: ' + webScrapingResults?.foundation_intelligence?.application_process?.deadlines" class="text-xs text-blue-600 dark:text-blue-400 mt-1"></div>
                                                    <div class="text-xs text-blue-600 dark:text-blue-400 mt-1">Source: 990-PF Part XIV</div>
                                                </div>
                                            </div>

                                            <!-- No Foundation Data -->
                                            <div x-show="!webScrapingResults?.foundation_grants?.length && !webScrapingResults?.foundation_intelligence?.grant_making_capacity" class="text-sm text-gray-500 dark:text-gray-400 italic text-center py-4">
                                                <div x-show="webScrapingResults?.foundation_intelligence?.processing_failed">990-PF processing failed - limited foundation data available</div>
                                                <div x-show="!webScrapingResults?.foundation_intelligence?.processing_failed">Foundation intelligence data not available</div>
                                            </div>
                                        </div>

                                        <!-- Tax Filing Mission & Programs -->
                                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                                <svg class="w-4 h-4 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                                </svg>
                                                Mission & Programs (Tax Filing Data)
                                            </h5>

                                            <div x-show="webScrapingResults?.extracted_info?.mission_statements?.length > 0" class="mb-4">
                                                <h6 class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">Mission Statement</h6>
                                                <template x-for="(mission, index) in webScrapingResults?.extracted_info?.mission_statements || []" :key="index">
                                                    <div class="text-sm text-gray-700 dark:text-gray-300 bg-green-50 dark:bg-green-900/20 rounded px-3 py-2 mb-2 border-l-4 border-green-400">
                                                        <div x-text="typeof mission === 'object' ? mission.content || mission.description || mission : mission"></div>
                                                        <div class="text-xs text-green-600 dark:text-green-400 mt-1">Source: IRS Tax Filing</div>
                                                    </div>
                                                </template>
                                            </div>

                                            <div x-show="webScrapingResults?.extracted_info?.programs?.length > 0" class="mb-4">
                                                <h6 class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wide">Program Activities</h6>
                                                <template x-for="(program, index) in webScrapingResults?.extracted_info?.programs || []" :key="index">
                                                    <div class="text-sm text-gray-700 dark:text-gray-300 bg-green-50 dark:bg-green-900/20 rounded px-3 py-2 mb-2 border-l-4 border-green-400">
                                                        <div x-text="typeof program === 'object' ? program.content || program.description || program.name || program : program"></div>
                                                        <div class="text-xs text-green-600 dark:text-green-400 mt-1">Source: IRS Tax Filing</div>
                                                    </div>
                                                </template>
                                            </div>

                                            <div x-show="!webScrapingResults?.extracted_info?.mission_statements?.length && !webScrapingResults?.extracted_info?.programs?.length" class="text-sm text-gray-500 dark:text-gray-400 italic text-center py-4">
                                                No mission or program data available from tax filings
                                            </div>
                                        </div>

                                        <!-- Data Source Attribution -->
                                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border border-blue-200 dark:border-blue-700">
                                            <div class="flex items-center text-xs text-blue-700 dark:text-blue-300">
                                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                All data in this tab comes from official IRS tax filings (990/990-PF) and ProPublica database. This information is read-only and cannot be edited.
                                            </div>
                                        </div>
                                </div>
                            </div>
                        </div>

                        <!-- Web Search Data Tab -->
                        <div x-show="profileModalActiveTab === 'web-search'" class="p-2">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 flex flex-col h-full">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Web Search Data</h4>
                                    <div class="text-right">
                                        <!-- Source Breakdown Display -->
                                        <div x-show="webScrapingResults?.source_breakdown" class="text-xs text-gray-500 dark:text-gray-400 mb-1">
                                            <div class="flex items-center gap-2">
                                                <span x-show="webScrapingResults?.source_breakdown?.scrapy_success_count > 0"
                                                      class="px-2 py-1 bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 rounded"
                                                      x-text="'Sources Scraped: ' + (webScrapingResults?.source_breakdown?.scrapy_success_count || 0)"></span>
                                                <span x-show="webScrapingResults?.source_breakdown?.total_sources_tried > 0"
                                                      class="px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded"
                                                      x-text="'Total Tried: ' + (webScrapingResults?.source_breakdown?.total_sources_tried || 0)"></span>
                                            </div>
                                        </div>
                                        <div x-show="webScrapingResults?.intelligence_quality_score" class="text-xs text-gray-500 dark:text-gray-400">
                                            Quality Score: <span x-text="webScrapingResults?.intelligence_quality_score"></span>/100
                                        </div>
                                        <div x-show="webScrapingResults?.data_source" class="text-xs text-gray-500 dark:text-gray-400">
                                            <span x-text="webScrapingResults?.data_source"></span>
                                        </div>
                                        <div x-show="!webScrapingResults" class="text-xs text-gray-500 dark:text-gray-400">
                                            Web Search & Scrapy Data
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-6 flex-1 overflow-y-auto pr-2" style="scrollbar-width: thin;">

                                    <!-- News Section -->
                                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                        <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                                            </svg>
                                            News & Media
                                        </h5>

                                        <!-- Partnerships/Affiliations -->
                                        <div class="mb-4">
                                            <div class="flex justify-between items-center mb-2">
                                                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300">Partnerships/Affiliations</label>
                                                <button type="button"
                                                        @click="enhancedDataForm.partnerships.push('')"
                                                        class="text-xs text-purple-600 hover:text-purple-800 dark:text-purple-400">+ Add</button>
                                            </div>
                                            <div class="space-y-2">
                                                <template x-for="(partnership, index) in enhancedDataForm.partnerships" :key="index">
                                                    <div class="flex gap-2 items-center">
                                                        <input type="text"
                                                               x-model="enhancedDataForm.partnerships[index]"
                                                               class="flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"
                                                               placeholder="Partnership name">
                                                        <button type="button"
                                                                @click="enhancedDataForm.partnerships.splice(index, 1)"
                                                                class="text-red-500 hover:text-red-700 text-xs">√ó</button>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>

                                        <!-- Recent News/Press Releases -->
                                        <div class="mb-4">
                                            <div class="flex justify-between items-center mb-2">
                                                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300">Recent News/Press Releases</label>
                                                <button type="button"
                                                        @click="enhancedDataForm.news.push({date: '', title: '', link: ''})"
                                                        class="text-xs text-purple-600 hover:text-purple-800 dark:text-purple-400">+ Add</button>
                                            </div>
                                            <div class="space-y-2">
                                                <template x-for="(newsItem, index) in enhancedDataForm.news" :key="index">
                                                    <div class="border border-gray-200 dark:border-gray-600 rounded p-2">
                                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-2">
                                                            <input type="date"
                                                                   x-model="newsItem.date"
                                                                   class="px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-purple-500 dark:bg-gray-700 dark:text-white">
                                                            <input type="text"
                                                                   x-model="newsItem.title"
                                                                   class="px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"
                                                                   placeholder="Title">
                                                            <div class="flex gap-1">
                                                                <input type="url"
                                                                       x-model="newsItem.link"
                                                                       class="flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"
                                                                       placeholder="Link URL">
                                                                <button type="button"
                                                                        @click="enhancedDataForm.news.splice(index, 1)"
                                                                        class="text-red-500 hover:text-red-700 text-xs px-1">√ó</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>

                                        <!-- Social Media Links -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2">Social Media Links</label>
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Facebook</label>
                                                    <input type="url"
                                                           x-model="enhancedDataForm.socialMedia.facebook"
                                                           class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"
                                                           placeholder="https://facebook.com/...">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Twitter</label>
                                                    <input type="url"
                                                           x-model="enhancedDataForm.socialMedia.twitter"
                                                           class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"
                                                           placeholder="https://twitter.com/...">
                                                </div>
                                                <div>
                                                    <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">LinkedIn</label>
                                                    <input type="url"
                                                           x-model="enhancedDataForm.socialMedia.linkedin"
                                                           class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-purple-500 dark:bg-gray-700 dark:text-white"
                                                           placeholder="https://linkedin.com/...">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                        <!-- Data Source Attribution for Web Search -->
                                        <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 border border-purple-200 dark:border-purple-700">
                                            <div class="flex items-center text-xs text-purple-700 dark:text-purple-300">
                                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                                </svg>
                                                All data in this tab can be edited and comes from web search and Scrapy data sources. Changes are saved to your profile.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    </div> <!-- Close Tab Content container -->

                </form>

                </div> <!-- Close Modal Content -->

                <!-- Action buttons - Using Delete Modal Pattern -->
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <button type="button"
                            @click="saveProfile()"
                            :disabled="profileSaving || !profileForm.name"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-purple-600 text-base font-medium text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-800 sm:ml-3 sm:w-auto sm:text-sm transition-colors">
                        <div x-show="profileSaving" class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                        <span x-text="profileSaving ? 'Saving...' : (isEditingProfile ? 'Update Profile' : 'Create Profile')"></span>
                    </button>
                    <button type="button"
                            @click="showProfileModal = false"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 sm:mt-0 sm:w-auto sm:text-sm transition-colors">
                        Cancel
                    </button>
                </div>

            </div> <!-- Close main modal container -->
        </div> <!-- Close center container -->
    </div> <!-- Close outer modal container -->

    <!-- Delete Confirmation Modal -->
    <div x-show="showDeleteConfirmation" 
         x-cloak
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto">
        
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 transition-opacity"
             @click="cancelDeleteProfile()"></div>
        
        <!-- Modal content -->
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                
                <!-- Warning Icon -->
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-red-600 dark:text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">
                            Delete Profile
                        </h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-300" x-text="deleteConfirmationMessage">
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Action buttons -->
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <button @click="confirmDeleteProfile()"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:focus:ring-offset-gray-800 sm:ml-3 sm:w-auto sm:text-sm transition-colors">
                        Delete
                    </button>
                    <button @click="cancelDeleteProfile()"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 sm:mt-0 sm:w-auto sm:text-sm transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Intelligence Confirmation Modal -->
    <div x-show="showAIIntelligenceConfirmation" 
         x-cloak
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto">
        
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 transition-opacity"
             @click="cancelAIIntelligence()"></div>
        
        <!-- Modal content -->
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 dark:bg-orange-900/50 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-orange-600 dark:text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">
                            Start AI Intelligence Analysis
                        </h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-300">
                                This will run advanced AI analysis on your candidates to extract strategic intelligence and facts. 
                                The process will analyze each candidate for compatibility, strategic insights, and actionable intelligence.
                                <br><br>
                                Are you ready to proceed with AI Intelligence analysis?
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Action buttons -->
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <button @click="confirmAIIntelligence()"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-600 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 dark:focus:ring-offset-gray-800 sm:ml-3 sm:w-auto sm:text-sm transition-colors">
                        Start Analysis
                    </button>
                    <button @click="cancelAIIntelligence()"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 sm:mt-0 sm:w-auto sm:text-sm transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Deep Research Confirmation Modal -->
    <div x-show="showDeepResearchConfirmation" 
         x-cloak
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto">
        
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 transition-opacity"
             @click="cancelDeepResearch()"></div>
        
        <!-- Modal content -->
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900/50 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">
                            Start Deep Research Investigation
                        </h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-300">
                                This will conduct comprehensive deep research and strategic intelligence gathering on your target opportunities. 
                                The analysis will provide detailed insights, strategic recommendations, and actionable intelligence for decision-making.
                                <br><br>
                                Are you ready to proceed with Deep Research Investigation?
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Action buttons -->
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <button @click="confirmDeepResearch()"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 sm:ml-3 sm:w-auto sm:text-sm transition-colors">
                        Start Research
                    </button>
                    <button @click="cancelDeepResearch()"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 sm:mt-0 sm:w-auto sm:text-sm transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- NTEE Code Selection Modal -->
    <div x-show="nteeModal.isOpen" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-hidden"
         @click.away="closeNteeModal()">
        
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75"></div>
        
        <!-- Modal Content -->
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="w-[1400px] h-[624px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border-2 border-gray-300 dark:border-gray-600 flex flex-col">
                
                <!-- Modal Header -->
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-600">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                            Select NTEE Codes
                        </h3>
                        <button @click="closeNteeModal()"
                                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                        Select the NTEE categories that best represent your organization's activities and focus areas.
                    </p>
                </div>
                
                <!-- Modal Body - Two Column Layout -->
                <div class="flex-1 overflow-hidden flex">
                    
                    <!-- Left Column: Main Categories (A-Z) -->
                    <div class="w-1/3 border-r border-gray-200 dark:border-gray-600 flex flex-col">
                        <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
                            <h4 class="text-sm font-semibold text-gray-900 dark:text-white">Main Categories</h4>
                        </div>
                        <div class="flex-1 overflow-y-auto p-2">
                            <template x-for="(categoryData, categoryKey) in fullNteeCodeList" :key="categoryKey">
                                <div class="mb-1">
                                    <button @click="selectMainCategory(categoryKey)"
                                            :class="nteeModal.selectedMainCategory === categoryKey ? 
                                                'bg-blue-100 dark:bg-blue-900 border-blue-300 dark:border-blue-600 text-blue-900 dark:text-blue-100' :
                                                categoryHasSelections(categoryKey) ?
                                                'bg-green-50 dark:bg-green-900 border-green-200 dark:border-green-700 text-green-800 dark:text-green-200 hover:bg-green-100 dark:hover:bg-green-800' :
                                                'bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600'"
                                            class="w-full text-left p-2 border rounded-md transition-colors">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2 flex-1">
                                                <span class="font-bold text-sm" x-text="categoryKey"></span>
                                                <span class="text-xs truncate flex-1" x-text="categoryData.category"></span>
                                            </div>
                                            <span class="text-xs bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded flex-shrink-0 ml-2" 
                                                  x-text="categoryData.subcategories.length"></span>
                                        </div>
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Right Column: Subcategories -->
                    <div class="w-2/3 flex flex-col">
                        <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
                            <h4 class="text-sm font-semibold text-gray-900 dark:text-white">
                                <span x-show="!nteeModal.selectedMainCategory">Select a main category to view subcategories</span>
                                <span x-show="nteeModal.selectedMainCategory" x-text="nteeModal.selectedMainCategory + ' - ' + (fullNteeCodeList[nteeModal.selectedMainCategory]?.category || '')"></span>
                            </h4>
                        </div>
                        <div class="flex-1 overflow-y-auto p-4">
                            <div x-show="!nteeModal.selectedMainCategory" class="text-center text-gray-500 dark:text-gray-400 py-8">
                                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                                <p>Choose a main category from the left to view its subcategories</p>
                            </div>
                            
                            <div x-show="nteeModal.selectedMainCategory" class="space-y-1">
                                <template x-for="subcat in fullNteeCodeList[nteeModal.selectedMainCategory]?.subcategories || []" :key="subcat.code">
                                    <div @click="toggleSubcategorySelection(subcat.code)"
                                         :class="isSubcategorySelected(subcat.code) ? 
                                            'bg-blue-600 text-white border-blue-600' :
                                            'bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600'"
                                         class="flex items-center p-2 border rounded-md cursor-pointer transition-colors">
                                        <div class="flex items-center space-x-2 flex-1">
                                            <span class="font-medium text-sm" x-text="subcat.code"></span>
                                            <span class="text-sm truncate" x-text="subcat.name"></span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-500 dark:text-gray-400">
                            <span x-text="nteeModal.tempSelectedCodes.length"></span> codes selected
                        </div>
                        <div class="flex space-x-3">
                            <button @click="closeNteeModal()"
                                    class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-50 dark:hover:bg-gray-500 transition-colors">
                                Cancel
                            </button>
                            <button @click="saveNteeSelection()"
                                    class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors">
                                Save Selection
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Government Criteria Selection Modal -->
    <div x-show="governmentCriteriaModal.isOpen" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-hidden"
         @click.away="closeGovernmentCriteriaModal()">
        
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75"></div>
        
        <!-- Modal Content -->
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="w-[1400px] h-[624px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border-2 border-gray-300 dark:border-gray-600 flex flex-col">
                
                <!-- Modal Header -->
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-600">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                            Select Government Criteria
                        </h3>
                        <button @click="closeGovernmentCriteriaModal()"
                                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                        Select the federal government funding criteria that align with your organization's grant preferences and capabilities.
                    </p>
                </div>
                
                <!-- Modal Body - Two Column Layout -->
                <div class="flex-1 overflow-hidden flex">
                    
                    <!-- Left Column: Criteria Categories -->
                    <div class="w-1/3 border-r border-gray-200 dark:border-gray-600 flex flex-col">
                        <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
                            <h4 class="text-sm font-semibold text-gray-900 dark:text-white">Criteria Categories</h4>
                        </div>
                        <div class="flex-1 overflow-y-auto p-2">
                            <template x-for="(categoryData, categoryKey) in governmentCriteriaList" :key="categoryKey">
                                <div class="mb-1">
                                    <button @click="selectCriteriaCategory(categoryKey)"
                                            :class="governmentCriteriaModal.selectedCategory === categoryKey ? 
                                                'bg-blue-100 dark:bg-blue-900 border-blue-300 dark:border-blue-600 text-blue-900 dark:text-blue-100' :
                                                categoryHasCriteriaSelections(categoryKey) ?
                                                'bg-green-50 dark:bg-green-900 border-green-200 dark:border-green-700 text-green-800 dark:text-green-200 hover:bg-green-100 dark:hover:bg-green-800' :
                                                'bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600'"
                                            class="w-full text-left px-3 py-2 text-sm border rounded-md transition-colors mb-1">
                                        <div class="font-medium" x-text="categoryData.category"></div>
                                        <div class="text-xs opacity-75" x-text="categoryData.description"></div>
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Right Column: Criteria Items -->
                    <div class="flex-1 flex flex-col">
                        <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
                            <h4 class="text-sm font-semibold text-gray-900 dark:text-white">Available Criteria</h4>
                        </div>
                        <div class="flex-1 overflow-y-auto p-4">
                            <!-- Show message when no category selected -->
                            <div x-show="!governmentCriteriaModal.selectedCategory" 
                                 class="text-center text-gray-500 dark:text-gray-400 mt-8">
                                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                <p class="text-sm">Select a category to view criteria options</p>
                            </div>
                            
                            <!-- Show criteria for selected category -->
                            <template x-for="(categoryData, categoryKey) in governmentCriteriaList" :key="categoryKey">
                                <div x-show="governmentCriteriaModal.selectedCategory === categoryKey" class="space-y-2">
                                    <template x-for="criteria in categoryData.criteria" :key="criteria.id">
                                        <div @click="toggleCriteriaSelection(criteria.id)"
                                             :class="isCriteriaSelected(criteria.id) ? 
                                                'bg-blue-100 dark:bg-blue-900 border-blue-300 dark:border-blue-600 text-blue-900 dark:text-blue-100' : 
                                                'bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600'"
                                             class="p-3 border rounded-md cursor-pointer transition-colors">
                                            <div class="flex items-start justify-between">
                                                <div class="flex-1 min-w-0">
                                                    <div class="font-medium text-sm" x-text="criteria.name"></div>
                                                    <!-- Source badges -->
                                                    <div class="flex flex-wrap gap-1 mt-2">
                                                        <template x-for="source in criteria.sources" :key="source">
                                                            <span :class="source === 'Federal' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' : 
                                                                           source === 'State' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 
                                                                           'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'"
                                                                  class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium" 
                                                                  x-text="source">
                                                            </span>
                                                        </template>
                                                    </div>
                                                </div>
                                                <div class="ml-3 flex-shrink-0">
                                                    <div x-show="isCriteriaSelected(criteria.id)" class="text-blue-600 dark:text-blue-400">
                                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            <span x-text="governmentCriteriaModal.tempSelectedCriteria.length"></span> criteria selected
                        </div>
                        <div class="flex space-x-3">
                            <button @click="closeGovernmentCriteriaModal()"
                                    class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-50 dark:hover:bg-gray-500 transition-colors">
                                Cancel
                            </button>
                            <button @click="saveGovernmentCriteriaSelection()"
                                    class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors">
                                Save Selection
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Visualization Popup Modal -->
    <div x-show="showNetworkPopup" x-cloak
         class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white dark:bg-gray-800"
             class="h-[80vh]">
            <div class="flex items-center justify-between pb-3 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white" 
                    x-text="networkPopupType === 'board' ? 'Board Member Network - Enhanced View' : 'Influence Network - Enhanced View'"></h3>
                <button @click="closeNetworkPopup()" 
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mt-4 h-full pb-16">
                <!-- Enhanced Network Chart Container -->
                <div class="h-full bg-gray-50 dark:bg-gray-900 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600">
                    <div :id="`popup-${networkPopupType}-network-chart`" class="w-full h-full">
                        <!-- Network visualization will be rendered here -->
                        <div class="flex items-center justify-center h-full text-gray-400">
                            <div class="text-center">
                                <svg class="mx-auto h-12 w-12 mb-4 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Loading Enhanced Network Visualization</h3>
                                <p class="text-gray-500 dark:text-gray-400">Preparing 2x scaled visualization...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="absolute bottom-0 left-0 right-0 px-5 py-3 bg-gray-50 dark:bg-gray-700 rounded-b-md">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        Enhanced view - 2x original size
                    </div>
                    <button @click="closeNetworkPopup()" 
                            class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SECTION 3: Footer -->
    <footer class="flex-shrink-0">
        <!-- Footer content can be added here in the future -->
    </footer>

    <!-- JavaScript with error handling -->
    <script>
        // Ensure all external scripts are loaded before initializing
        let scriptsLoaded = {
            tailwind: false,
            alpine: false,
            chart: false
        };
        
        // Check if Tailwind is loaded
        function checkTailwind() {
            if (typeof tailwind !== 'undefined' && tailwind.config) {
                scriptsLoaded.tailwind = true;
                console.log('‚úÖ Tailwind CSS loaded');
            } else {
                setTimeout(checkTailwind, 100);
            }
        }
        
        // Check if Alpine.js is loaded
        function checkAlpine() {
            if (typeof Alpine !== 'undefined') {
                scriptsLoaded.alpine = true;
                console.log('‚úÖ Alpine.js loaded');
            } else {
                setTimeout(checkAlpine, 100);
            }
        }
        
        // Check if Chart.js is loaded
        function checkChart() {
            if (typeof Chart !== 'undefined') {
                scriptsLoaded.chart = true;
                console.log('‚úÖ Chart.js loaded');
            } else {
                setTimeout(checkChart, 100);
            }
        }
        
        // Start checking for scripts
        checkTailwind();
        checkAlpine();
        checkChart();
        
        // CDN fallback and error handling
        setTimeout(() => {
            if (!scriptsLoaded.alpine) {
                console.error('‚ö†Ô∏è Alpine.js failed to load from CDN, check network connection');
            }
            if (!scriptsLoaded.tailwind) {
                console.error('‚ö†Ô∏è Tailwind CSS failed to load from CDN, check network connection');
            }
            if (!scriptsLoaded.chart) {
                console.error('‚ö†Ô∏è Chart.js failed to load from CDN, check network connection');
            }
        }, 5000);
    </script>
    
    <!-- Conditionally load modular pagination for hybrid system -->
    <script>
        // Try to load modular pagination for hybrid enhancement
        try {
            const script = document.createElement('script');
            script.src = '/static/js/modules/pagination.js';
            script.async = false; // Ensure it loads before app.js
            script.onerror = () => console.log('üìã Hybrid pagination: Modular pagination not available, using built-in system');
            script.onload = () => console.log('‚úÖ Hybrid pagination: Modular pagination enhanced system loaded');
            document.head.appendChild(script);
        } catch (error) {
            console.log('üìã Hybrid pagination: Using built-in pagination system');
        }
    </script>

    <!-- Catalynx Modules - Disabled to prevent conflicts with main app.js -->
    <!-- <script src="/static/js/core/error-handler.js" onerror="console.error('Failed to load error-handler.js')"></script> -->
    <!-- <script src="/static/js/core/catalynx-utils.js" onerror="console.error('Failed to load catalynx-utils.js')"></script> -->
    <!-- <script src="/static/js/utils/api-client.js" onerror="console.error('Failed to load api-client.js')"></script> -->

    <!-- Alpine.js Stores - Disabled to prevent conflicts with main app.js -->
    <!-- <script src="/static/js/stores/ui-store.js" onerror="console.error('Failed to load ui-store.js')"></script> -->
    <!-- <script src="/static/js/stores/profiles-store.js" onerror="console.error('Failed to load profiles-store.js')"></script> -->
    <!-- <script src="/static/js/stores/opportunities-store.js" onerror="console.error('Failed to load opportunities-store.js')"></script> -->

    <script src="/static/app.js?v=REAL_DATA_ONLY_20250911" onerror="console.error('Failed to load app.js')"></script>
    
    <!-- DEBUGGING: Visual indicator that our code is active -->
    
    <!-- Real data only - no mock/test data injection -->

    <!-- INLINE FIX: Override getOrganizationTypeColor for PROFILER and DISCOVER cache issue -->
    <script>
        // Wait for Alpine.js to initialize, then override the function
        document.addEventListener('alpine:init', () => {
            // Override CatalynxUtils function
            if (window.CatalynxUtils) {
                window.CatalynxUtils.getOrganizationTypeColor = function(type) {
                    console.log('[INLINE FIX] getOrganizationTypeColor called with type:', type);
                    const classes = '!bg-blue-600 !text-white dark:!bg-blue-700 dark:!text-white !font-medium !important';
                    console.log('[INLINE FIX] Returning classes:', classes);
                    return classes;
                };
                console.log('[INLINE FIX] CatalynxUtils.getOrganizationTypeColor overridden');
            }
            
            // Also override it on the Alpine data objects after they're created
            setTimeout(() => {
                // Try to find and override the function on Alpine instances
                const alpineElements = document.querySelectorAll('[x-data]');
                alpineElements.forEach(el => {
                    if (el._x_dataStack && el._x_dataStack[0]) {
                        const data = el._x_dataStack[0];
                        if (data && typeof data === 'object') {
                            data.getOrganizationTypeColor = function(type) {
                                console.log('[INLINE OVERRIDE] getOrganizationTypeColor called with type:', type);
                                return '!bg-blue-600 !text-white dark:!bg-blue-700 dark:!text-white !font-medium !important';
                            };
                        }
                    }
                });
                console.log('[INLINE FIX] Alpine instances patched');
                
                // Initialize desktop UX features
                setTimeout(() => {
                    const bodyElement = document.querySelector('[x-data="catalynxApp()"]');
                    if (bodyElement && bodyElement._x_dataStack && bodyElement._x_dataStack[0]) {
                        const appData = bodyElement._x_dataStack[0];
                        
                        // Initialize keyboard shortcuts
                        if (typeof addDesktopKeyboardShortcuts === 'function') {
                            addDesktopKeyboardShortcuts(appData);
                            console.log('[DESKTOP UX] Keyboard shortcuts initialized');
                        }
                        
                        // Phase 3: Initialize Research Platform functionality
                        if (appData && typeof appData === 'object') {
                            // Initialize research platform data
                            appData.researchPlatform = {
                                analysisMode: 'integrated',
                                reportType: 'executive_summary',
                                running: false,
                                analysisCount: 0,
                                totalCost: 0.0,
                                reportsGenerated: 0,
                                lastBatchId: null,
                                lastResults: null
                            };
                            
                            // Initialize research modal state
                            appData.showResearchModal = false;
                            
                            // Add research platform functions
                            appData.runIntegratedAnalysis = async function() {
                                if (!this.selectedProfile || this.analyzeData.length === 0) {
                                    this.showNotification('Analysis', 'No candidates available for analysis', 'warning');
                                    return;
                                }
                                
                                this.researchPlatform.running = true;
                                
                                try {
                                    const requestData = {
                                        include_research: this.researchPlatform.analysisMode !== 'scoring_only',
                                        report_type: this.researchPlatform.reportType,
                                        stage_filter: this.analyzeStageFilter || 'candidates'
                                    };
                                    
                                    const response = await fetch(`/api/profiles/${this.selectedProfile.profile_id}/research/batch-analyze`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(requestData)
                                    });
                                    
                                    if (!response.ok) {
                                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                    }
                                    
                                    const data = await response.json();
                                    
                                    // Update research platform stats
                                    this.researchPlatform.analysisCount += data.batch_summary.successful_analyses;
                                    this.researchPlatform.totalCost += data.batch_summary.total_cost;
                                    if (requestData.include_research) {
                                        this.researchPlatform.reportsGenerated += data.batch_summary.successful_analyses;
                                    }
                                    this.researchPlatform.lastBatchId = data.batch_id;
                                    this.researchPlatform.lastResults = data;
                                    
                                    this.showNotification('Research Analysis', 
                                        `Completed analysis of ${data.batch_summary.successful_analyses} opportunities. Cost: $${data.batch_summary.total_cost.toFixed(4)}`, 
                                        'success');
                                    
                                    console.log('Integrated analysis completed:', data);
                                    
                                } catch (error) {
                                    console.error('Research analysis failed:', error);
                                    this.showNotification('Analysis Error', 
                                        `Research analysis failed: ${error.message}`, 
                                        'error');
                                } finally {
                                    this.researchPlatform.running = false;
                                }
                            };
                            
                            appData.exportResearchResults = async function() {
                                if (!this.researchPlatform.lastBatchId) {
                                    this.showNotification('Export', 'No research results to export', 'warning');
                                    return;
                                }
                                
                                try {
                                    const requestData = {
                                        batch_id: this.researchPlatform.lastBatchId,
                                        format: 'json'
                                    };
                                    
                                    const response = await fetch('/api/research/export-results', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(requestData)
                                    });
                                    
                                    if (!response.ok) {
                                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                    }
                                    
                                    const data = await response.json();
                                    
                                    this.showNotification('Export', 
                                        `Research results exported: ${data.export_id}`, 
                                        'success');
                                    
                                    console.log('Export completed:', data);
                                    
                                } catch (error) {
                                    console.error('Export failed:', error);
                                    this.showNotification('Export Error', 
                                        `Export failed: ${error.message}`, 
                                        'error');
                                }
                            };
                            
                            appData.analyzeWebsiteIntelligence = async function(url, opportunityData = {}) {
                                try {
                                    const requestData = {
                                        url: url,
                                        opportunity_data: opportunityData
                                    };
                                    
                                    const response = await fetch('/api/research/website-intelligence', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(requestData)
                                    });
                                    
                                    if (!response.ok) {
                                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                    }
                                    
                                    const data = await response.json();
                                    
                                    this.showNotification('Website Analysis', 
                                        `Analyzed ${url}. Quality score: ${(data.website_intelligence.quality_score * 100).toFixed(0)}%`, 
                                        'success');
                                    
                                    return data;
                                    
                                } catch (error) {
                                    console.error('Website intelligence failed:', error);
                                    this.showNotification('Website Analysis Error', 
                                        `Analysis failed: ${error.message}`, 
                                        'error');
                                    return null;
                                }
                            };
                            
                            appData.generateDecisionPackage = async function(opportunityId) {
                                if (!this.selectedProfile) {
                                    this.showNotification('Decision Package', 'No profile selected', 'warning');
                                    return;
                                }
                                
                                try {
                                    const response = await fetch(`/api/profiles/${this.selectedProfile.profile_id}/research/decision-package/${opportunityId}`);
                                    
                                    if (!response.ok) {
                                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                    }
                                    
                                    const data = await response.json();
                                    
                                    this.showNotification('Decision Package', 
                                        `Generated comprehensive decision package for ${data.organization_name}`, 
                                        'success');
                                    
                                    console.log('Decision package generated:', data);
                                    return data;
                                    
                                } catch (error) {
                                    console.error('Decision package generation failed:', error);
                                    this.showNotification('Decision Package Error', 
                                        `Generation failed: ${error.message}`, 
                                        'error');
                                    return null;
                                }
                            };
                            
                            console.log('[PHASE 3] Research Platform functionality initialized');
                        }
                        
                        // Initialize context menus
                        if (typeof addDesktopContextMenus === 'function') {
                            addDesktopContextMenus(appData);
                            console.log('[DESKTOP UX] Context menus initialized');
                        }
                        
                        // Initialize bulk selection
                        if (typeof addDesktopBulkSelection === 'function') {
                            addDesktopBulkSelection(appData);
                            console.log('[DESKTOP UX] Bulk selection initialized');
                        }
                    }
                }, 1500); // Wait a bit longer for Alpine to fully initialize
            }, 1000);
        });
    </script>

    <!-- IMMEDIATE FIX: Richmond Memorial Stage Issue Debug -->
    <script>
        // Force immediate debug logging for Richmond Memorial opportunities
        console.log('üîß INLINE RICHMOND MEMORIAL DEBUG ACTIVE - Browser cache bypass');
        
        document.addEventListener('alpine:init', () => {
            console.log('üîß Alpine initialized, setting up Richmond Memorial debugging');
            
            setTimeout(() => {
                const bodyElement = document.querySelector('[x-data="catalynxApp()"]');
                if (bodyElement && bodyElement._x_dataStack && bodyElement._x_dataStack[0]) {
                    const appData = bodyElement._x_dataStack[0];
                    console.log('üîß Found Alpine app data, patching Richmond Memorial functions');
                    
                    // Override openOpportunityModal to add debugging
                    const originalOpenModal = appData.openOpportunityModal;
                    if (originalOpenModal) {
                        appData.openOpportunityModal = async function(opportunity, origin = 'overview') {
                            if (opportunity && opportunity.organization_name && opportunity.organization_name.includes('Richmond Memorial')) {
                                console.log('üîß INLINE RICHMOND MEMORIAL MODAL DEBUG:', {
                                    opportunity_id: opportunity.opportunity_id,
                                    organization_name: opportunity.organization_name,
                                    current_stage: opportunity.current_stage,
                                    funnel_stage: opportunity.funnel_stage,
                                    pipeline_stage: opportunity.pipeline_stage,
                                    stage: opportunity.stage,
                                    expected_display: opportunity.funnel_stage ? 
                                        (opportunity.funnel_stage === 'prospects' ? '#1 Prospect' :
                                         opportunity.funnel_stage === 'qualified' ? '#2 Qualified Prospect' :
                                         opportunity.funnel_stage === 'candidates' ? '#3 Candidate' :
                                         opportunity.funnel_stage === 'targets' ? '#4 Target' :
                                         opportunity.funnel_stage === 'opportunities' ? '#5 Opportunity' : 
                                         opportunity.funnel_stage) : 'NO FUNNEL STAGE'
                                });
                            }
                            return originalOpenModal.call(this, opportunity, origin);
                        };
                        console.log('üîß Patched openOpportunityModal with Richmond Memorial debugging');
                    }
                    
                    // Override canDemote to add debugging
                    const originalCanDemote = appData.canDemote;
                    if (originalCanDemote) {
                        appData.canDemote = function(opportunity) {
                            const result = originalCanDemote.call(this, opportunity);
                            if (opportunity && opportunity.organization_name && opportunity.organization_name.includes('Richmond Memorial')) {
                                console.log('üîß INLINE RICHMOND MEMORIAL DEMOTE DEBUG:', {
                                    organization_name: opportunity.organization_name,
                                    funnel_stage: opportunity.funnel_stage,
                                    current_stage: opportunity.current_stage,
                                    can_demote_result: result,
                                    reason: result ? 'Button should be ENABLED' : 'Button is DISABLED'
                                });
                            }
                            return result;
                        };
                        console.log('üîß Patched canDemote with Richmond Memorial debugging');
                    }
                }
            }, 2000);
        });
    </script>

    <!-- Discovery Results Modal -->
    <div x-show="showDiscoveryResultsModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto"
         @click.away="showDiscoveryResultsModal = false">
        
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white">Discovery Results</h3>
                        <button @click="showDiscoveryResultsModal = false" 
                                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <span class="sr-only">Close</span>
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Results Summary -->
                    <div class="mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-md">
                        <div class="text-sm text-gray-600 dark:text-gray-300">
                            Showing <span x-text="opportunitiesData.length"></span> discovery results
                        </div>
                    </div>
                    
                    <!-- Results Table -->
                    <div class="max-h-96 overflow-y-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Organization</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Stage</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Score</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Source</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600">
                                <template x-if="Array.isArray(opportunitiesData)">
                                    <template x-for="result in opportunitiesData" :key="result.opportunity_id || result.id">
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="result.organization_name"></div>
                                            <div class="text-sm text-gray-500 dark:text-gray-400" x-text="result.ein || 'No EIN'"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800"
                                                  x-text="result.source_type"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800"
                                                  x-text="getStageDisplayName(result.funnel_stage)"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 dark:bg-gray-600 rounded-full h-2 mr-2">
                                                    <div class="bg-blue-600 h-2 rounded-full" 
                                                         :style="`width: ${(result.compatibility_score || 0) * 100}%`"></div>
                                                </div>
                                                <span x-text="((result.compatibility_score || 0) * 100).toFixed(0) + '%'"></span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400" x-text="result.discovery_source || ''"></td>
                                        </tr>
                                    </template>
                                </template>
                                <!-- Empty state message -->
                                <template x-if="!Array.isArray(opportunitiesData) || opportunitiesData.length === 0">
                                    <tr>
                                        <td colspan="4" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                            <div>
                                                <div class="text-sm font-medium">No opportunities found</div>
                                                <div class="text-xs mt-1" x-show="selectedProfile">Loading opportunities...</div>
                                                <div class="text-xs mt-1" x-show="!selectedProfile">Select a profile to view opportunities</div>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        <div x-show="opportunitiesData.length === 0" class="text-center py-8 text-gray-500 dark:text-gray-400">
                            No discovery results available
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="showDiscoveryResultsModal = false" 
                            type="button"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Discovery Configuration Modal -->
    <div x-show="showDiscoveryConfigModal" 
         x-cloak
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto">
        
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 transition-opacity"
             @click="showDiscoveryConfigModal = false"></div>
        
        <!-- Modal content -->
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white">Discovery Configuration</h3>
                        <button @click="showDiscoveryConfigModal = false" 
                                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                            <span class="sr-only">Close</span>
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- General Settings -->
                        <div>
                            <h4 class="text-md font-medium text-gray-900 dark:text-white mb-3">General Settings</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Max Results Per Track</label>
                                    <input type="number" x-model="discoveryConfig.general.maxResultsPerTrack" 
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                                           min="10" max="200">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Timeout (minutes)</label>
                                    <input type="number" x-model="discoveryConfig.general.timeoutMinutes" 
                                           class="w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                                           min="1" max="30">
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" x-model="discoveryConfig.general.enableCache" 
                                           class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label class="ml-2 text-sm text-gray-700 dark:text-gray-300">Enable Caching</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" x-model="discoveryConfig.general.autoSave" 
                                           class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label class="ml-2 text-sm text-gray-700 dark:text-gray-300">Auto-save Results</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Track Settings -->
                        <div>
                            <h4 class="text-md font-medium text-gray-900 dark:text-white mb-3">Discovery Tracks</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-3 border rounded-md dark:border-gray-600">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Nonprofit Track</label>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Search nonprofit organizations via BMF and 990 data</p>
                                    </div>
                                    <input type="checkbox" x-model="discoveryConfig.nonprofit.enabled" 
                                           class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                </div>
                                <div class="flex items-center justify-between p-3 border rounded-md dark:border-gray-600">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Federal Track</label>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Search federal grants via Grants.gov and USASpending</p>
                                    </div>
                                    <input type="checkbox" x-model="discoveryConfig.federal.enabled" 
                                           class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                </div>
                                <div class="flex items-center justify-between p-3 border rounded-md dark:border-gray-600">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">State Track</label>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Search state and local government opportunities</p>
                                    </div>
                                    <input type="checkbox" x-model="discoveryConfig.state.enabled" 
                                           class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                </div>
                                <div class="flex items-center justify-between p-3 border rounded-md dark:border-gray-600">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Commercial Track</label>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Search corporate foundations and CSR programs</p>
                                    </div>
                                    <input type="checkbox" x-model="discoveryConfig.commercial.enabled" 
                                           class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200 dark:border-gray-600">
                    <button @click="saveDiscoveryConfiguration()" 
                            type="button"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Save Settings
                    </button>
                    <button @click="showDiscoveryConfigModal = false" 
                            type="button"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Phase 6 Comprehensive Export Modal -->
    <div x-show="showExportModal" x-cloak 
         class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" 
         @click.self="showExportModal = false">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Comprehensive Export</h3>
                    <button @click="showExportModal = false" 
                            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <!-- Export Format Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Export Format</label>
                        <select x-model="exportConfig.format" 
                                class="w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm">
                            <option value="pdf">PDF Report</option>
                            <option value="excel">Excel Workbook</option>
                            <option value="powerpoint">PowerPoint Presentation</option>
                            <option value="html">HTML Report</option>
                            <option value="json">JSON Data</option>
                        </select>
                    </div>
                    
                    <!-- Template Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Template</label>
                        <select x-model="exportConfig.template" 
                                class="w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm">
                            <option value="executive">Executive Summary</option>
                            <option value="technical">Technical Analysis</option>
                            <option value="presentation">Presentation</option>
                            <option value="minimal">Minimal</option>
                            <option value="comprehensive">Comprehensive</option>
                        </select>
                    </div>
                    
                    <!-- Content Options -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Include Content</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" x-model="exportConfig.includeAnalytics" 
                                       class="rounded border-gray-300 dark:border-gray-600 mr-2">
                                <span class="text-sm text-gray-700 dark:text-gray-300">Analytics & Metrics</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" x-model="exportConfig.includeVisualization" 
                                       class="rounded border-gray-300 dark:border-gray-600 mr-2">
                                <span class="text-sm text-gray-700 dark:text-gray-300">Charts & Visualizations</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" x-model="exportConfig.includeDecisionSynthesis" 
                                       class="rounded border-gray-300 dark:border-gray-600 mr-2">
                                <span class="text-sm text-gray-700 dark:text-gray-300">Decision Synthesis</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="showExportModal = false" 
                            class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors">
                        Cancel
                    </button>
                    <button @click="executeComprehensiveExport()" 
                            :disabled="exportInProgress"
                            class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        <span x-show="!exportInProgress">Export</span>
                        <span x-show="exportInProgress" class="flex items-center">
                            <svg class="animate-spin -ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Exporting...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI-Heavy Promotion Modal -->
    <div x-show="aiHeavyPromotionQueue.showPromotionModal" x-cloak 
         class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" 
         @click.self="closeAIHeavyPromotionModal()">
        <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white dark:bg-gray-800">
            
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">AI-Heavy Deep Research Promotion</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Select candidates for comprehensive AI-Heavy analysis</p>
                    </div>
                </div>
                <button @click="closeAIHeavyPromotionModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Cost Summary Bar -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-sm">
                            <span class="text-gray-600 dark:text-gray-400">Selected:</span>
                            <span class="font-medium text-gray-900 dark:text-white" x-text="aiHeavyPromotionQueue.selectedCandidates.length">0</span>
                            <span class="text-gray-600 dark:text-gray-400">of</span>
                            <span class="font-medium text-gray-900 dark:text-white" x-text="aiHeavyPromotionQueue.candidates.length">0</span>
                        </div>
                        <div class="text-sm">
                            <span class="text-gray-600 dark:text-gray-400">Est. Cost:</span>
                            <span class="font-bold text-purple-600 dark:text-purple-400" x-text="'$' + aiHeavyPromotionQueue.totalEstimatedCost.toFixed(4)">$0.0000</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button @click="selectAllCandidatesForPromotion()" 
                                class="px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors">
                            Select All
                        </button>
                        <button @click="deselectAllCandidatesForPromotion()" 
                                class="px-3 py-1 text-xs bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors">
                            Clear All
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Candidates Selection Table -->
            <div class="max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0">
                        <tr>
                            <th class="w-12 px-4 py-3">
                                <input type="checkbox" 
                                       @change="toggleAllCandidatesSelection($event)"
                                       class="rounded border-gray-300 dark:border-gray-600">
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Organization
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                AI-Lite Score
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Research Depth
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Est. Cost
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        <template x-for="candidate in aiHeavyPromotionQueue.candidates" :key="candidate.opportunity_id">
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700" 
                                :class="candidate.promotion_selected ? 'bg-purple-50 dark:bg-purple-900/20' : ''">
                                <!-- Selection Checkbox -->
                                <td class="px-4 py-4">
                                    <input type="checkbox" 
                                           :checked="candidate.promotion_selected"
                                           @change="selectCandidateForPromotion(candidate, $event)"
                                           class="rounded border-gray-300 dark:border-gray-600">
                                </td>
                                
                                <!-- Organization Details -->
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <div>
                                            <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="candidate.organization_name">-</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400">
                                                <span x-text="candidate.source_type">-</span>
                                                <span x-show="candidate.funding_amount"> ‚Ä¢ $<span x-text="candidate.funding_amount?.toLocaleString()">-</span></span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                
                                <!-- AI-Lite Score -->
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mr-2">
                                            <div class="h-2 rounded-full"
                                                 :class="candidate.ai_analysis?.compatibility_score >= 0.85 ? 'bg-green-500' : 
                                                        candidate.ai_analysis?.compatibility_score >= 0.75 ? 'bg-yellow-500' : 'bg-red-500'"
                                                 :style="`width: ${(candidate.ai_analysis?.compatibility_score * 100)}%`"></div>
                                        </div>
                                        <span class="text-sm font-medium text-gray-900 dark:text-white" 
                                              x-text="(candidate.ai_analysis?.compatibility_score * 100).toFixed(0) + '%'">-</span>
                                    </div>
                                </td>
                                
                                <!-- Research Depth -->
                                <td class="px-6 py-4">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                          :class="candidate.estimated_cost > 0.15 ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200' : 
                                                                                   'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'"
                                          x-text="candidate.estimated_cost > 0.15 ? 'Comprehensive' : 'Standard'">-</span>
                                </td>
                                
                                <!-- Estimated Cost -->
                                <td class="px-6 py-4">
                                    <div class="text-sm font-medium text-gray-900 dark:text-white" 
                                         x-text="'$' + candidate.estimated_cost.toFixed(4)">-</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        per analysis
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
            
            <!-- No Candidates State -->
            <div x-show="aiHeavyPromotionQueue.candidates.length === 0" class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No eligible candidates</h3>
                <p class="mt-2 text-gray-500 dark:text-gray-400">
                    Run AI-Lite analysis to identify candidates with scores ‚â•75% for AI-Heavy promotion
                </p>
            </div>
            
            <!-- Modal Footer -->
            <div class="flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700 mt-6">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                    <p>AI-Heavy research provides comprehensive analysis, competitive intelligence, and strategic recommendations</p>
                </div>
                <div class="flex items-center space-x-3">
                    <button @click="closeAIHeavyPromotionModal()" 
                            class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors">
                        Cancel
                    </button>
                    <button @click="promoteToDeepResearch()" 
                            :disabled="aiHeavyPromotionQueue.selectedCandidates.length === 0 || aiHeavyPromotionQueue.promotionInProgress"
                            class="px-6 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-400 disabled:to-gray-500 text-white font-medium rounded-lg transition-all duration-200 disabled:cursor-not-allowed">
                        <span x-show="!aiHeavyPromotionQueue.promotionInProgress" class="flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            <span>Promote to AI-Heavy (<span x-text="aiHeavyPromotionQueue.selectedCandidates.length">0</span>)</span>
                        </span>
                        <span x-show="aiHeavyPromotionQueue.promotionInProgress" class="flex items-center space-x-2">
                            <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span>Promoting...</span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 4-Tier Intelligence Modal -->
    <div x-show="show4TierIntelligenceModal" x-cloak
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto"
             @click.stop>
            
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center mr-3">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Generate Intelligence Dossier</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400" x-text="selectedCandidateForIntelligence ? `For: ${selectedCandidateForIntelligence.organization_name}` : ''"></p>
                    </div>
                </div>
                <button @click="close4TierIntelligenceModal()" 
                        class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                    <span class="text-2xl">&times;</span>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="p-6">
                
                <!-- Tier Selection Interface -->
                <div class="mb-8">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Select Intelligence Level</h4>
                    
                    <!-- Tier Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <template x-for="tier in intelligenceTiers" :key="tier.id">
                            <div :class="[
                                'border-2 rounded-lg p-4 cursor-pointer transition-all duration-200',
                                selectedIntelligenceTier === tier.id ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' : 'border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-500',
                                tier.status === 'coming_soon' ? 'opacity-60' : ''
                            ]" @click="selectIntelligenceTier(tier.id)" :disabled="tier.status === 'coming_soon'">
                                
                                <!-- Tier Header -->
                                <div class="text-center mb-4">
                                    <h3 class="font-semibold text-lg dark:text-white" x-text="tier.name"></h3>
                                    <div class="text-2xl font-bold text-blue-600" x-text="'$' + tier.price"></div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="tier.delivery_time"></div>
                                    <div x-show="tier.status === 'coming_soon'" class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded mt-2">
                                        Coming Soon
                                    </div>
                                </div>
                                
                                <!-- Key Features -->
                                <div class="space-y-2">
                                    <template x-for="feature in tier.features.slice(0, 3)" :key="feature">
                                        <div class="flex items-start text-sm">
                                            <svg class="h-4 w-4 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                            </svg>
                                            <span class="dark:text-gray-300" x-text="feature"></span>
                                        </div>
                                    </template>
                                </div>
                                
                                <!-- Selection Indicator -->
                                <div x-show="selectedIntelligenceTier === tier.id" class="mt-4 text-center">
                                    <span class="inline-flex items-center text-sm font-medium text-blue-600">
                                        <svg class="h-4 w-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                        </svg>
                                        Selected
                                    </span>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Cost Summary -->
                    <div x-show="selectedIntelligenceTier" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white" x-text="getSelectedTierName() + ' Intelligence'"></h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400" x-text="'Estimated delivery: ' + getSelectedTierTime()"></p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-blue-600" x-text="'$' + getSelectedTierPrice()"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div x-show="intelligenceResult" class="mb-6" x-transition>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Analysis Results</h4>
                    
                    <!-- Success Message -->
                    <div x-show="intelligenceResult?.status === 'completed'" class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg p-4 mb-4">
                        <div class="flex">
                            <svg class="h-5 w-5 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-green-800 dark:text-green-200">Analysis Completed Successfully</h3>
                                <div class="mt-2 text-sm text-green-700 dark:text-green-300">
                                    <p>Your <span x-text="getSelectedTierName()"></span> intelligence analysis is ready.</p>
                                    <p class="mt-1">Cost: <strong x-text="'$' + (intelligenceResult?.actual_cost || getSelectedTierPrice())"></strong> | 
                                       Time: <strong x-text="intelligenceResult?.estimated_completion_time || getSelectedTierTime()"></strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Error Display -->
                <div x-show="intelligenceError" class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg p-4 mb-6" x-transition>
                    <div class="flex">
                        <svg class="h-5 w-5 text-red-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800 dark:text-red-200">Analysis Error</h3>
                            <p class="mt-2 text-sm text-red-700 dark:text-red-300" x-text="intelligenceError"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-between px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600">
                <button @click="close4TierIntelligenceModal()" 
                        class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-600 rounded-md hover:bg-gray-200 dark:hover:bg-gray-500 transition-colors">
                    Cancel
                </button>
                
                <button @click="generateIntelligenceAnalysis()"
                        :disabled="!selectedIntelligenceTier || intelligenceGenerating || getSelectedTier()?.status === 'coming_soon'"
                        :class="[
                            'px-8 py-3 rounded-lg font-semibold transition-all duration-200',
                            (!selectedIntelligenceTier || intelligenceGenerating || getSelectedTier()?.status === 'coming_soon') 
                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700 shadow-lg hover:shadow-xl'
                        ]">
                    <span x-show="!intelligenceGenerating">Generate Intelligence Analysis</span>
                    <span x-show="intelligenceGenerating" class="flex items-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Processing...
                    </span>
                </button>
            </div>
        </div>
    </div>
    
</body>
</html>