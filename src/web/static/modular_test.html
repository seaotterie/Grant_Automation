<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalynx Modular Architecture Test</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Catalynx Modular Architecture Test</h1>
        
        <div x-data="modularTest()" class="space-y-6">
            <!-- Module Status -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Module Loading Status</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <template x-for="module in moduleStatus" :key="module.name">
                        <div class="flex items-center space-x-2">
                            <div :class="module.loaded ? 'bg-green-500' : 'bg-red-500'" 
                                 class="w-3 h-3 rounded-full"></div>
                            <span x-text="module.name" class="text-sm"></span>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Pagination Test -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Pagination Module Test</h2>
                
                <!-- Sample Data Table -->
                <div class="mb-4">
                    <input x-model="searchTerm" 
                           @input="filterData()"
                           placeholder="Search..."
                           class="px-4 py-2 border rounded-lg w-full max-w-md">
                </div>
                
                <table class="w-full border-collapse border border-gray-200">
                    <thead>
                        <tr class="bg-gray-50">
                            <th @click="sortTable('name')" 
                                class="border border-gray-200 px-4 py-2 cursor-pointer hover:bg-gray-100">
                                Name <span x-text="getSortIndicator('name')"></span>
                            </th>
                            <th @click="sortTable('type')" 
                                class="border border-gray-200 px-4 py-2 cursor-pointer hover:bg-gray-100">
                                Type <span x-text="getSortIndicator('type')"></span>
                            </th>
                            <th @click="sortTable('score')" 
                                class="border border-gray-200 px-4 py-2 cursor-pointer hover:bg-gray-100">
                                Score <span x-text="getSortIndicator('score')"></span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(item, index) in paginatedData" :key="index">
                            <tr>
                                <td class="border border-gray-200 px-4 py-2" x-text="item.name"></td>
                                <td class="border border-gray-200 px-4 py-2" x-text="item.type"></td>
                                <td class="border border-gray-200 px-4 py-2" x-text="item.score"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
                
                <!-- Pagination Controls -->
                <div class="mt-4 flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        Showing <span x-text="paginationInfo.startIndex"></span> to 
                        <span x-text="paginationInfo.endIndex"></span> of 
                        <span x-text="paginationInfo.totalItems"></span> results
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <button @click="prevPage()" 
                                :disabled="!paginationInfo.hasPrevPage"
                                class="px-3 py-1 bg-blue-500 text-white rounded disabled:bg-gray-300">
                            Previous
                        </button>
                        
                        <template x-for="pageNum in pageNumbers" :key="pageNum">
                            <button @click="goToPage(pageNum)"
                                    :class="pageNum === paginationInfo.currentPage ? 'bg-blue-600' : 'bg-blue-500'"
                                    class="px-3 py-1 text-white rounded hover:bg-blue-600"
                                    x-text="pageNum">
                            </button>
                        </template>
                        
                        <button @click="nextPage()" 
                                :disabled="!paginationInfo.hasNextPage"
                                class="px-3 py-1 bg-blue-500 text-white rounded disabled:bg-gray-300">
                            Next
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load modules in correct order -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/api/client.js"></script>
    <script src="/static/js/modules/websocket.js"></script>
    <script src="/static/js/modules/charts.js"></script>
    <script src="/static/js/modules/pagination.js"></script>
    <script src="/static/js/modules/profile-management.js"></script>
    <script src="/static/js/modules/discovery-engine.js"></script>
    
    <script>
        function modularTest() {
            return {
                // Module status tracking
                moduleStatus: [
                    { name: 'Utils', loaded: false },
                    { name: 'API', loaded: false },
                    { name: 'WebSocket', loaded: false },
                    { name: 'Charts', loaded: false },
                    { name: 'Pagination', loaded: false },
                    { name: 'ProfileManager', loaded: false },
                    { name: 'DiscoveryEngine', loaded: false }
                ],
                
                // Sample data
                rawData: [
                    { name: 'Foundation Alpha', type: 'Private Foundation', score: 85 },
                    { name: 'Community Trust', type: 'Community Foundation', score: 92 },
                    { name: 'Research Institute', type: 'Research Organization', score: 78 },
                    { name: 'Education Fund', type: 'Educational Foundation', score: 91 },
                    { name: 'Health Network', type: 'Health Foundation', score: 88 },
                    { name: 'Arts Council', type: 'Arts Foundation', score: 76 },
                    { name: 'Tech Initiative', type: 'Technology Fund', score: 94 },
                    { name: 'Environment Trust', type: 'Environmental Foundation', score: 82 },
                    { name: 'Social Services', type: 'Social Foundation', score: 89 },
                    { name: 'Youth Programs', type: 'Youth Foundation', score: 87 },
                    { name: 'Senior Care', type: 'Senior Foundation', score: 79 },
                    { name: 'Animal Welfare', type: 'Animal Foundation', score: 81 },
                    { name: 'Food Security', type: 'Hunger Relief', score: 93 },
                    { name: 'Housing First', type: 'Housing Foundation', score: 84 },
                    { name: 'Mental Health', type: 'Health Foundation', score: 90 }
                ],
                
                // Pagination state
                filteredData: [],
                paginatedData: [],
                paginationState: null,
                paginationInfo: {},
                pageNumbers: [],
                searchTerm: '',
                
                // Pagination instance
                pagination: null,
                
                init() {
                    this.checkModules();
                    this.initializePagination();
                    this.filterData();
                },
                
                checkModules() {
                    // Check which modules are loaded
                    this.moduleStatus = [
                        { name: 'Utils', loaded: !!window.CatalynxUtils },
                        { name: 'API', loaded: !!window.CatalynxAPI },
                        { name: 'WebSocket', loaded: !!window.CatalynxWebSocket },
                        { name: 'Charts', loaded: !!window.CatalynxCharts },
                        { name: 'Pagination', loaded: !!window.CatalynxPagination },
                        { name: 'ProfileManager', loaded: !!window.CatalynxProfileManager },
                        { name: 'DiscoveryEngine', loaded: !!window.CatalynxDiscoveryEngine }
                    ];
                },
                
                initializePagination() {
                    if (window.CatalynxPagination) {
                        this.pagination = new window.CatalynxPagination();
                        this.paginationState = this.pagination.createPaginationState(5); // 5 items per page for demo
                    }
                },
                
                filterData() {
                    if (!this.pagination) return;
                    
                    this.filteredData = this.pagination.filterData(this.rawData, this.searchTerm);
                    this.updatePagination();
                },
                
                updatePagination() {
                    if (!this.pagination) return;
                    
                    this.paginatedData = this.pagination.getPaginatedData(this.filteredData, this.paginationState);
                    this.paginationInfo = this.pagination.getPaginationInfo(this.filteredData, this.paginationState);
                    this.pageNumbers = this.pagination.getPageNumbers(this.paginationInfo.totalPages, this.paginationInfo.currentPage);
                },
                
                sortTable(column) {
                    if (!this.pagination) return;
                    
                    this.paginationState = this.pagination.sortTable(this.paginationState, column);
                    this.updatePagination();
                },
                
                getSortIndicator(column) {
                    if (this.paginationState.sortColumn !== column) return '';
                    return this.paginationState.sortDirection === 'asc' ? '↑' : '↓';
                },
                
                goToPage(page) {
                    if (!this.pagination) return;
                    
                    this.paginationState = this.pagination.goToPage(this.paginationState, page, this.paginationInfo.totalPages);
                    this.updatePagination();
                },
                
                nextPage() {
                    if (!this.pagination) return;
                    
                    this.paginationState = this.pagination.nextPage(this.paginationState, this.filteredData);
                    this.updatePagination();
                },
                
                prevPage() {
                    if (!this.pagination) return;
                    
                    this.paginationState = this.pagination.prevPage(this.paginationState);
                    this.updatePagination();
                }
            };
        }
    </script>
</body>
</html>