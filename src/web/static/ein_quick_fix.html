<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EIN Profile Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">‚ö° EIN Profile Creator</h1>
        
        <div class="bg-white p-6 rounded-lg shadow">
            <div x-data="{
                einInput: '13-1628593',
                loading: false,
                result: null,
                error: null,
                
                async createProfile() {
                    this.loading = true;
                    this.error = null;
                    this.result = null;
                    
                    try {
                        // Create a complete profile with EIN and minimal required fields
                        const profileData = {
                            name: 'Organization ' + this.einInput,
                            organization_type: 'nonprofit',
                            ein: this.einInput,
                            mission_statement: 'Auto-created profile from EIN ' + this.einInput,
                            focus_areas: ['General nonprofit purposes'],
                            target_populations: [],
                            geographic_scope: {
                                states: ['VA'],
                                nationwide: false,
                                international: false
                            },
                            funding_preferences: {
                                min_amount: 10000,
                                max_amount: 500000,
                                funding_types: ['grants']
                            },
                            annual_revenue: null,
                            staff_size: null,
                            volunteer_count: null
                        };
                        
                        console.log('Creating profile with data:', profileData);
                        
                        const response = await fetch('/api/profiles', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(profileData)
                        });
                        
                        console.log('Response status:', response.status);
                        
                        const data = await response.json();
                        console.log('Response data:', data);
                        
                        if (response.ok) {
                            this.result = data;
                        } else {
                            this.error = data.detail || 'Unknown error';
                        }
                        
                    } catch (err) {
                        console.error('Error:', err);
                        this.error = err.message;
                    } finally {
                        this.loading = false;
                    }
                }
            }">
                <form @submit.prevent="createProfile()" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Organization EIN</label>
                        <input type="text" x-model="einInput" 
                               class="w-full rounded border-gray-300 font-mono text-lg"
                               placeholder="13-1628593">
                        <p class="text-xs text-gray-500 mt-1">Try: 13-1628593, 31-4617866, or 23-7083797</p>
                    </div>
                    
                    <button type="submit" :disabled="loading"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded disabled:opacity-50 font-medium">
                        <span x-show="!loading">üîç Create Profile from EIN</span>
                        <span x-show="loading">‚è≥ Creating Profile...</span>
                    </button>
                </form>
                
                <!-- Success Result -->
                <div x-show="result" class="mt-6 p-4 bg-green-50 border border-green-200 rounded">
                    <h3 class="font-semibold text-green-800 mb-2">‚úÖ Success!</h3>
                    <div class="text-sm space-y-1">
                        <p><strong>Profile Created:</strong> <span x-text="result?.profile?.name"></span></p>
                        <p><strong>EIN:</strong> <span x-text="result?.profile?.ein"></span></p>
                        <p><strong>Type:</strong> <span x-text="result?.profile?.organization_type"></span></p>
                        <p><strong>ID:</strong> <span x-text="result?.profile?.profile_id"></span></p>
                    </div>
                    <div class="mt-3">
                        <a href="/" class="text-blue-600 hover:text-blue-800 underline text-sm">
                            ‚Üí View in main app (READIFIER ‚Üí Profiler)
                        </a>
                    </div>
                </div>
                
                <!-- Error Display -->
                <div x-show="error" class="mt-6 p-4 bg-red-50 border border-red-200 rounded">
                    <h3 class="font-semibold text-red-800 mb-2">‚ùå Error</h3>
                    <p class="text-sm" x-text="error"></p>
                </div>
                
                <!-- Instructions -->
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded">
                    <h4 class="font-semibold text-blue-800 mb-2">How it works:</h4>
                    <ul class="text-sm space-y-1 text-blue-700">
                        <li>‚Ä¢ Creates a basic profile with your EIN</li>
                        <li>‚Ä¢ Sets default nonprofit values</li>
                        <li>‚Ä¢ Profile appears in main app immediately</li>
                        <li>‚Ä¢ You can edit details after creation</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="mt-6 text-center">
            <a href="/" class="text-blue-600 hover:text-blue-800 underline">‚Üê Back to Main App</a>
        </div>
    </div>
</body>
</html>